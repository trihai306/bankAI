This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.claude/
  settings.local.json
docs/
  code-standards.md
  codebase-summary.md
  deployment-guide.md
  design-guidelines.md
  project-overview-pdr.md
  project-roadmap.md
  system-architecture.md
electron/
  db.js
  edge-tts.js
  main.js
  preload.js
public/
  vite.svg
python/
  f5_tts.py
  README.md
  transcribe.py
src/
  assets/
    react.svg
  components/
    Layout.jsx
    WaveformVisualizer.jsx
  pages/
    CallCenter.jsx
    Chat.jsx
    Dashboard.jsx
    History.jsx
    ModelManager.jsx
    Settings.jsx
    TrainingData.jsx
    VoiceTraining.jsx
    VoiceTraining.jsx.backup
  store/
    useStore.js
  App.css
  App.jsx
  index.css
  main.jsx
training-data/
  banking_knowledge_vietnamese.txt
  banking_qa_vietnamese.csv
  banking_qa_vietnamese.json
  banking_qa_vietnamese.jsonl
___CLAUDE.md
.editorconfig
.gitignore
CLAUDE.md
eslint.config.js
index.html
package.json
postcss.config.js
README.md
tailwind.config.js
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".claude/settings.local.json">
{
  "permissions": {
    "allow": [
      "WebSearch",
      "mcp__web-search-prime__webSearchPrime",
      "mcp__web-reader__webReader",
      "Bash(find:*)",
      "Bash(wc:*)",
      "Bash(repomix:*)"
    ]
  }
}
</file>

<file path="docs/code-standards.md">
# Code Standards

## General Principles
- **KISS**: Keep It Simple, Stupid.
- **DRY**: Don't Repeat Yourself.
- **YAGNI**: You Aren't Gonna Need It.

## File Organization
- **Electron Backend**: All logic in `electron/`.
- **Frontend Pages**: One file per major route in `src/pages/`.
- **Frontend Components**: Reusable UI in `src/components/`.
- **Python**: ML-heavy scripts in `python/` with a shared `venv`.

## Naming Conventions
- **Files**: `kebab-case.js`, `PascalCase.jsx` for components/pages.
- **Variables/Functions**: `camelCase`.
- **CSS Classes**: Tailwind utility classes.
- **IPC Namespaces**: Short, descriptive names (`db`, `tts`, `qwen`).

## Frontend Patterns (React)
- **State**: Use Zustand (`src/store/useStore.js`) for global state.
- **Styling**: Tailwind CSS 3. Use glassmorphism and glow effects for consistency.
- **Icons**: `lucide-react`.
- **API Access**: Strictly through `window.electronAPI`. Check availability for browser-mode safety.

## Backend Patterns (Electron)
- **IPC**: Use `ipcMain.handle` for async operations (returns Promise to renderer).
- **Subprocesses**: Use `spawnPython` helper for AI scripts to handle stdout/stderr consistently.
- **Database**: Use `better-sqlite3` with prepared statements for security.
- **File System**: Validate all paths before I/O. Use `path.join` and `app.getPath`.

## Python Standards
- Use `argparse` for CLI arguments.
- Return results as a single JSON line on the final `stdout`.
- Maintain a `requirements.txt` in the root or `python/` dir.
- Use explicit logging to `stderr` so it doesn't pollute JSON output on `stdout`.

## Error Handling
- **Frontend**: Catch errors in Zustand actions or component `useEffect` and display toast/error states.
- **Backend**: Wrap IPC handlers in `try-catch`. Return informative error objects to the renderer.
- **AI**: Detect and report model availability or resource exhaustion.
</file>

<file path="docs/codebase-summary.md">
# Codebase Summary

## Backend (Electron)

| File | Purpose | Key Functions/Components |
|------|---------|-------------------------|
| `electron/main.js` | Entry point & IPC Hub | Window mgmt, `spawnPython`, IPC handlers (`tts`, `qwen`, `voice`, `db`) |
| `electron/preload.js` | IPC Bridge | `contextBridge` exposing `window.electronAPI` to frontend |
| `electron/db.js` | Database Layer | SQLite init, CRUD operations for `settings`, `calls`, `models` |
| `electron/edge-tts.js` | Cloud TTS Fallback | Microsoft Edge TTS integration |

## Frontend (React)

| File/Dir | Purpose | Key Functions/Components |
|----------|---------|-------------------------|
| `src/store/useStore.js` | State Management | Zustand store for app state, settings, and Electron API detection |
| `src/components/Layout.jsx` | UI Shell | Navigation sidebar, global layout, glassmorphism styling |
| `src/pages/VoiceTraining.jsx` | Voice Cloning | Audio recording, reference upload, model training workflow |
| `src/pages/Dashboard.jsx` | Main Overview | Resource monitoring (simulated), call stats, recent activity |
| `src/pages/CallCenter.jsx` | Call Interface | Live dialer and active call management (UI focused) |
| `src/pages/Chat.jsx` | LLM Playground | Interaction with Qwen/Ollama for testing |
| `src/pages/History.jsx` | Call Logs | Display and playback of past call recordings and transcripts |
| `src/pages/Settings.jsx` | App Config | TTS/STT/LLM configuration and system preferences |
| `src/pages/ModelManager.jsx` | Model Lifecycle | Downloading and installing AI models (partially simulated) |

## Python (AI Backends)

| File | Purpose | Logic |
|------|---------|-------|
| `python/f5_tts.py` | TTS Logic | Vietnamese voice cloning using F5-TTS architecture |
| `python/transcribe.py` | STT Logic | OpenAI Whisper for Vietnamese audio transcription |
| `python/venv/` | Dependencies | Isolated Python environment for ML libraries |

## Data & Resources

| File/Dir | Purpose |
|----------|---------|
| `training-data/` | Banking-specific Vietnamese Q&A datasets (JSON, CSV, TXT) |
| `python/ref_audio/` | Storage for voice cloning reference audio files |
| `python/outputs/` | Temporary storage for generated TTS WAV files |
</file>

<file path="docs/deployment-guide.md">
# Deployment Guide

## Prerequisites for All Platforms
- **Node.js**: v18+
- **Python**: 3.10+ (must be in system PATH)
- **ffmpeg**: Must be installed and available in system PATH.
- **Ollama**: Must be installed and running on the target machine.

## Packaging for Distribution

The project uses `electron-builder` for packaging.

### 1. Build the Frontend
```bash
npm run build
```

### 2. Package the Application
```bash
# Generic build
npm run build:electron

# Platform specific (if configured)
# npm run build:win
# npm run build:mac
# npm run build:linux
```

## Post-Installation Requirements

Once the app is installed, the following manual steps are required for full functionality:

### Python Environment
The app expects a Python virtual environment at `{AppPath}/python/venv`.
In production, this needs to be bundled or created on first run.

1. Navigate to the `python` directory.
2. Create venv: `python -m venv venv`.
3. Install dependencies: `pip install -r requirements.txt`.

### AI Models
- **Ollama**: Run `ollama pull qwen:4b`.
- **F5-TTS**: The first run of voice cloning will trigger a download of the pretrained Vietnamese model (~5GB). Ensure a stable internet connection.
- **Whisper**: The first run of transcription will download the `base` Whisper model.

## Troubleshooting Production Builds
- **Audio Conversion**: If audio doesn't play or transcribe, check if `ffmpeg` is properly installed.
- **Python Paths**: Ensure the `python/venv/bin/python` (or `python/venv/Scripts/python.exe`) path is correct relative to the executable.
- **Database**: The SQLite file is stored in the user data directory. On Linux: `~/.config/ai-voice-bot/`. On Windows: `%APPDATA%/ai-voice-bot/`.
</file>

<file path="docs/design-guidelines.md">
# Design Guidelines

## Visual Style: "Modern Violet AI"
The application uses a dark, high-contrast theme focused on violet and purple tones with neon glow effects.

### Color Palette (Tailwind)
- **Primary**: `violet-600` (#7c3aed)
- **Secondary**: `purple-600` (#9333ea)
- **Accent**: `fuchsia-500` (#d946ef)
- **Background**: `gray-950` (#030712)
- **Surface**: `gray-900/50` with backdrop blur (glassmorphism)

## UI Patterns

### Glassmorphism
Apply transparency and backdrop blur to cards and sidebars:
```html
<div class="bg-gray-900/50 backdrop-blur-md border border-gray-800">...</div>
```

### Glow Effects
Use text-shadow and box-shadow for "AI" elements:
```html
<div class="shadow-[0_0_15px_rgba(139,92,246,0.3)]">...</div>
```

### Typography
- **Headings**: Sans-serif, bold, often with gradients.
- **Body**: Standard sans-serif for high readability.
- **Monospace**: Used for logs, transcripts, and model outputs.

## Component Standards

### Navigation
- Vertical sidebar on the left.
- Icons from `lucide-react`.
- Active states should have a violet glow/indicator.

### Data Visualization
- **Waveforms**: Canvas-based real-time visualization for audio.
- **Resource Bars**: Custom progress bars for CPU/RAM monitoring.
- **Stats**: Large, bold numbers with descriptive labels.

### Layout
- **Max Width**: The app is designed for desktop resolutions (1280px+).
- **Spacing**: Generous use of `gap-6` and `p-6` for a spacious feel.
- **Transitions**: Use `framer-motion` or CSS transitions for page changes and hover states.
</file>

<file path="docs/project-overview-pdr.md">
# Product Development Requirements (PDR) - AI Voice Bot

## Project Vision
Automate banking customer service calls in Vietnamese using local, private AI models. Provide a high-quality, voice-clonable interface for bank representatives to handle repetitive queries efficiently.

## Target Users
- Banking customer service departments
- Independent financial advisors
- Automated call center operators in Vietnam

## Core Features

### 1. Voice Cloning & TTS
- **Vietnamese Support**: High-fidelity TTS specifically for Vietnamese language.
- **Reference-based Cloning**: Ability to clone voices from short (5-10s) reference audio clips.
- **Hybrid System**: Local F5-TTS for custom voices, Edge TTS for standard fallback.

### 2. Speech-to-Text (STT)
- **Local Transcription**: OpenAI Whisper running locally for privacy.
- **Forced Vietnamese**: Language-specific optimization to ensure accuracy.

### 3. Intelligent Text Processing (LLM)
- **Task Automation**: Correcting transcripts, extracting intent, and generating answers.
- **Model**: Qwen:4b via Ollama for local processing.

### 4. Call Management
- **Dashboard**: Real-time stats, resource usage, and recent call history.
- **History**: Full logs with transcripts and audio playback.
- **Dialer**: (In Progress) Interface for initiating and managing calls.

### 5. Training & Data
- **Dataset Management**: Handling Vietnamese banking Q&A datasets.
- **Voice Training**: Workflow for creating and managing cloned voice models.

## Technical Requirements
- **Local Processing**: Prioritize local execution for STT/TTS/LLM to ensure data privacy.
- **Low Latency**: Optimize IPC and subprocess communication for real-time interaction.
- **Resource Monitoring**: Track CPU/RAM/GPU usage as local models are resource-intensive.

## Constraints & Assumptions
- Requires a relatively modern GPU/CPU for local AI inference.
- F5-TTS model download is large (~5GB).
- Local Ollama instance must be running.
- Vietnamese-only focus for NLP/TTS/STT.
</file>

<file path="docs/project-roadmap.md">
# Project Roadmap

## Phase 1: Core AI Integration (Completed)
- [x] Basic Electron + React + Vite setup.
- [x] SQLite database integration.
- [x] Python subprocess spawning infrastructure.
- [x] Whisper STT integration (transcribe.py).
- [x] F5-TTS Vietnamese voice cloning integration (f5_tts.py).
- [x] Ollama/Qwen LLM integration.

## Phase 2: UI & UX Refinement (Completed)
- [x] Custom Tailwind theme (purple/violet).
- [x] Glassmorphism layout & animations.
- [x] Voice training workflow UI.
- [x] Dashboard with stats and resource usage (mocked data).
- [x] History page with transcript playback.

## Phase 3: Robustness & Reliability (Current)
- [ ] Improved error handling for AI subprocesses.
- [ ] Real resource monitoring (CPU/GPU/RAM).
- [ ] Better model lifecycle management (downloads/updates).
- [ ] Automated testing for IPC and Python scripts.

## Phase 4: Production Features (Planned)
- [ ] Real SIP/VoIP integration for actual calls.
- [ ] Advanced call analytics.
- [ ] Multi-voice management system.
- [ ] Dataset editor for banking Q&A.
- [ ] Windows/macOS/Linux installers.

## Phase 5: Optimization (Planned)
- [ ] Model quantization for faster inference.
- [ ] Latency reduction in audio pipeline.
- [ ] Caching for repetitive LLM queries.
- [ ] Streaming TTS/STT support.
</file>

<file path="docs/system-architecture.md">
# System Architecture

## Process Model

```mermaid
graph TD
    subgraph "Renderer Process (React)"
        UI[UI Components]
        Store[Zustand Store]
        API[window.electronAPI]
    end

    subgraph "Main Process (Node.js)"
        IPC[IPC Handlers]
        DB[(SQLite)]
        Sub[Subprocess Spawn]
        Edge[Edge TTS Client]
        Ollama[Ollama API Client]
    end

    subgraph "External/Subprocesses"
        Python[Python: F5-TTS / Whisper]
        OL[Ollama Server: Qwen]
        Cloud[Edge TTS Cloud]
    end

    UI --> Store
    Store --> API
    API <== IPC ==> IPC
    IPC --> DB
    IPC --> Sub
    IPC --> Edge
    IPC --> Ollama
    Sub --> Python
    Edge --> Cloud
    Ollama --> OL
```

## IPC Design
Namespaced communication via `contextBridge`:
- `db`: Database access (stats, history, settings).
- `voice`: Recording control (start/stop).
- `call`: Call lifecycle (dial, hangup).
- `model`: Model management (list, install).
- `tts`: Voice cloning and generation.
- `qwen`: LLM processing (text correction/extraction).

## Data Flow
1. **User records audio** -> Frontend sends WebM blob to Main.
2. **Main converts WebM to WAV** via ffmpeg.
3. **Main spawns `transcribe.py`** (Whisper) -> returns JSON text.
4. **Main sends text to Ollama** (Qwen) for correction/intent.
5. **Main spawns `f5_tts.py`** (F5-TTS) for response voice generation.
6. **Frontend plays generated WAV**.

## Security Model
- **Context Isolation**: Enabled.
- **Node Integration**: Disabled in renderer.
- **Path Validation**: All file operations (read/write/delete) are checked against allowed directories.
- **SQL Injection**: Prevented using prepared statements in `better-sqlite3`.

## Database Schema (SQLite)
- `settings`: Key-value store for app configuration.
- `calls`: History of calls (id, time, duration, status, transcript, audio_path).
- `models`: Registry of local/cloned models (id, name, type, path, status).
- **WAL Mode**: Enabled for high-performance concurrent reads/writes.
</file>

<file path="___CLAUDE.md">
# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

AI Voice Bot ("ai-voice-bot") - an Electron desktop app for automated banking call handling in Vietnamese. Combines a React frontend with local AI backends (F5-TTS for voice cloning, OpenAI Whisper for STT, Ollama/Qwen for text processing).

## Commands

```bash
# Development (starts Vite dev server + Electron)
npm run dev:electron

# Vite-only dev server (no Electron, browser mode - limited functionality)
npm run dev

# Production build
npm run build:electron

# Lint
npm run lint
```

## Architecture

### Process Model (Electron)

```
Renderer (React/Vite :5174)  <-->  Preload (contextBridge)  <-->  Main Process (Node.js)
                                                                    ‚îú‚îÄ‚îÄ SQLite (better-sqlite3)
                                                                    ‚îú‚îÄ‚îÄ Python subprocess (F5-TTS, Whisper)
                                                                    ‚îî‚îÄ‚îÄ Ollama HTTP API (:11434)
```

- **Main process** (`electron/main.js`): Window management, all IPC handlers, spawns Python subprocesses, calls Ollama API. This is a large file containing all backend logic.
- **Preload** (`electron/preload.js`): Exposes `window.electronAPI` with namespaced methods (db, voice, call, model, tts, qwen). Uses CommonJS (`require`).
- **Renderer** (`src/`): React 19 + Vite. ESM throughout. Accesses backend exclusively through `window.electronAPI`.

### IPC Namespaces

All renderer-to-main communication goes through `window.electronAPI.<namespace>.<method>()`:
- `db` - SQLite CRUD (stats, calls, settings)
- `voice` - Recording start/stop
- `call` - Initiate/hangup calls
- `model` - List/train models
- `tts` - F5-TTS voice cloning (generate, upload ref audio, convert WebM->WAV, transcribe via Whisper)
- `qwen` - Ollama text processing (correct/extract/answer tasks)

### Python Integration

Python scripts live in `python/` with their own venv at `python/venv/`. Main process spawns them via `child_process.spawn` using `python/venv/bin/python`. Scripts return JSON on stdout's last line.
- `f5_tts.py` - Vietnamese voice cloning TTS
- `transcribe.py` - Whisper-based audio transcription

### Frontend Structure

- State: Zustand store (`src/store/useStore.js`) - handles Electron API detection and data fetching
- Routing: react-router-dom with `<Layout>` wrapper
- Styling: Tailwind CSS 3 with custom purple/violet theme, glow effects, and animations
- Path alias: `@` -> `src/`

### External Dependencies

- **Ollama** must be running at `localhost:11434` with `qwen:4b` model pulled
- **ffmpeg** required for WebM-to-WAV audio conversion
- **Python venv** at `python/venv/` with F5-TTS and Whisper packages installed

### Database

SQLite at `{userData}/voice-bot.db` with WAL mode. Tables: `settings`, `calls`, `models`. Auto-initialized on app start.

## Key Patterns

- Electron main process uses ESM (`"type": "module"`), preload uses CommonJS
- Frontend gracefully degrades when `window.electronAPI` is unavailable (browser mode shows empty state)
- TTS output files auto-cleanup every 30 minutes (files older than 1 hour)
- File operations in IPC handlers validate paths against allowed directories before read/write/delete
</file>

<file path=".editorconfig">
# EditorConfig is awesome: https://EditorConfig.org

# top-most EditorConfig file
root = true

[*]
indent_style = space
indent_size = 4
end_of_line = lf
charset = utf-8
trim_trailing_whitespace = false
insert_final_newline = false
</file>

<file path="CLAUDE.md">
# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

AI Voice Bot ("ai-voice-bot") - an Electron desktop app for automated banking call handling in Vietnamese. Combines a React frontend with local AI backends (F5-TTS for voice cloning, OpenAI Whisper for STT, Ollama/Qwen for text processing).

## Commands

```bash
# Development (starts Vite dev server + Electron)
npm run dev:electron

# Vite-only dev server (no Electron, browser mode - limited functionality)
npm run dev

# Production build
npm run build:electron

# Lint
npm run lint
```

## Architecture

### Process Model (Electron)

```
Renderer (React/Vite :5174)  <-->  Preload (contextBridge)  <-->  Main Process (Node.js)
                                                                    ‚îú‚îÄ‚îÄ SQLite (better-sqlite3)
                                                                    ‚îú‚îÄ‚îÄ Python subprocess (F5-TTS, Whisper)
                                                                    ‚îî‚îÄ‚îÄ Ollama HTTP API (:11434)
```

- **Main process** (`electron/main.js`): Window management, all IPC handlers, spawns Python subprocesses, calls Ollama API. This is a large file containing all backend logic.
- **Preload** (`electron/preload.js`): Exposes `window.electronAPI` with namespaced methods (db, voice, call, model, tts, qwen). Uses CommonJS (`require`).
- **Renderer** (`src/`): React 19 + Vite. ESM throughout. Accesses backend exclusively through `window.electronAPI`.

### IPC Namespaces

All renderer-to-main communication goes through `window.electronAPI.<namespace>.<method>()`:
- `db` - SQLite CRUD (stats, calls, settings)
- `voice` - Recording start/stop
- `call` - Initiate/hangup calls
- `model` - List/train models
- `tts` - F5-TTS voice cloning (generate, upload ref audio, convert WebM->WAV, transcribe via Whisper)
- `qwen` - Ollama text processing (correct/extract/answer tasks)

### Python Integration

Python scripts live in `python/` with their own venv at `python/venv/`. Main process spawns them via `child_process.spawn` using `python/venv/bin/python`. Scripts return JSON on stdout's last line.
- `f5_tts.py` - Vietnamese voice cloning TTS
- `transcribe.py` - Whisper-based audio transcription

### Frontend Structure

- State: Zustand store (`src/store/useStore.js`) - handles Electron API detection and data fetching
- Routing: react-router-dom with `<Layout>` wrapper
- Styling: Tailwind CSS 3 with custom purple/violet theme, glow effects, and animations
- Path alias: `@` -> `src/`

### External Dependencies

- **Ollama** must be running at `localhost:11434` with `qwen:4b` model pulled
- **ffmpeg** required for WebM-to-WAV audio conversion
- **Python venv** at `python/venv/` with F5-TTS and Whisper packages installed

### Database

SQLite at `{userData}/voice-bot.db` with WAL mode. Tables: `settings`, `calls`, `models`. Auto-initialized on app start.

## Key Patterns

- Electron main process uses ESM (`"type": "module"`), preload uses CommonJS
- Frontend gracefully degrades when `window.electronAPI` is unavailable (browser mode shows empty state)
- TTS output files auto-cleanup every 30 minutes (files older than 1 hour)
- File operations in IPC handlers validate paths against allowed directories before read/write/delete
</file>

<file path="electron/db.js">
import Database from 'better-sqlite3';
import path from 'path';
import { app } from 'electron';

let db;

export function initDB() {
    const userDataPath = app.getPath('userData');
    const dbPath = path.join(userDataPath, 'voice-bot.db');

    console.log('Initializing database at:', dbPath);

    db = new Database(dbPath);
    db.pragma('journal_mode = WAL');

    // Create tables
    db.exec(`
        CREATE TABLE IF NOT EXISTS settings (
            key TEXT PRIMARY KEY,
            value TEXT
        );

        CREATE TABLE IF NOT EXISTS calls (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            phone_number TEXT,
            customer_name TEXT,
            start_time TEXT,
            duration TEXT,
            status TEXT,
            transcript TEXT,
            recording_path TEXT
        );

        CREATE TABLE IF NOT EXISTS models (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            name TEXT,
            type TEXT,
            status TEXT,
            params TEXT,
            context TEXT,
            size TEXT
        );
    `);

    // Initialize default settings only (no fake call data)
    const settingsCount = db.prepare('SELECT count(*) as count FROM settings').get().count;
    if (settingsCount === 0) {
        console.log('Initializing default settings...');
        const insertSetting = db.prepare('INSERT OR IGNORE INTO settings (key, value) VALUES (?, ?)');
        insertSetting.run('voiceEngine', 'vits');
        insertSetting.run('modelName', 'Llama 3.2 8B');
        insertSetting.run('autoAnswer', 'true');
        insertSetting.run('language', 'vi-VN');
    }
}

// Database API
export const dbAPI = {
    // Dashboard Stats - Real data from database
    getDashboardStats: () => {
        const today = new Date().toISOString().split('T')[0];

        const totalCalls = db.prepare('SELECT count(*) as count FROM calls').get().count;
        const todayCalls = db.prepare('SELECT count(*) as count FROM calls WHERE start_time LIKE ?').get(`${today}%`).count;
        const completedCalls = db.prepare('SELECT count(*) as count FROM calls WHERE status = ?').get('completed').count;

        // Calculate real success rate
        const successRate = totalCalls > 0 ? Math.round((completedCalls / totalCalls) * 100 * 10) / 10 : 0;

        // Calculate average duration from actual calls
        const allCalls = db.prepare('SELECT duration FROM calls WHERE duration IS NOT NULL').all();
        let avgDuration = '0:00';
        if (allCalls.length > 0) {
            let totalSeconds = 0;
            allCalls.forEach(call => {
                if (call.duration) {
                    const parts = call.duration.split(':');
                    totalSeconds += parseInt(parts[0] || 0) * 60 + parseInt(parts[1] || 0);
                }
            });
            const avgSeconds = Math.round(totalSeconds / allCalls.length);
            const mins = Math.floor(avgSeconds / 60);
            const secs = avgSeconds % 60;
            avgDuration = `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        return {
            totalCalls,
            todayCalls,
            successRate,
            avgDuration
        };
    },

    // Calls  
    getRecentCalls: (limit = 5) => {
        return db.prepare('SELECT * FROM calls ORDER BY start_time DESC LIMIT ?').all(limit);
    },

    getAllCalls: () => {
        return db.prepare('SELECT * FROM calls ORDER BY start_time DESC').all();
    },

    // Add a new call record
    addCall: (callData) => {
        const stmt = db.prepare(`
            INSERT INTO calls (phone_number, customer_name, start_time, duration, status, transcript, recording_path) 
            VALUES (@phone_number, @customer_name, @start_time, @duration, @status, @transcript, @recording_path)
        `);
        return stmt.run(callData);
    },

    // Settings
    getSettings: () => {
        const rows = db.prepare('SELECT * FROM settings').all();
        const settings = {};
        rows.forEach(row => {
            try {
                settings[row.key] = JSON.parse(row.value);
            } catch {
                settings[row.key] = row.value === 'true' ? true : row.value === 'false' ? false : row.value;
            }
        });
        return settings;
    },

    saveSetting: (key, value) => {
        const strValue = typeof value === 'object' ? JSON.stringify(value) : String(value);
        db.prepare('INSERT OR REPLACE INTO settings (key, value) VALUES (?, ?)').run(key, strValue);
        return true;
    },

    // Clear all call data (for testing)
    clearCalls: () => {
        db.prepare('DELETE FROM calls').run();
        return true;
    }
};
</file>

<file path="electron/edge-tts.js">
/**
 * Edge TTS Service - Vietnamese Text-to-Speech
 * S·ª≠ d·ª•ng Microsoft Edge TTS API - Kh√¥ng c·∫ßn Python!
 * 
 * Voices Vietnamese:
 * - vi-VN-HoaiMyNeural (N·ªØ) - Recommended
 * - vi-VN-NamMinhNeural (Nam)
 */

const EdgeTTS = require('edge-tts');
const path = require('path');
const fs = require('fs');

// Vietnamese voices
const VOICES = {
    female: 'vi-VN-HoaiMyNeural',
    male: 'vi-VN-NamMinhNeural'
};

// Output directory
const OUTPUT_DIR = path.join(__dirname, '..', 'tts-output');

// Ensure output directory exists
if (!fs.existsSync(OUTPUT_DIR)) {
    fs.mkdirSync(OUTPUT_DIR, { recursive: true });
}

/**
 * Get list of available Vietnamese voices
 */
async function getVoices() {
    try {
        const voices = await EdgeTTS.getVoices();
        return voices.filter(v => v.Locale.startsWith('vi-VN'));
    } catch (error) {
        console.error('Error getting voices:', error);
        return [
            { Name: VOICES.female, Locale: 'vi-VN', Gender: 'Female' },
            { Name: VOICES.male, Locale: 'vi-VN', Gender: 'Male' }
        ];
    }
}

/**
 * Generate speech from text
 * @param {string} text - Text to convert to speech
 * @param {object} options - Generation options
 * @returns {Promise<{audioPath: string, audioUrl: string}>}
 */
async function generateSpeech(text, options = {}) {
    const {
        voice = VOICES.female,
        rate = '+0%',      // Speed: -50% to +100%
        pitch = '+0Hz',    // Pitch adjustment
        volume = '+0%'     // Volume adjustment
    } = options;

    const timestamp = Date.now();
    const filename = `tts_${timestamp}.mp3`;
    const outputPath = path.join(OUTPUT_DIR, filename);

    try {
        const tts = new EdgeTTS({
            voice: voice,
            rate: rate,
            pitch: pitch,
            volume: volume
        });

        await tts.ttsPromise(text, outputPath);

        return {
            success: true,
            audioPath: outputPath,
            filename: filename,
            voice: voice,
            text: text.substring(0, 100)
        };
    } catch (error) {
        console.error('TTS Generation error:', error);
        throw error;
    }
}

/**
 * Generate speech with subtitle/timing data
 */
async function generateWithSubtitles(text, options = {}) {
    const {
        voice = VOICES.female,
        rate = '+0%'
    } = options;

    const timestamp = Date.now();
    const audioPath = path.join(OUTPUT_DIR, `tts_${timestamp}.mp3`);
    const subtitlePath = path.join(OUTPUT_DIR, `tts_${timestamp}.vtt`);

    try {
        const tts = new EdgeTTS({
            voice: voice,
            rate: rate
        });

        // Generate audio with subtitles
        await tts.ttsPromise(text, audioPath);

        // Get subtitle data if available
        let subtitles = null;
        if (tts.subtitles) {
            fs.writeFileSync(subtitlePath, tts.subtitles);
            subtitles = subtitlePath;
        }

        return {
            success: true,
            audioPath: audioPath,
            subtitlePath: subtitles,
            voice: voice
        };
    } catch (error) {
        console.error('TTS with subtitles error:', error);
        throw error;
    }
}

/**
 * Clean up old TTS files (older than 1 hour)
 */
function cleanupOldFiles() {
    const oneHourAgo = Date.now() - (60 * 60 * 1000);

    try {
        const files = fs.readdirSync(OUTPUT_DIR);
        files.forEach(file => {
            const filePath = path.join(OUTPUT_DIR, file);
            const stats = fs.statSync(filePath);
            if (stats.mtimeMs < oneHourAgo) {
                fs.unlinkSync(filePath);
            }
        });
    } catch (error) {
        console.error('Cleanup error:', error);
    }
}

// Export functions
module.exports = {
    generateSpeech,
    generateWithSubtitles,
    getVoices,
    cleanupOldFiles,
    VOICES,
    OUTPUT_DIR
};

// CLI usage
if (require.main === module) {
    const args = process.argv.slice(2);

    if (args.length === 0) {
        console.log(`
Edge TTS Vietnamese - CLI Usage:
  node edge-tts.js "VƒÉn b·∫£n c·∫ßn ƒë·ªçc"
  node edge-tts.js "VƒÉn b·∫£n" --voice male
  node edge-tts.js --list-voices
        `);
        process.exit(0);
    }

    if (args[0] === '--list-voices') {
        getVoices().then(voices => {
            console.log('Vietnamese Voices:');
            voices.forEach(v => console.log(`  - ${v.Name} (${v.Gender})`));
        });
    } else {
        const text = args[0];
        const voiceArg = args.indexOf('--voice');
        const voice = voiceArg > -1 ? VOICES[args[voiceArg + 1]] || VOICES.female : VOICES.female;

        console.log(`üéôÔ∏è Generating: "${text.substring(0, 50)}..."`);
        console.log(`   Voice: ${voice}`);

        generateSpeech(text, { voice }).then(result => {
            console.log(`‚úÖ Generated: ${result.audioPath}`);
        }).catch(err => {
            console.error('‚ùå Error:', err.message);
            process.exit(1);
        });
    }
}
</file>

<file path="electron/main.js">
import { app, BrowserWindow, ipcMain } from "electron";
import path from "path";
import { fileURLToPath } from "url";
import { spawn } from "child_process";
import { initDB, dbAPI } from "./db.js";

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const isDev = process.env.NODE_ENV === "development";

function createWindow() {
    const mainWindow = new BrowserWindow({
        width: 1400,
        height: 900,
        minWidth: 1024,
        minHeight: 768,
        webPreferences: {
            preload: path.join(__dirname, "preload.js"),
            nodeIntegration: false,
            contextIsolation: true,
        },
        titleBarStyle: "hiddenInset",
        backgroundColor: "#0a0a12", // Updated to match new theme
        show: false,
    });

    mainWindow.once("ready-to-show", () => {
        mainWindow.show();
    });

    if (isDev) {
        mainWindow.loadURL("http://localhost:5174");
        mainWindow.webContents.openDevTools();
    } else {
        mainWindow.loadFile(path.join(__dirname, "../dist/index.html"));
    }

    return mainWindow;
}

app.whenReady().then(() => {
    // Initialize Database
    try {
        initDB();
    } catch (err) {
        console.error("Database initialization failed:", err);
    }

    createWindow();

    app.on("activate", () => {
        if (BrowserWindow.getAllWindows().length === 0) {
            createWindow();
        }
    });
});

app.on("window-all-closed", () => {
    if (process.platform !== "darwin") {
        app.quit();
    }
});

// IPC Handlers
ipcMain.handle("app:version", () => app.getVersion());

// Database IPC
ipcMain.handle("db:stats", () => dbAPI.getDashboardStats());
ipcMain.handle("db:recent-calls", () => dbAPI.getRecentCalls());
ipcMain.handle("db:all-calls", () => dbAPI.getAllCalls());
ipcMain.handle("db:settings", () => dbAPI.getSettings());
ipcMain.handle("db:save-setting", (_, { key, value }) =>
    dbAPI.saveSetting(key, value),
);

// Voice Processing IPC
ipcMain.handle("voice:start-recording", async () => {
    console.log("Starting voice recording...");
    return { success: true };
});

ipcMain.handle("voice:stop-recording", async () => {
    console.log("Stopping voice recording...");
    return { success: true };
});

// Call Management IPC
ipcMain.handle("call:initiate", async (event, phoneNumber) => {
    console.log("Initiating call to:", phoneNumber);
    return { success: true, callId: Date.now().toString() };
});

ipcMain.handle("call:hangup", async (event, callId) => {
    console.log("Hanging up call:", callId);
    return { success: true };
});

// Model Management IPC
ipcMain.handle("model:list", async () => {
    return {
        voice: [],
        llm: [],
    };
});

ipcMain.handle("model:train", async (event, config) => {
    console.log("Starting model training:", config);
    return { success: true, jobId: Date.now().toString() };
});

// TTS - F5-TTS Vietnamese via Python CLI
import fs from "fs";

const PYTHON_SCRIPT = path.join(__dirname, "..", "python", "f5_tts.py");
const TTS_OUTPUT_DIR = path.join(__dirname, "..", "python", "outputs");
const REF_AUDIO_DIR = path.join(__dirname, "..", "python", "ref_audio");

// Ensure directories exist
[TTS_OUTPUT_DIR, REF_AUDIO_DIR].forEach((dir) => {
    if (!fs.existsSync(dir)) {
        fs.mkdirSync(dir, { recursive: true });
    }
});

// Helper to run Python script using venv
function runPython(args) {
    return new Promise((resolve, reject) => {
        const pythonDir = path.join(__dirname, "..", "python");
        const venvPython = path.join(pythonDir, "venv", "bin", "python3");
        const python = spawn(venvPython, [PYTHON_SCRIPT, ...args], {
            cwd: pythonDir,
        });
        let stdout = "";
        let stderr = "";

        python.stdout.on("data", (data) => {
            stdout += data.toString();
        });

        python.stderr.on("data", (data) => {
            stderr += data.toString();
        });

        python.on("close", (code) => {
            if (code === 0) {
                try {
                    // Get last JSON line
                    const lines = stdout.trim().split("\n");
                    const lastLine = lines[lines.length - 1];
                    resolve(JSON.parse(lastLine));
                } catch (e) {
                    resolve({ raw: stdout });
                }
            } else {
                reject(new Error(stderr || `Python exited with code ${code}`));
            }
        });

        python.on("error", (err) => {
            reject(err);
        });
    });
}

ipcMain.handle("tts:status", async () => {
    try {
        const result = await runPython(["check"]);
        return {
            ready: result.ready,
            engine: "F5-TTS Vietnamese",
            model_exists: result.model_exists,
            cli_available: result.cli_available,
        };
    } catch (error) {
        return {
            ready: false,
            error: error.message,
            engine: "F5-TTS Vietnamese (not installed)",
        };
    }
});

ipcMain.handle("tts:install", async () => {
    try {
        const result = await runPython(["install"]);
        return { success: true, ...result };
    } catch (error) {
        return { success: false, error: error.message };
    }
});

ipcMain.handle("tts:upload-ref", async (event, { audioData, filename }) => {
    try {
        const refPath = path.join(
            REF_AUDIO_DIR,
            filename || `ref_${Date.now()}.wav`,
        );

        // audioData is ArrayBuffer from renderer
        const buffer = Buffer.from(audioData);
        fs.writeFileSync(refPath, buffer);

        return {
            success: true,
            path: refPath,
            filename: path.basename(refPath),
        };
    } catch (error) {
        return { success: false, error: error.message };
    }
});

ipcMain.handle("tts:generate", async (event, config) => {
    try {
        const { refAudio, refText, genText, speed = 1.0 } = config;

        if (!refAudio || !genText) {
            return { success: false, error: "Missing refAudio or genText" };
        }

        const result = await runPython([
            "generate",
            "--ref-audio",
            refAudio,
            "--ref-text",
            refText || "",
            "--gen-text",
            genText,
            "--speed",
            String(speed),
        ]);

        if (result.success) {
            return {
                success: true,
                audioPath: result.output,
                genText: result.gen_text,
            };
        } else {
            return { success: false, error: result.error };
        }
    } catch (error) {
        console.error("F5-TTS error:", error);
        return { success: false, error: error.message };
    }
});

// Get list of reference audios
ipcMain.handle("tts:list-refs", () => {
    try {
        if (!fs.existsSync(REF_AUDIO_DIR)) return [];
        const files = fs
            .readdirSync(REF_AUDIO_DIR)
            .filter((f) => f.endsWith(".wav") || f.endsWith(".webm"))
            .map((f) => ({
                filename: f,
                path: path.join(REF_AUDIO_DIR, f),
            }));
        return files;
    } catch (error) {
        console.error("List refs error:", error);
        return [];
    }
});

// Get list of generated audio outputs
ipcMain.handle("tts:list-outputs", () => {
    try {
        if (!fs.existsSync(TTS_OUTPUT_DIR)) return [];
        const files = fs
            .readdirSync(TTS_OUTPUT_DIR)
            .filter((f) => f.endsWith(".wav") || f.endsWith(".mp3"))
            .map((f) => ({
                filename: f,
                path: path.join(TTS_OUTPUT_DIR, f),
                stats: fs.statSync(path.join(TTS_OUTPUT_DIR, f)),
            }))
            .sort((a, b) => b.stats.mtimeMs - a.stats.mtimeMs); // Newest first
        return files;
    } catch (error) {
        console.error("List outputs error:", error);
        return [];
    }
});

// Delete reference audio
ipcMain.handle("tts:delete-ref", async (event, filepath) => {
    try {
        // Security: only allow deleting files in REF_AUDIO_DIR
        const normalizedPath = path.normalize(filepath);
        const normalizedRefDir = path.normalize(REF_AUDIO_DIR);

        if (!normalizedPath.startsWith(normalizedRefDir)) {
            return { success: false, error: "Invalid file path" };
        }

        if (fs.existsSync(filepath)) {
            fs.unlinkSync(filepath);
            console.log("Deleted reference audio:", filepath);
            return { success: true };
        } else {
            return { success: false, error: "File not found" };
        }
    } catch (error) {
        console.error("Error deleting reference audio:", error);
        return { success: false, error: error.message };
    }
});

// Convert WebM to WAV using ffmpeg for better TTS quality
ipcMain.handle("tts:convert-to-wav", async (event, webmPath) => {
    console.log("=== CONVERT TO WAV ===");
    console.log("Input WebM:", webmPath);

    try {
        const wavPath = webmPath.replace(".webm", ".wav");

        // Security check: only convert files in REF_AUDIO_DIR
        const normalizedWebm = path.normalize(webmPath);
        const normalizedRefDir = path.normalize(REF_AUDIO_DIR);

        if (!normalizedWebm.startsWith(normalizedRefDir)) {
            return { success: false, error: "Invalid file path" };
        }

        // Check if input exists
        if (!fs.existsSync(webmPath)) {
            return { success: false, error: "Input file not found" };
        }

        console.log("Converting to WAV with ffmpeg...");

        // Run ffmpeg conversion
        return new Promise((resolve, reject) => {
            const ffmpeg = spawn("ffmpeg", [
                "-i",
                webmPath,
                "-ar",
                "24000", // 24kHz (optimal for TTS)
                "-ac",
                "1", // Mono
                "-sample_fmt",
                "s16", // 16-bit PCM
                "-y", // Overwrite
                wavPath,
            ]);

            let stderr = "";
            let stdout = "";

            ffmpeg.stdout.on("data", (data) => {
                const output = data.toString();
                stdout += output;
                console.log("ffmpeg stdout:", output);
            });

            ffmpeg.stderr.on("data", (data) => {
                const output = data.toString();
                stderr += output;
                console.log("ffmpeg stderr:", output);
            });

            ffmpeg.on("close", (code) => {
                console.log("ffmpeg process closed with code:", code);
                console.log("Full stderr:", stderr);
                console.log("Full stdout:", stdout);

                if (code === 0) {
                    console.log("Conversion successful:", wavPath);

                    // Verify output file exists
                    if (!fs.existsSync(wavPath)) {
                        console.error("WAV file was not created!");
                        reject(new Error("WAV file not created"));
                        return;
                    }

                    // Delete original WebM file
                    try {
                        fs.unlinkSync(webmPath);
                        console.log("Deleted original WebM file");
                    } catch (e) {
                        console.warn("Could not delete WebM:", e);
                    }
                    resolve({ success: true, wavPath: wavPath });
                } else {
                    console.error("ffmpeg failed with code:", code);
                    console.error("stderr:", stderr);
                    reject(
                        new Error(`ffmpeg exited with code ${code}: ${stderr}`),
                    );
                }
            });

            ffmpeg.on("error", (err) => {
                console.error("ffmpeg spawn error:", err);
                reject(err);
            });
        });
    } catch (error) {
        console.error("Conversion error:", error);
        return { success: false, error: error.message };
    }
});

// Read audio file and return as buffer
ipcMain.handle("tts:read-audio", async (event, filepath) => {
    console.log("=== READ AUDIO FILE CALLED ===");
    console.log("Requested filepath:", filepath);
    console.log("REF_AUDIO_DIR:", REF_AUDIO_DIR);
    console.log("TTS_OUTPUT_DIR:", TTS_OUTPUT_DIR);

    try {
        // Security: only allow reading files in REF_AUDIO_DIR or TTS_OUTPUT_DIR
        const normalizedPath = path.normalize(filepath);
        const normalizedRefDir = path.normalize(REF_AUDIO_DIR);
        const normalizedOutputDir = path.normalize(TTS_OUTPUT_DIR);

        console.log("Normalized filepath:", normalizedPath);
        console.log("Normalized ref dir:", normalizedRefDir);
        console.log("Normalized output dir:", normalizedOutputDir);

        const isInRefDir = normalizedPath.startsWith(normalizedRefDir);
        const isInOutputDir = normalizedPath.startsWith(normalizedOutputDir);

        console.log("Path in ref dir?", isInRefDir);
        console.log("Path in output dir?", isInOutputDir);

        if (!isInRefDir && !isInOutputDir) {
            console.error(
                "SECURITY CHECK FAILED: Path not in allowed directories",
            );
            return { success: false, error: "Invalid file path" };
        }

        console.log("Security check passed");

        if (!fs.existsSync(normalizedPath)) {
            console.error("File not found at path:", normalizedPath);
            return { success: false, error: "File not found" };
        }

        console.log("Reading file...");
        const audioBuffer = await fs.promises.readFile(normalizedPath);
        console.log(
            "File read successfully, size:",
            audioBuffer.length,
            "bytes",
        );

        // Determine MIME type from file extension
        const ext = path.extname(normalizedPath).toLowerCase();
        const mimeType =
            ext === ".wav"
                ? "audio/wav"
                : ext === ".webm"
                  ? "audio/webm"
                  : ext === ".mp3"
                    ? "audio/mpeg"
                    : "audio/wav";

        return {
            success: true,
            data: Array.from(audioBuffer), // Convert Buffer to array for IPC transfer
            mimeType: mimeType,
        };
    } catch (error) {
        console.error("Error reading audio file:", error);
        return { success: false, error: error.message };
    }
});

// Transcribe audio to text using Whisper
ipcMain.handle("tts:transcribe-audio", async (event, audioPath) => {
    console.log("=== TRANSCRIBE AUDIO CALLED ===");
    console.log("Audio path:", audioPath);

    try {
        // Validate file exists
        if (!fs.existsSync(audioPath)) {
            return { success: false, error: "Audio file not found" };
        }

        const pythonPath = path.join(__dirname, "../python/venv/bin/python3");
        const scriptPath = path.join(__dirname, "../python/transcribe.py");

        console.log("Python path:", pythonPath);
        console.log("Script path:", scriptPath);
        console.log("Spawning transcription process...");

        return new Promise((resolve, reject) => {
            const transcribe = spawn(pythonPath, [
                scriptPath,
                audioPath,
                "medium",
            ]);
            let stdout = "";
            let stderr = "";

            transcribe.stdout.on("data", (data) => {
                stdout += data.toString();
            });

            transcribe.stderr.on("data", (data) => {
                stderr += data.toString();
            });

            transcribe.on("close", (code) => {
                console.log("Transcription process closed with code:", code);
                console.log("Stdout:", stdout);

                if (code === 0) {
                    try {
                        const result = JSON.parse(stdout);
                        resolve(result);
                    } catch (e) {
                        resolve({
                            success: false,
                            error: "Failed to parse transcription result",
                        });
                    }
                } else {
                    resolve({
                        success: false,
                        error: `Transcription failed with code ${code}`,
                    });
                }
            });

            transcribe.on("error", (err) => {
                console.error("Transcription spawn error:", err);
                resolve({ success: false, error: err.message });
            });
        });
    } catch (error) {
        console.error("Transcription error:", error);
        return { success: false, error: error.message };
    }
});

// Qwen3 - Local AI text processing via Ollama
ipcMain.handle("qwen:process-text", async (event, text, task = "correct") => {
    console.log("=== QWEN PROCESS TEXT CALLED ===");
    console.log("Text:", text);
    console.log("Task:", task);

    try {
        const prompts = {
            correct: `B·∫°n l√† tr·ª£ l√Ω AI chuy√™n s·ª≠a l·ªói ch√≠nh t·∫£ v√† ng·ªØ ph√°p ti·∫øng Vi·ªát. H√£y s·ª≠a vƒÉn b·∫£n sau th√†nh ch√≠nh t·∫£ ƒë√∫ng, ng·ªØ ph√°p chu·∫©n, gi·ªØ nguy√™n √Ω nghƒ©a. Ch·ªâ tr·∫£ v·ªÅ vƒÉn b·∫£n ƒë√£ s·ª≠a, kh√¥ng gi·∫£i th√≠ch:\n\n${text}`,
            extract: `H√£y ph√¢n t√≠ch vƒÉn b·∫£n sau v√† tr√≠ch xu·∫•t th√¥ng tin quan tr·ªçng d∆∞·ªõi d·∫°ng JSON (intent, entities, sentiment):\n\n${text}`,
            answer: `D·ª±a v√†o vƒÉn b·∫£n sau, h√£y tr·∫£ l·ªùi c√¢u h·ªèi m·ªôt c√°ch ng·∫Øn g·ªçn:\n\n${text}`,
            custom: text,
        };

        const prompt = prompts[task] || prompts.custom;

        const response = await fetch("http://localhost:11434/api/generate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                model: "qwen:4b",
                prompt: prompt,
                stream: false,
                options: {
                    temperature: 0.3,
                    top_p: 0.9,
                },
            }),
        });

        if (!response.ok) {
            throw new Error(`Ollama API error: ${response.status}`);
        }

        const data = await response.json();
        console.log("Qwen response:", data.response);

        return {
            success: true,
            text: data.response.trim(),
            model: "qwen:4b",
            task: task,
        };
    } catch (error) {
        console.error("Qwen processing error:", error);
        // Return original text if Qwen is not available (optional feature)
        return {
            success: true,
            text: text, // Original text without correction
            model: "none",
            task: task,
            warning: "Qwen not available - returned original text",
        };
    }
});

// Cleanup old TTS files periodically
setInterval(
    () => {
        const oneHourAgo = Date.now() - 60 * 60 * 1000;
        try {
            const files = fs.readdirSync(TTS_OUTPUT_DIR);
            files.forEach((file) => {
                const filePath = path.join(TTS_OUTPUT_DIR, file);
                const stats = fs.statSync(filePath);
                if (stats.mtimeMs < oneHourAgo) {
                    fs.unlinkSync(filePath);
                }
            });
        } catch (e) {
            /* ignore */
        }
    },
    30 * 60 * 1000,
);
</file>

<file path="electron/preload.js">
const { contextBridge, ipcRenderer } = require("electron");

// Expose protected APIs to renderer
contextBridge.exposeInMainWorld("electronAPI", {
  // App
  getVersion: () => ipcRenderer.invoke("app:version"),

  // Database
  db: {
    getStats: () => ipcRenderer.invoke("db:stats"),
    getRecentCalls: () => ipcRenderer.invoke("db:recent-calls"),
    getAllCalls: () => ipcRenderer.invoke("db:all-calls"),
    getSettings: () => ipcRenderer.invoke("db:settings"),
    saveSetting: (key, value) =>
      ipcRenderer.invoke("db:save-setting", { key, value }),
  },

  // Voice
  voice: {
    startRecording: () => ipcRenderer.invoke("voice:start-recording"),
    stopRecording: () => ipcRenderer.invoke("voice:stop-recording"),
    onTranscription: (callback) =>
      ipcRenderer.on("voice:transcription", callback),
    onResponse: (callback) => ipcRenderer.on("voice:response", callback),
  },

  // Call
  call: {
    initiate: (phoneNumber) => ipcRenderer.invoke("call:initiate", phoneNumber),
    hangup: (callId) => ipcRenderer.invoke("call:hangup", callId),
    onIncoming: (callback) => ipcRenderer.on("call:incoming", callback),
    onStatus: (callback) => ipcRenderer.on("call:status", callback),
    onEnded: (callback) => ipcRenderer.on("call:ended", callback),
  },

  // Model
  model: {
    list: () => ipcRenderer.invoke("model:list"),
    train: (config) => ipcRenderer.invoke("model:train", config),
    onProgress: (callback) => ipcRenderer.on("model:progress", callback),
    onComplete: (callback) => ipcRenderer.on("model:complete", callback),
  },

  // Training
  training: {
    uploadSamples: (files) => ipcRenderer.invoke("training:upload", files),
    startVoiceTraining: (config) =>
      ipcRenderer.invoke("training:voice", config),
    startLLMTraining: (config) => ipcRenderer.invoke("training:llm", config),
  },

  // History
  history: {
    getConversations: (filters) =>
      ipcRenderer.invoke("history:conversations", filters),
    getCallHistory: (filters) => ipcRenderer.invoke("history:calls", filters),
  },

  // TTS - F5-TTS Vietnamese (Voice Cloning)
  tts: {
    getStatus: () => ipcRenderer.invoke("tts:status"),
    install: () => ipcRenderer.invoke("tts:install"),
    uploadRef: (audioData, filename) =>
      ipcRenderer.invoke("tts:upload-ref", { audioData, filename }),
    listRefs: () => ipcRenderer.invoke("tts:list-refs"),
    listOutputs: () => ipcRenderer.invoke("tts:list-outputs"),
    deleteRef: (filepath) => ipcRenderer.invoke("tts:delete-ref", filepath),
    readAudio: (filepath) => ipcRenderer.invoke("tts:read-audio", filepath),
    transcribeAudio: (audioPath) =>
      ipcRenderer.invoke("tts:transcribe-audio", audioPath),
    convertToWav: (webmPath) =>
      ipcRenderer.invoke("tts:convert-to-wav", webmPath),
    generate: (config) => ipcRenderer.invoke("tts:generate", config),
  },

  // Qwen3 - Local AI
  qwen: {
    processText: (text, task) =>
      ipcRenderer.invoke("qwen:process-text", text, task),
  },
});
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="python/f5_tts.py">
#!/usr/bin/env python3
"""
F5-TTS Vietnamese CLI
S·ª≠ d·ª•ng: python f5_tts.py --ref-audio ref.wav --ref-text "text" --gen-text "text to generate" --output out.wav

C√†i ƒë·∫∑t:
    git clone https://github.com/nguyenthienhy/F5-TTS-Vietnamese
    cd F5-TTS-Vietnamese && pip install -e .
    git lfs install
    git clone https://huggingface.co/hynt/F5-TTS-Vietnamese-ViVoice
"""

import os
import sys
import json
import argparse
import subprocess
from pathlib import Path

# ƒê∆∞·ªùng d·∫´n m·∫∑c ƒë·ªãnh
SCRIPT_DIR = Path(__file__).parent.absolute()
MODEL_DIR = SCRIPT_DIR / "F5-TTS-Vietnamese-ViVoice"
OUTPUT_DIR = SCRIPT_DIR / "outputs"

VOCAB_FILE = MODEL_DIR / "vocab.txt"
CKPT_FILE = MODEL_DIR / "model_last.pt"


def check_installation():
    """Ki·ªÉm tra F5-TTS ƒë√£ c√†i ƒë·∫∑t ch∆∞a"""
    # Check CLI in venv/bin instead of system PATH
    venv_cli = SCRIPT_DIR / "venv" / "bin" / "f5-tts_infer-cli"
    cli_available = venv_cli.exists()
    
    return {
        "model_exists": CKPT_FILE.exists(),
        "vocab_exists": VOCAB_FILE.exists(),
        "cli_available": cli_available,
        "model_dir": str(MODEL_DIR),
        "ready": CKPT_FILE.exists() and VOCAB_FILE.exists() and cli_available
    }


def install_f5tts():
    """C√†i ƒë·∫∑t F5-TTS v√† t·∫£i model"""
    print(json.dumps({"status": "installing", "step": "clone_repo"}))
    
    f5_dir = SCRIPT_DIR / "F5-TTS-Vietnamese"
    if not f5_dir.exists():
        subprocess.run([
            "git", "clone", 
            "https://github.com/nguyenthienhy/F5-TTS-Vietnamese",
            str(f5_dir)
        ], check=True)
    
    print(json.dumps({"status": "installing", "step": "pip_install"}))
    subprocess.run([
        sys.executable, "-m", "pip", "install", "-e", str(f5_dir)
    ], check=True)
    
    print(json.dumps({"status": "installing", "step": "download_model"}))
    if not MODEL_DIR.exists():
        subprocess.run(["git", "lfs", "install"], check=True)
        subprocess.run([
            "git", "clone",
            "https://huggingface.co/hynt/F5-TTS-Vietnamese-ViVoice",
            str(MODEL_DIR)
        ], check=True)
    
    print(json.dumps({"status": "complete", "ready": True}))


def generate(ref_audio: str, ref_text: str, gen_text: str, output: str = None, speed: float = 1.0):
    """T·∫°o gi·ªçng n√≥i v·ªõi F5-TTS"""
    
    # Ki·ªÉm tra model
    status = check_installation()
    if not status["ready"]:
        print(json.dumps({"error": "F5-TTS ch∆∞a ƒë∆∞·ª£c c√†i ƒë·∫∑t", "status": status}))
        sys.exit(1)
    
    # T·∫°o output path
    OUTPUT_DIR.mkdir(exist_ok=True)
    if output is None:
        import time
        output = str(OUTPUT_DIR / f"generated_{int(time.time() * 1000)}.wav")
    
    output_dir = Path(output).parent
    output_file = Path(output).name
    
    # Ch·∫°y f5-tts_infer-cli from venv
    venv_cli = SCRIPT_DIR / "venv" / "bin" / "f5-tts_infer-cli"
    cmd = [
        str(venv_cli),
        "--model", "F5TTS_Base",
        "--ref_audio", ref_audio,
        "--ref_text", ref_text,
        "--gen_text", gen_text,
        "--vocoder_name", "vocos",
        "--vocab_file", str(VOCAB_FILE),
        "--ckpt_file", str(CKPT_FILE),
        "--output_dir", str(output_dir),
    ]
    
    # Log command for debugging
    print(f"DEBUG: Running command: {' '.join(cmd)}", file=sys.stderr)
    
    result = subprocess.run(cmd, capture_output=True, text=True)
    
    # Log subprocess output for debugging
    print(f"DEBUG: Return code: {result.returncode}", file=sys.stderr)
    print(f"DEBUG: stdout: {result.stdout}", file=sys.stderr)
    print(f"DEBUG: stderr: {result.stderr}", file=sys.stderr)
    
    if result.returncode != 0:
        print(json.dumps({
            "success": False,
            "error": result.stderr or result.stdout
        }))
        sys.exit(1)
    
    # T√¨m file output m·ªõi nh·∫•t
    import shutil
    output_files = sorted(output_dir.glob("*.wav"), key=lambda f: f.stat().st_mtime, reverse=True)
    if output_files:
        latest = output_files[0]
        if str(latest) != output:
            shutil.move(str(latest), output)
    
    print(json.dumps({
        "success": True,
        "output": output,
        "ref_audio": ref_audio,
        "gen_text": gen_text[:50]
    }))


def main():
    parser = argparse.ArgumentParser(description="F5-TTS Vietnamese CLI")
    subparsers = parser.add_subparsers(dest="command", help="Commands")
    
    # Check command
    check_parser = subparsers.add_parser("check", help="Ki·ªÉm tra c√†i ƒë·∫∑t")
    
    # Install command  
    install_parser = subparsers.add_parser("install", help="C√†i ƒë·∫∑t F5-TTS")
    
    # Generate command
    gen_parser = subparsers.add_parser("generate", help="T·∫°o gi·ªçng n√≥i")
    gen_parser.add_argument("--ref-audio", required=True, help="File audio m·∫´u (3-30s)")
    gen_parser.add_argument("--ref-text", required=True, help="Transcript c·ªßa audio m·∫´u")
    gen_parser.add_argument("--gen-text", required=True, help="VƒÉn b·∫£n c·∫ßn t·∫°o gi·ªçng")
    gen_parser.add_argument("--output", help="File output (m·∫∑c ƒë·ªãnh: outputs/generated_xxx.wav)")
    gen_parser.add_argument("--speed", type=float, default=1.0, help="T·ªëc ƒë·ªô ƒë·ªçc (1.0 = b√¨nh th∆∞·ªùng)")
    
    args = parser.parse_args()
    
    if args.command == "check":
        status = check_installation()
        print(json.dumps(status))
    
    elif args.command == "install":
        install_f5tts()
    
    elif args.command == "generate":
        generate(
            ref_audio=args.ref_audio,
            ref_text=args.ref_text,
            gen_text=args.gen_text,
            output=args.output,
            speed=args.speed
        )
    
    else:
        parser.print_help()


if __name__ == "__main__":
    main()
</file>

<file path="python/README.md">
# F5-TTS Vietnamese Voice Bot

## C√†i ƒë·∫∑t F5-TTS

### T·ª± ƒë·ªông (trong Electron)
M·ªü Voice Training > Nh·∫•n "C√†i ƒë·∫∑t t·ª± ƒë·ªông"

### Th·ªß c√¥ng
```bash
cd python

# Clone F5-TTS Vietnamese
git clone https://github.com/nguyenthienhy/F5-TTS-Vietnamese

# C√†i ƒë·∫∑t
cd F5-TTS-Vietnamese && pip install -e .

# T·∫£i model (~5GB)
cd ..
git lfs install
git clone https://huggingface.co/hynt/F5-TTS-Vietnamese-ViVoice
```

## S·ª≠ d·ª•ng CLI

### Ki·ªÉm tra c√†i ƒë·∫∑t
```bash
python f5_tts.py check
```

### T·∫°o gi·ªçng n√≥i
```bash
python f5_tts.py generate \
  --ref-audio ref_audio/sample.wav \
  --ref-text "N·ªôi dung audio m·∫´u ƒëang ƒë·ªçc" \
  --gen-text "VƒÉn b·∫£n c·∫ßn t·∫°o gi·ªçng n√≥i" \
  --speed 1.0
```

## C√°ch ho·∫°t ƒë·ªông

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Electron App (React)                           ‚îÇ
‚îÇ  VoiceTraining.jsx                              ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ Thu √¢m gi·ªçng m·∫´u (3-10s)                ‚îÇ
‚îÇ    ‚îú‚îÄ‚îÄ Upload ‚Üí python/ref_audio/              ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ G·ªçi tts:generate                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ IPC invoke
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Electron Main (main.js)                        ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ spawn python3 f5_tts.py generate ...    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ subprocess
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Python CLI (f5_tts.py)                         ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ f5-tts_infer-cli                        ‚îÇ
‚îÇ         ‚îú‚îÄ‚îÄ Model: F5-TTS-Vietnamese-ViVoice   ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ Output: outputs/generated_xxx.wav  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## C·∫•u tr√∫c th∆∞ m·ª•c

```
python/
‚îú‚îÄ‚îÄ f5_tts.py                      # CLI script
‚îú‚îÄ‚îÄ F5-TTS-Vietnamese/             # F5-TTS repo (git clone)
‚îú‚îÄ‚îÄ F5-TTS-Vietnamese-ViVoice/     # Model (HuggingFace)
‚îÇ   ‚îú‚îÄ‚îÄ model_last.pt              # Checkpoint (~1.5GB)
‚îÇ   ‚îî‚îÄ‚îÄ vocab.txt                  # Vocabulary
‚îú‚îÄ‚îÄ ref_audio/                     # Gi·ªçng m·∫´u (upload t·ª´ UI)
‚îÇ   ‚îú‚îÄ‚îÄ ref_1706812345678.wav
‚îÇ   ‚îî‚îÄ‚îÄ sample.wav
‚îî‚îÄ‚îÄ outputs/                       # Audio ƒë√£ t·∫°o
    ‚îî‚îÄ‚îÄ generated_1706812345.wav
```

## Y√™u c·∫ßu h·ªá th·ªëng
- Python 3.10+
- RAM 8GB+
- GPU v·ªõi CUDA (khuy·∫øn ngh·ªã, c√≥ th·ªÉ ch·∫°y CPU nh∆∞ng ch·∫≠m)
- Dung l∆∞·ª£ng: ~6GB cho model

## Model info
- **Ngu·ªìn**: [hynt/F5-TTS-Vietnamese-ViVoice](https://huggingface.co/hynt/F5-TTS-Vietnamese-ViVoice)
- **Dataset**: ~1000h d·ªØ li·ªáu ti·∫øng Vi·ªát
- **Kh·∫£ nƒÉng**: Zero-shot voice cloning t·ª´ 3-30s audio m·∫´u
</file>

<file path="python/transcribe.py">
#!/usr/bin/env python3
"""
Audio Transcription Script using OpenAI Whisper
Converts audio (WAV, WebM, MP3) to text in Vietnamese
"""

import sys
import json
import os
import warnings
warnings.filterwarnings("ignore")

def transcribe_audio(audio_path, model_name="base"):
    """
    Transcribe audio file to text using Whisper
    
    Args:
        audio_path: Path to audio file
        model_name: Whisper model size (tiny, base, small, medium, large)
    
    Returns:
        dict: {"success": bool, "text": str, "error": str}
    """
    try:
        import whisper
        
        # Validate file exists
        if not os.path.exists(audio_path):
            return {
                "success": False,
                "error": f"File not found: {audio_path}"
            }
        
        # Load model (cached after first run)
        print(f"Loading Whisper model: {model_name}...", file=sys.stderr)
        model = whisper.load_model(model_name)
        
        # Transcribe with Vietnamese language hint
        print(f"Transcribing: {audio_path}...", file=sys.stderr)
        result = model.transcribe(
            audio_path,
            language="vi",  # Vietnamese language hint
            fp16=False,  # Use FP32 for better CPU compatibility
            verbose=False
        )
        
        text = result["text"].strip()
        
        return {
            "success": True,
            "text": text,
            "language": result.get("language", "vi")
        }
        
    except ImportError as e:
        return {
            "success": False,
            "error": f"Whisper not installed: {str(e)}"
        }
    except Exception as e:
        return {
            "success": False,
            "error": f"Transcription failed: {str(e)}"
        }

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print(json.dumps({
            "success": False,
            "error": "Usage: python transcribe.py <audio_file> [model_name]"
        }))
        sys.exit(1)
    
    audio_path = sys.argv[1]
    model_name = sys.argv[2] if len(sys.argv) > 2 else "base"
    
    result = transcribe_audio(audio_path, model_name)
    print(json.dumps(result, ensure_ascii=False))
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/Layout.jsx">
import { NavLink } from 'react-router-dom'
import { LayoutDashboard, Phone, Mic, Brain, History, Settings, Bot, Menu, X, Zap, Database, MessageSquare } from 'lucide-react'
import { useState } from 'react'

const navigation = [
    { name: 'Dashboard', href: '/', icon: LayoutDashboard },
    { name: 'Call Center', href: '/calls', icon: Phone },
    { name: 'Voice Training', href: '/voice-training', icon: Mic },
    { name: 'Models', href: '/models', icon: Brain },
    { name: 'Training Data', href: '/training-data', icon: Database },
    { name: 'AI Chat', href: '/chat', icon: MessageSquare },
    { name: 'History', href: '/history', icon: History },
    { name: 'Settings', href: '/settings', icon: Settings },
]

export default function Layout({ children }) {
    const [sidebarOpen, setSidebarOpen] = useState(false)

    return (
        <div className="min-h-screen flex bg-[#0a0a12]">
            {/* Mobile Header */}
            <header className="lg:hidden fixed top-0 left-0 right-0 z-40 h-16 px-4 flex items-center justify-between bg-[#0d0d15]/95 backdrop-blur-xl border-b border-white/5 shadow-lg">
                <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center shadow-lg shadow-violet-500/25 animate-float">
                        <Bot className="w-5 h-5 text-white" />
                    </div>
                    <div>
                        <span className="text-base font-bold text-white">AI Voice Bot</span>
                        <span className="block text-2xs text-slate-500">Professional v2.1</span>
                    </div>
                </div>
                <button
                    onClick={() => setSidebarOpen(!sidebarOpen)}
                    className="w-11 h-11 rounded-xl bg-white/5 flex items-center justify-center text-white/70 hover:bg-white/10 hover:text-white active:scale-95 transition-all duration-200 touch-target"
                >
                    {sidebarOpen ? <X className="w-5 h-5" /> : <Menu className="w-5 h-5" />}
                </button>
            </header>

            {/* Mobile Overlay */}
            {sidebarOpen && (
                <div
                    className="lg:hidden fixed inset-0 z-40 bg-black/70 backdrop-blur-sm"
                    onClick={() => setSidebarOpen(false)}
                />
            )}

            {/* Sidebar - Pure Tailwind */}
            <aside className={`
                fixed lg:sticky top-0 left-0 z-50 h-screen w-72
                bg-[#0d0d15] border-r border-white/5
                flex flex-col
                transition-transform duration-300 ease-out
                lg:translate-x-0
                ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'}
            `}>
                {/* Logo */}
                <div className="h-16 px-6 flex items-center gap-3 border-b border-white/5">
                    <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center shadow-lg shadow-violet-500/25">
                        <Bot className="w-5 h-5 text-white" />
                    </div>
                    <div>
                        <h1 className="text-base font-bold text-white">AI Voice Bot</h1>
                        <p className="text-xs text-slate-500">Professional v2.0</p>
                    </div>
                </div>

                {/* Navigation */}
                <nav className="flex-1 px-4 py-6 space-y-1.5 overflow-y-auto">
                    {navigation.map((item) => (
                        <NavLink
                            key={item.name}
                            to={item.href}
                            onClick={() => setSidebarOpen(false)}
                            className={({ isActive }) =>
                                `flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all duration-200
                                ${isActive
                                    ? 'bg-gradient-to-r from-violet-500/20 to-purple-500/10 text-white border border-violet-500/20 shadow-[0_0_24px_-6px_rgba(139,92,246,0.4)]'
                                    : 'text-slate-400 hover:text-white hover:bg-white/5'
                                }`
                            }
                        >
                            {({ isActive }) => (
                                <>
                                    <item.icon className={`w-5 h-5 transition-colors ${isActive ? 'text-violet-400' : 'text-slate-500'}`} />
                                    <span>{item.name}</span>
                                    {isActive && (
                                        <div className="ml-auto w-1.5 h-1.5 rounded-full bg-violet-400" />
                                    )}
                                </>
                            )}
                        </NavLink>
                    ))}
                </nav>

                {/* Bottom Status */}
                <div className="p-4 border-t border-white/5">
                    <div className="flex items-center gap-3 px-4 py-3 rounded-xl bg-emerald-500/5 border border-emerald-500/10 hover:bg-emerald-500/10 transition-colors cursor-pointer group">
                        <div className="relative w-9 h-9 rounded-lg bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center">
                            <Zap className="w-4 h-4 text-white" />
                            <span className="absolute -top-1 -right-1 w-3 h-3 bg-emerald-400 rounded-full animate-pulse border-2 border-[#0d0d15]" />
                        </div>
                        <div>
                            <p className="text-sm font-medium text-emerald-400 group-hover:text-emerald-300">System Ready</p>
                            <p className="text-xs text-slate-500">All services online</p>
                        </div>
                    </div>
                    <p className="mt-3 text-center text-[11px] text-slate-600">v2.1.0 ‚Ä¢ Built with Electron</p>
                </div>
            </aside>

            {/* Main Content */}
            <main className="flex-1 pt-16 lg:pt-0 min-h-screen relative overflow-hidden">
                {/* Ambient background glow */}
                <div className="absolute inset-0 overflow-hidden pointer-events-none">
                    <div className="absolute top-0 left-1/4 w-80 h-80 md:w-96 md:h-96 bg-violet-500/5 rounded-full blur-[120px] animate-pulse" style={{ animationDuration: '4s' }} />
                    <div className="absolute bottom-0 right-1/4 w-64 h-64 md:w-80 md:h-80 bg-cyan-500/5 rounded-full blur-[100px] animate-pulse" style={{ animationDuration: '6s', animationDelay: '2s' }} />
                </div>

                <div className="p-4 md:p-6 lg:p-10 relative z-10">
                    {children}
                </div>
            </main>
        </div>
    )
}
</file>

<file path="src/components/WaveformVisualizer.jsx">
import { useEffect, useRef } from 'react'

export default function WaveformVisualizer({ isActive = false, color = 'violet' }) {
    const canvasRef = useRef(null)
    const animationRef = useRef(null)
    const barsRef = useRef([])

    const colorMap = {
        violet: { primary: '#8b5cf6', secondary: '#a78bfa', glow: 'rgba(139, 92, 246, 0.3)' },
        emerald: { primary: '#34d399', secondary: '#6ee7b7', glow: 'rgba(52, 211, 153, 0.3)' },
        cyan: { primary: '#22d3ee', secondary: '#67e8f9', glow: 'rgba(34, 211, 238, 0.3)' }
    }

    const colors = colorMap[color] || colorMap.violet

    useEffect(() => {
        const canvas = canvasRef.current
        if (!canvas) return

        const ctx = canvas.getContext('2d')
        const dpr = window.devicePixelRatio || 1

        // Set canvas size
        const rect = canvas.getBoundingClientRect()
        canvas.width = rect.width * dpr
        canvas.height = rect.height * dpr
        ctx.scale(dpr, dpr)

        const barCount = 50
        const barWidth = (rect.width / barCount) * 0.7
        const barGap = (rect.width / barCount) * 0.3

        // Initialize bars with random heights
        if (barsRef.current.length === 0) {
            barsRef.current = Array.from({ length: barCount }, () => ({
                height: Math.random() * 0.3 + 0.1,
                targetHeight: Math.random() * 0.3 + 0.1,
                velocity: 0
            }))
        }

        const animate = () => {
            ctx.clearRect(0, 0, rect.width, rect.height)

            barsRef.current.forEach((bar, i) => {
                // Update target height periodically
                if (isActive && Math.random() < 0.05) {
                    bar.targetHeight = Math.random() * 0.8 + 0.2
                } else if (!isActive && Math.random() < 0.02) {
                    bar.targetHeight = Math.random() * 0.3 + 0.1
                }

                // Smooth animation
                const diff = bar.targetHeight - bar.height
                bar.velocity += diff * 0.1
                bar.velocity *= 0.8
                bar.height += bar.velocity

                const x = i * (barWidth + barGap)
                const barHeight = bar.height * rect.height * 0.8
                const y = (rect.height - barHeight) / 2

                // Draw bar with gradient
                const gradient = ctx.createLinearGradient(x, y, x, y + barHeight)
                gradient.addColorStop(0, colors.secondary)
                gradient.addColorStop(1, colors.primary)

                ctx.fillStyle = gradient
                ctx.roundRect(x, y, barWidth, barHeight, barWidth / 2)
                ctx.fill()

                // Add glow effect when active
                if (isActive) {
                    ctx.shadowBlur = 10
                    ctx.shadowColor = colors.glow
                    ctx.fill()
                    ctx.shadowBlur = 0
                }
            })

            animationRef.current = requestAnimationFrame(animate)
        }

        animate()

        return () => {
            if (animationRef.current) {
                cancelAnimationFrame(animationRef.current)
            }
        }
    }, [isActive, color])

    return (
        <canvas
            ref={canvasRef}
            className="w-full h-full"
            style={{ width: '100%', height: '100%' }}
        />
    )
}
</file>

<file path="src/pages/CallCenter.jsx">
import { useState, useEffect } from 'react'
import { Phone, PhoneCall, PhoneOff, Mic, MicOff, Volume2, VolumeX, User, Clock, AlertCircle } from 'lucide-react'

export default function CallCenter() {
    const [isCallActive, setIsCallActive] = useState(false)
    const [isMuted, setIsMuted] = useState(false)
    const [isSpeakerOn, setIsSpeakerOn] = useState(true)
    const [callDuration, setCallDuration] = useState(0)
    const [phoneNumber, setPhoneNumber] = useState('')
    const [callQueue, setCallQueue] = useState([])

    useEffect(() => {
        let timer
        if (isCallActive) {
            timer = setInterval(() => {
                setCallDuration(prev => prev + 1)
            }, 1000)
        }
        return () => clearInterval(timer)
    }, [isCallActive])

    const formatDuration = (seconds) => {
        const mins = Math.floor(seconds / 60)
        const secs = seconds % 60
        return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`
    }

    const startCall = () => {
        if (phoneNumber.length >= 10) {
            setIsCallActive(true)
            setCallDuration(0)
        }
    }

    const endCall = () => {
        setIsCallActive(false)
        setCallDuration(0)
    }

    return (
        <div className="space-y-6 md:space-y-8">
            {/* Header */}
            <div>
                <h1 className="text-2xl md:text-3xl font-bold text-white tracking-tight">Call Center</h1>
                <p className="text-sm md:text-base text-slate-400 mt-1">Qu·∫£n l√Ω cu·ªôc g·ªçi v√† t∆∞∆°ng t√°c v·ªõi kh√°ch h√†ng</p>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8">
                {/* Dialer */}
                <div className="lg:col-span-2 space-y-4 md:space-y-6">
                    {/* Phone Input */}
                    <div className="rounded-2xl bg-white/[0.03] border border-white/10 p-5 md:p-6 hover:border-violet-500/20 transition-colors duration-300">
                        <label className="block text-xs md:text-sm font-medium text-slate-400 mb-2 md:mb-3">S·ªë ƒëi·ªán tho·∫°i</label>
                        <div className="flex flex-col sm:flex-row gap-3 md:gap-4">
                            <input
                                type="tel"
                                value={phoneNumber}
                                onChange={(e) => setPhoneNumber(e.target.value)}
                                placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i..."
                                className="flex-1 px-4 py-3 md:py-3.5 rounded-xl bg-[#0a0a12] border border-white/10 text-white placeholder-slate-500 text-base md:text-lg font-mono focus:outline-none focus:border-violet-500/50 focus:ring-2 focus:ring-violet-500/20 transition-all touch-target"
                                disabled={isCallActive}
                            />
                            {!isCallActive ? (
                                <button
                                    onClick={startCall}
                                    disabled={phoneNumber.length < 10}
                                    className="px-6 py-3 md:py-3.5 rounded-xl bg-gradient-to-r from-emerald-500 to-green-600 text-white font-medium flex items-center justify-center gap-2 hover:from-emerald-600 hover:to-green-700 hover:shadow-glow-emerald active:scale-95 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed touch-target"
                                >
                                    <PhoneCall className="w-5 h-5" />
                                    <span className="text-sm md:text-base">G·ªçi</span>
                                </button>
                            ) : (
                                <button
                                    onClick={endCall}
                                    className="px-6 py-3 md:py-3.5 rounded-xl bg-gradient-to-r from-rose-500 to-red-600 text-white font-medium flex items-center justify-center gap-2 hover:from-rose-600 hover:to-red-700 active:scale-95 transition-all duration-200 touch-target"
                                >
                                    <PhoneOff className="w-5 h-5" />
                                    <span className="text-sm md:text-base">K·∫øt th√∫c</span>
                                </button>
                            )}
                        </div>
                    </div>

                    {/* Active Call Panel */}
                    {isCallActive && (
                        <div className="rounded-2xl bg-gradient-to-br from-violet-500/10 to-purple-500/5 border border-violet-500/20 p-6 md:p-8 animate-scale-in">
                            <div className="text-center mb-6 md:mb-8">
                                <div className="w-20 h-20 md:w-24 md:h-24 rounded-full bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center mx-auto mb-4 animate-pulse shadow-glow-violet">
                                    <User className="w-10 h-10 md:w-12 md:h-12 text-white" />
                                </div>
                                <p className="text-xl md:text-2xl font-bold text-white font-mono">{phoneNumber}</p>
                                <div className="flex items-center justify-center gap-2 mt-2">
                                    <span className="w-2 h-2 rounded-full bg-emerald-400 animate-pulse" />
                                    <span className="text-sm md:text-base text-emerald-400 font-medium">ƒêang k·∫øt n·ªëi...</span>
                                </div>
                                <p className="text-3xl md:text-4xl font-bold text-white mt-4 font-mono">{formatDuration(callDuration)}</p>
                            </div>

                            <div className="flex justify-center gap-3 md:gap-4">
                                <button
                                    onClick={() => setIsMuted(!isMuted)}
                                    className={`w-14 h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center transition-all touch-target active:scale-90 ${isMuted ? 'bg-rose-500/20 text-rose-400 border border-rose-500/30' : 'bg-white/10 text-white hover:bg-white/20 border border-white/10'
                                        }`}
                                >
                                    {isMuted ? <MicOff className="w-6 h-6 md:w-7 md:h-7" /> : <Mic className="w-6 h-6 md:w-7 md:h-7" />}
                                </button>
                                <button
                                    onClick={() => setIsSpeakerOn(!isSpeakerOn)}
                                    className={`w-14 h-14 md:w-16 md:h-16 rounded-full flex items-center justify-center transition-all touch-target active:scale-90 ${!isSpeakerOn ? 'bg-rose-500/20 text-rose-400 border border-rose-500/30' : 'bg-white/10 text-white hover:bg-white/20 border border-white/10'
                                        }`}
                                >
                                    {isSpeakerOn ? <Volume2 className="w-6 h-6 md:w-7 md:h-7" /> : <VolumeX className="w-6 h-6 md:w-7 md:h-7" />}
                                </button>
                                <button
                                    onClick={endCall}
                                    className="w-14 h-14 md:w-16 md:h-16 rounded-full bg-gradient-to-br from-rose-500 to-red-600 text-white flex items-center justify-center hover:from-rose-600 hover:to-red-700 active:scale-90 transition-all touch-target"
                                >
                                    <PhoneOff className="w-6 h-6 md:w-7 md:h-7" />
                                </button>
                            </div>
                        </div>
                    )}

                    {/* Idle State */}
                    {!isCallActive && (
                        <div className="rounded-2xl bg-white/[0.03] border border-white/10 p-12 text-center">
                            <div className="w-20 h-20 rounded-2xl bg-slate-800/50 flex items-center justify-center mx-auto mb-4">
                                <Phone className="w-10 h-10 text-slate-500" />
                            </div>
                            <h3 className="text-xl font-semibold text-white mb-2">S·∫µn s√†ng g·ªçi</h3>
                            <p className="text-slate-400 max-w-md mx-auto">
                                Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i v√† nh·∫•n "G·ªçi" ƒë·ªÉ b·∫Øt ƒë·∫ßu cu·ªôc g·ªçi v·ªõi AI Voice Bot
                            </p>
                        </div>
                    )}
                </div>

                {/* Call Queue */}
                <div className="rounded-2xl bg-white/[0.03] border border-white/10 overflow-hidden">
                    <div className="px-6 py-5 border-b border-white/5">
                        <h2 className="text-lg font-bold text-white flex items-center gap-3">
                            <div className="w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                                <Clock className="w-4 h-4 text-cyan-400" />
                            </div>
                            H√†ng ƒë·ª£i
                        </h2>
                    </div>

                    {callQueue.length === 0 ? (
                        <div className="p-8 text-center">
                            <div className="w-12 h-12 rounded-xl bg-slate-800/50 flex items-center justify-center mx-auto mb-3">
                                <AlertCircle className="w-6 h-6 text-slate-500" />
                            </div>
                            <p className="text-slate-500 text-sm">Kh√¥ng c√≥ cu·ªôc g·ªçi trong h√†ng ƒë·ª£i</p>
                        </div>
                    ) : (
                        <div className="divide-y divide-white/5">
                            {callQueue.map((call, idx) => (
                                <div key={idx} className="px-6 py-4 hover:bg-white/[0.02] transition-colors">
                                    <p className="font-medium text-white">{call.phone}</p>
                                    <p className="text-sm text-slate-400">{call.time}</p>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            </div>
        </div>
    )
}
</file>

<file path="src/pages/Chat.jsx">
import { useState, useRef, useEffect } from 'react'
import { Send, Bot, User, RefreshCw, AlertCircle, Check, Trash2 } from 'lucide-react'

export default function Chat() {
    const [messages, setMessages] = useState([])
    const [input, setInput] = useState('')
    const [isLoading, setIsLoading] = useState(false)
    const [modelStatus, setModelStatus] = useState('checking')
    const messagesEndRef = useRef(null)

    useEffect(() => {
        checkModelStatus()
    }, [])

    useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' })
    }, [messages])

    const checkModelStatus = async () => {
        try {
            const response = await fetch('http://localhost:11434/api/tags')
            const data = await response.json()
            const hasQwen = data.models?.some(m => m.name.includes('qwen'))
            setModelStatus(hasQwen ? 'ready' : 'not_installed')
        } catch {
            setModelStatus('offline')
        }
    }

    const sendMessage = async () => {
        if (!input.trim() || isLoading) return

        const userMessage = { role: 'user', content: input }
        setMessages(prev => [...prev, userMessage])
        setInput('')
        setIsLoading(true)

        try {
            const result = await window.electronAPI.qwen.processText(input, 'custom')

            if (result.success) {
                setMessages(prev => [...prev, {
                    role: 'assistant',
                    content: result.text
                }])
            } else {
                throw new Error(result.error)
            }
        } catch (error) {
            setMessages(prev => [...prev, {
                role: 'assistant',
                content: `‚ùå L·ªói: ${error.message}`,
                isError: true
            }])
        }

        setIsLoading(false)
    }

    const clearChat = () => {
        setMessages([])
    }

    const getStatusBadge = () => {
        switch (modelStatus) {
            case 'ready':
                return (
                    <div className="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-emerald-500/10 text-emerald-400 text-sm">
                        <Check className="w-4 h-4" />
                        <span>Qwen 4B Ready</span>
                    </div>
                )
            case 'checking':
                return (
                    <div className="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-violet-500/10 text-violet-400 text-sm">
                        <RefreshCw className="w-4 h-4 animate-spin" />
                        <span>Checking...</span>
                    </div>
                )
            default:
                return (
                    <div className="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-rose-500/10 text-rose-400 text-sm">
                        <AlertCircle className="w-4 h-4" />
                        <span>Model Offline</span>
                    </div>
                )
        }
    }

    return (
        <div className="h-full flex flex-col">
            {/* Header */}
            <div className="flex items-center justify-between p-6 border-b border-white/10">
                <div>
                    <h1 className="text-3xl font-bold text-white tracking-tight">AI Chat</h1>
                    <p className="text-slate-400 mt-1">Test Qwen 4B LLM v·ªõi Vietnamese prompts</p>
                </div>
                <div className="flex items-center gap-3">
                    {getStatusBadge()}
                    {messages.length > 0 && (
                        <button
                            onClick={clearChat}
                            className="p-2 rounded-lg bg-white/5 hover:bg-rose-500/20 text-slate-400 hover:text-rose-400 transition-all"
                            title="Clear chat"
                        >
                            <Trash2 className="w-5 h-5" />
                        </button>
                    )}
                </div>
            </div>

            {/* Messages */}
            <div className="flex-1 overflow-y-auto p-6 space-y-4">
                {messages.length === 0 && (
                    <div className="h-full flex items-center justify-center">
                        <div className="text-center">
                            <div className="w-16 h-16 rounded-2xl bg-violet-500/10 flex items-center justify-center mx-auto mb-4">
                                <Bot className="w-8 h-8 text-violet-400" />
                            </div>
                            <h3 className="text-lg font-semibold text-white mb-2">B·∫Øt ƒë·∫ßu tr√≤ chuy·ªán</h3>
                            <p className="text-sm text-slate-500">G·ª≠i tin nh·∫Øn ƒë·ªÉ test Qwen 4B</p>
                        </div>
                    </div>
                )}

                {messages.map((msg, idx) => (
                    <div
                        key={idx}
                        className={`flex gap-4 ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}
                    >
                        {msg.role === 'assistant' && (
                            <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center flex-shrink-0">
                                <Bot className="w-5 h-5 text-white" />
                            </div>
                        )}
                        <div
                            className={`max-w-2xl rounded-2xl p-4 ${msg.role === 'user'
                                    ? 'bg-violet-500 text-white'
                                    : msg.isError
                                        ? 'bg-rose-500/10 border border-rose-500/20 text-rose-400'
                                        : 'bg-white/[0.03] border border-white/10 text-slate-200'
                                }`}
                        >
                            <p className="whitespace-pre-wrap">{msg.content}</p>
                        </div>
                        {msg.role === 'user' && (
                            <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center flex-shrink-0">
                                <User className="w-5 h-5 text-white" />
                            </div>
                        )}
                    </div>
                ))}

                {isLoading && (
                    <div className="flex gap-4">
                        <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center">
                            <Bot className="w-5 h-5 text-white" />
                        </div>
                        <div className="bg-white/[0.03] border border-white/10 rounded-2xl p-4">
                            <div className="flex gap-1">
                                <div className="w-2 h-2 bg-violet-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }}></div>
                                <div className="w-2 h-2 bg-violet-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }}></div>
                                <div className="w-2 h-2 bg-violet-400 rounded-full animate-bounce" style={{ animationDelay: '300ms' }}></div>
                            </div>
                        </div>
                    </div>
                )}

                <div ref={messagesEndRef} />
            </div>

            {/* Input */}
            <div className="p-6 border-t border-white/10">
                <div className="flex gap-3">
                    <input
                        type="text"
                        value={input}
                        onChange={(e) => setInput(e.target.value)}
                        onKeyPress={(e) => e.key === 'Enter' && sendMessage()}
                        placeholder="Nh·∫≠p tin nh·∫Øn..."
                        disabled={modelStatus !== 'ready' || isLoading}
                        className="flex-1 px-4 py-3 rounded-xl bg-white/[0.03] border border-white/10 text-white placeholder-slate-500 focus:outline-none focus:border-violet-500/50 disabled:opacity-50"
                    />
                    <button
                        onClick={sendMessage}
                        disabled={!input.trim() || modelStatus !== 'ready' || isLoading}
                        className="px-6 py-3 rounded-xl bg-violet-500 hover:bg-violet-600 text-white font-medium disabled:opacity-50 disabled:cursor-not-allowed transition-all flex items-center gap-2"
                    >
                        <Send className="w-4 h-4" />
                        G·ª≠i
                    </button>
                </div>
            </div>
        </div>
    )
}
</file>

<file path="src/pages/Dashboard.jsx">
import { useEffect } from 'react'
import { Phone, Clock, TrendingUp, ArrowUp, ArrowDown, Mic, Brain, Cpu, Activity, AlertCircle } from 'lucide-react'
import useStore from '../store/useStore'

export default function Dashboard() {
    const { stats, recentCalls, fetchDashboardData, isLoading } = useStore()

    useEffect(() => {
        fetchDashboardData()
        const interval = setInterval(fetchDashboardData, 30000)
        return () => clearInterval(interval)
    }, [fetchDashboardData])

    const formatTime = (isoString) => {
        if (!isoString) return ''
        const date = new Date(isoString)
        return date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' })
    }

    const hasData = stats.totalCalls > 0

    const statCards = [
        { label: 'Cu·ªôc g·ªçi h√¥m nay', value: stats.todayCalls, change: hasData ? '+0%' : '-', trend: 'up', icon: Phone, gradient: 'from-violet-500 to-purple-600' },
        { label: 'T·ªïng cu·ªôc g·ªçi', value: stats.totalCalls, change: hasData ? '+0%' : '-', trend: 'up', icon: Activity, gradient: 'from-cyan-500 to-blue-600' },
        { label: 'Th·ªùi gian TB', value: stats.avgDuration || '0:00', change: hasData ? '-' : '-', trend: 'down', icon: Clock, gradient: 'from-emerald-500 to-green-600' },
        { label: 'T·ª∑ l·ªá th√†nh c√¥ng', value: `${stats.successRate || 0}%`, change: hasData ? '+0%' : '-', trend: 'up', icon: TrendingUp, gradient: 'from-amber-500 to-orange-600' },
    ]

    return (
        <div className="space-y-8">
            {/* Header */}
            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h1 className="text-3xl font-bold text-white tracking-tight">Dashboard</h1>
                    <p className="text-slate-400 mt-1">T·ªïng quan ho·∫°t ƒë·ªông h·ªá th·ªëng AI Voice Bot</p>
                </div>
                <div className="flex items-center gap-2 px-4 py-2 rounded-full bg-emerald-500/10 border border-emerald-500/20">
                    <span className="relative flex h-2.5 w-2.5">
                        <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                        <span className="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"></span>
                    </span>
                    <span className="text-sm font-medium text-emerald-400">System Online</span>
                </div>
            </div>

            {/* Stats Grid - Staggered Animation */}
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 stagger-children">
                {statCards.map((stat, index) => (
                    <div
                        key={stat.label}
                        className="relative overflow-hidden rounded-2xl bg-white/[0.03] border border-white/10 p-5 md:p-6 
                                   hover:bg-white/[0.06] hover:border-violet-500/30 hover:shadow-glow
                                   transition-all duration-300 group cursor-pointer card-interactive"
                        style={{ animationDelay: `${index * 100}ms` }}
                    >
                        <div className={`absolute top-0 left-0 right-0 h-1 bg-gradient-to-r ${stat.gradient}`} />
                        <stat.icon className="absolute top-4 right-4 w-12 h-12 md:w-16 md:h-16 text-white/[0.03] group-hover:text-white/[0.08] transition-all duration-300" />

                        <div className="relative z-10">
                            <div className={`w-11 h-11 md:w-12 md:h-12 rounded-xl bg-gradient-to-br ${stat.gradient} flex items-center justify-center mb-3 md:mb-4 shadow-lg group-hover:scale-110 transition-transform duration-300`}>
                                <stat.icon className="w-5 h-5 md:w-6 md:h-6 text-white" />
                            </div>
                            <p className="text-2xl md:text-3xl font-bold text-white mb-1">{stat.value}</p>
                            <p className="text-xs md:text-sm text-slate-400 mb-2 md:mb-3">{stat.label}</p>
                            {hasData && stat.change !== '-' && (
                                <div className={`inline-flex items-center gap-1 text-xs md:text-sm font-medium px-2 py-0.5 rounded-full ${stat.trend === 'up'
                                    ? 'bg-emerald-500/10 text-emerald-400'
                                    : 'bg-rose-500/10 text-rose-400'
                                    }`}>
                                    {stat.trend === 'up' ? <ArrowUp className="w-3 h-3 md:w-3.5 md:h-3.5" /> : <ArrowDown className="w-3 h-3 md:w-3.5 md:h-3.5" />}
                                    {stat.change}
                                </div>
                            )}
                        </div>
                    </div>
                ))}
            </div>

            {/* Main Grid */}
            <div className="grid grid-cols-1 xl:grid-cols-3 gap-6 md:gap-8">
                {/* Recent Calls */}
                <div className="xl:col-span-2 rounded-2xl bg-white/[0.03] border border-white/10 overflow-hidden hover:border-white/20 transition-colors duration-300">
                    <div className="px-4 md:px-6 py-4 md:py-5 border-b border-white/5 flex items-center justify-between">
                        <h2 className="text-base md:text-lg font-bold text-white flex items-center gap-2 md:gap-3">
                            <div className="w-7 h-7 md:w-8 md:h-8 rounded-lg bg-violet-500/20 flex items-center justify-center">
                                <Clock className="w-3.5 h-3.5 md:w-4 md:h-4 text-violet-400" />
                            </div>
                            Cu·ªôc g·ªçi g·∫ßn ƒë√¢y
                        </h2>
                        {hasData && (
                            <button className="text-xs md:text-sm text-violet-400 hover:text-violet-300 font-medium transition-colors">Xem t·∫•t c·∫£</button>
                        )}
                    </div>

                    {isLoading ? (
                        <div className="p-12 text-center text-slate-500">
                            <div className="animate-spin w-8 h-8 border-2 border-violet-500 border-t-transparent rounded-full mx-auto mb-3" />
                            ƒêang t·∫£i d·ªØ li·ªáu...
                        </div>
                    ) : !hasData ? (
                        <div className="p-8 md:p-12 text-center">
                            <div className="w-14 h-14 md:w-16 md:h-16 rounded-2xl bg-gradient-to-br from-slate-800/50 to-slate-900/50 flex items-center justify-center mx-auto mb-4 animate-pulse">
                                <AlertCircle className="w-7 h-7 md:w-8 md:h-8 text-slate-500" />
                            </div>
                            <h3 className="text-base md:text-lg font-semibold text-white mb-2">Ch∆∞a c√≥ d·ªØ li·ªáu</h3>
                            <p className="text-xs md:text-sm text-slate-500 max-w-sm mx-auto">
                                H·ªá th·ªëng ch∆∞a ghi nh·∫≠n cu·ªôc g·ªçi n√†o. D·ªØ li·ªáu s·∫Ω xu·∫•t hi·ªán khi c√≥ cu·ªôc g·ªçi ƒë∆∞·ª£c th·ª±c hi·ªán.
                            </p>
                        </div>
                    ) : (
                        <div className="overflow-x-auto">
                            <table className="w-full min-w-[600px]">
                                <thead>
                                    <tr className="text-left text-xs font-medium text-slate-500 uppercase tracking-wider border-b border-white/5">
                                        <th className="px-4 md:px-6 py-3 md:py-4">S·ªë ƒëi·ªán tho·∫°i</th>
                                        <th className="px-4 md:px-6 py-3 md:py-4">Kh√°ch h√†ng</th>
                                        <th className="px-4 md:px-6 py-3 md:py-4">Th·ªùi gian</th>
                                        <th className="px-4 md:px-6 py-3 md:py-4">Th·ªùi l∆∞·ª£ng</th>
                                        <th className="px-4 md:px-6 py-3 md:py-4 text-right">Tr·∫°ng th√°i</th>
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-white/5">
                                    {recentCalls.map((call, idx) => (
                                        <tr key={idx} className="hover:bg-white/[0.02] transition-colors group">
                                            <td className="px-4 md:px-6 py-3 md:py-4">
                                                <span className="font-medium text-white text-sm md:text-base group-hover:text-violet-400 transition-colors">{call.phone_number || call.phone}</span>
                                            </td>
                                            <td className="px-4 md:px-6 py-3 md:py-4 text-slate-300 text-sm">{call.customer_name || 'Kh√°ch v√£ng lai'}</td>
                                            <td className="px-4 md:px-6 py-3 md:py-4 text-slate-400 text-xs md:text-sm">{formatTime(call.start_time)}</td>
                                            <td className="px-4 md:px-6 py-3 md:py-4 text-slate-400 font-mono text-xs md:text-sm">{call.duration}</td>
                                            <td className="px-4 md:px-6 py-3 md:py-4 text-right">
                                                <span className={`inline-flex px-2 md:px-2.5 py-0.5 md:py-1 rounded-lg text-2xs md:text-xs font-medium ${call.status === 'completed'
                                                    ? 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20'
                                                    : 'bg-rose-500/10 text-rose-400 border border-rose-500/20'
                                                    }`}>
                                                    {call.status === 'completed' ? 'Ho√†n th√†nh' : 'Nh·ª°'}
                                                </span>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    )}
                </div>

                {/* Right Panel - System Status */}
                <div className="space-y-4 md:space-y-6">
                    {/* Voice Engine */}
                    <div className="rounded-2xl bg-white/[0.03] border border-white/10 p-5 md:p-6 relative overflow-hidden hover:border-violet-500/20 transition-all duration-300 group">
                        <div className="absolute -top-10 -right-10 w-32 h-32 bg-cyan-500/10 rounded-full blur-3xl group-hover:bg-cyan-500/20 transition-all duration-500" />
                        <div className="flex items-center gap-3 md:gap-4 mb-4 md:mb-5 relative">
                            <div className="w-11 h-11 md:w-12 md:h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center shadow-lg animate-float">
                                <Mic className="w-5 h-5 md:w-6 md:h-6 text-white" />
                            </div>
                            <div>
                                <h3 className="font-bold text-white text-sm md:text-base">Voice Engine</h3>
                                <div className="flex items-center gap-2 mt-0.5">
                                    <span className="w-2 h-2 rounded-full bg-emerald-400 animate-pulse" />
                                    <span className="text-xs text-emerald-400 font-medium">S·∫µn s√†ng</span>
                                </div>
                            </div>
                        </div>
                        <div className="space-y-2 md:space-y-3 relative">
                            <div className="flex justify-between py-2 border-b border-white/5">
                                <span className="text-xs md:text-sm text-slate-400">Model</span>
                                <span className="text-xs md:text-sm font-medium text-white">VITS Vietnamese</span>
                            </div>
                            <div className="flex justify-between py-2 border-b border-white/5">
                                <span className="text-xs md:text-sm text-slate-400">Latency</span>
                                <span className="text-xs md:text-sm font-medium text-white">~120ms</span>
                            </div>
                            <div className="flex justify-between py-2">
                                <span className="text-xs md:text-sm text-slate-400">Status</span>
                                <span className="text-xs md:text-sm text-emerald-400">Ready</span>
                            </div>
                        </div>
                    </div>

                    {/* LLM Engine */}
                    <div className="rounded-2xl bg-white/[0.03] border border-white/10 p-5 md:p-6 relative overflow-hidden hover:border-violet-500/20 transition-all duration-300 group">
                        <div className="absolute -top-10 -right-10 w-32 h-32 bg-violet-500/10 rounded-full blur-3xl group-hover:bg-violet-500/20 transition-all duration-500" />
                        <div className="flex items-center gap-3 md:gap-4 mb-4 md:mb-5 relative">
                            <div className="w-11 h-11 md:w-12 md:h-12 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center shadow-lg animate-float" style={{ animationDelay: '0.5s' }}>
                                <Brain className="w-5 h-5 md:w-6 md:h-6 text-white" />
                            </div>
                            <div>
                                <h3 className="font-bold text-white text-sm md:text-base">LLM Engine</h3>
                                <p className="text-xs text-slate-400 mt-0.5">Ollama Local</p>
                            </div>
                        </div>
                        <div className="space-y-2 md:space-y-3 relative">
                            <div className="flex justify-between py-2 border-b border-white/5">
                                <span className="text-xs md:text-sm text-slate-400">Model</span>
                                <span className="text-xs md:text-sm font-medium text-white">Llama 3.2 8B</span>
                            </div>
                            <div className="flex justify-between py-2 border-b border-white/5">
                                <span className="text-xs md:text-sm text-slate-400">Context</span>
                                <span className="text-xs md:text-sm font-medium text-white">8192 tokens</span>
                            </div>
                            <div className="flex justify-between py-2">
                                <span className="text-xs md:text-sm text-slate-400">Status</span>
                                <span className="text-xs md:text-sm text-emerald-400">Ready</span>
                            </div>
                        </div>
                    </div>

                    {/* System Resources */}
                    <div className="rounded-2xl bg-white/[0.03] border border-white/10 p-5 md:p-6 hover:border-emerald-500/20 transition-all duration-300">
                        <div className="flex items-center gap-3 mb-4 md:mb-5">
                            <div className="w-9 h-9 md:w-10 md:h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center">
                                <Cpu className="w-4 h-4 md:w-5 md:h-5 text-white" />
                            </div>
                            <h3 className="font-bold text-white text-sm md:text-base">T√†i nguy√™n</h3>
                        </div>
                        <div className="space-y-4 md:space-y-5">
                            <div>
                                <div className="flex justify-between text-xs md:text-sm mb-2">
                                    <span className="text-slate-400">CPU</span>
                                    <span className="text-white font-mono">--%</span>
                                </div>
                                <div className="h-2 bg-white/5 rounded-full overflow-hidden">
                                    <div className="h-full w-0 bg-gradient-to-r from-violet-500 to-purple-600 rounded-full transition-all duration-500" />
                                </div>
                            </div>
                            <div>
                                <div className="flex justify-between text-xs md:text-sm mb-2">
                                    <span className="text-slate-400">RAM</span>
                                    <span className="text-white font-mono">--%</span>
                                </div>
                                <div className="h-2 bg-white/5 rounded-full overflow-hidden">
                                    <div className="h-full w-0 bg-gradient-to-r from-emerald-500 to-green-600 rounded-full transition-all duration-500" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    )
}
</file>

<file path="src/pages/History.jsx">
import { useState, useEffect } from 'react'
import { Phone, Search, Filter, ChevronDown, Play, Bot, User, Calendar, AlertCircle } from 'lucide-react'

export default function History() {
    const [searchQuery, setSearchQuery] = useState('')
    const [expandedId, setExpandedId] = useState(null)
    const [calls, setCalls] = useState([])
    const [isLoading, setIsLoading] = useState(true)

    useEffect(() => {
        const loadCalls = async () => {
            setIsLoading(true)
            try {
                if (window.electronAPI?.db) {
                    const data = await window.electronAPI.db.getAllCalls()
                    setCalls(data)
                } else {
                    setCalls([])
                }
            } catch (error) {
                console.error('Failed to load calls:', error)
                setCalls([])
            } finally {
                setIsLoading(false)
            }
        }
        loadCalls()
    }, [])

    const getMessages = (transcript) => {
        try {
            return JSON.parse(transcript) || []
        } catch {
            return []
        }
    }

    const formatDateTime = (isoString) => {
        const date = new Date(isoString)
        return {
            date: date.toLocaleDateString('vi-VN'),
            time: date.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' })
        }
    }

    const filteredCalls = calls.filter(call =>
        call.phone_number?.includes(searchQuery) ||
        call.customer_name?.toLowerCase().includes(searchQuery.toLowerCase())
    )

    return (
        <div className="space-y-8">
            {/* Header */}
            <div>
                <h1 className="text-3xl font-bold text-white tracking-tight">L·ªãch s·ª≠ cu·ªôc g·ªçi</h1>
                <p className="text-slate-400 mt-1">Xem l·∫°i v√† nghe l·∫°i c√°c cu·ªôc h·ªôi tho·∫°i ƒë√£ th·ª±c hi·ªán</p>
            </div>

            {/* Search & Filter */}
            <div className="flex flex-col sm:flex-row gap-4 p-4 rounded-2xl bg-white/[0.02] border border-white/5">
                <div className="relative flex-1">
                    <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-slate-500" />
                    <input
                        type="text"
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                        placeholder="T√¨m ki·∫øm theo t√™n ho·∫∑c s·ªë ƒëi·ªán tho·∫°i..."
                        className="w-full pl-12 pr-4 py-3 bg-[#0a0a12] border border-white/10 rounded-xl text-white placeholder-slate-500 text-sm focus:outline-none focus:border-violet-500/50 transition-all"
                    />
                </div>
                <button className="flex items-center justify-center gap-2 px-4 py-3 bg-[#0a0a12] border border-white/10 rounded-xl text-sm font-medium text-slate-400 hover:text-white hover:border-violet-500/30 transition-all">
                    <Filter className="w-4 h-4" />
                    B·ªô l·ªçc
                </button>
                <button className="flex items-center justify-center gap-2 px-4 py-3 bg-[#0a0a12] border border-white/10 rounded-xl text-sm font-medium text-slate-400 hover:text-white hover:border-violet-500/30 transition-all">
                    <Calendar className="w-4 h-4" />
                    H√¥m nay
                </button>
            </div>

            {/* Calls List */}
            <div className="rounded-2xl bg-white/[0.03] border border-white/10 overflow-hidden">
                {isLoading ? (
                    <div className="p-12 text-center">
                        <div className="animate-spin w-8 h-8 border-2 border-violet-500 border-t-transparent rounded-full mx-auto mb-3" />
                        <p className="text-slate-500">ƒêang t·∫£i d·ªØ li·ªáu...</p>
                    </div>
                ) : filteredCalls.length === 0 ? (
                    <div className="p-12 text-center">
                        <div className="w-16 h-16 rounded-2xl bg-slate-800/50 flex items-center justify-center mx-auto mb-4">
                            <AlertCircle className="w-8 h-8 text-slate-500" />
                        </div>
                        <h3 className="text-lg font-semibold text-white mb-2">Ch∆∞a c√≥ l·ªãch s·ª≠</h3>
                        <p className="text-sm text-slate-500 max-w-sm mx-auto">
                            {searchQuery ? 'Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ ph√π h·ª£p.' : 'L·ªãch s·ª≠ cu·ªôc g·ªçi s·∫Ω xu·∫•t hi·ªán khi b·∫°n th·ª±c hi·ªán cu·ªôc g·ªçi ƒë·∫ßu ti√™n.'}
                        </p>
                    </div>
                ) : (
                    <div className="divide-y divide-white/5">
                        {filteredCalls.map((call) => {
                            const { date, time } = formatDateTime(call.start_time)
                            const messages = getMessages(call.transcript)

                            return (
                                <div key={call.id} className="group hover:bg-white/[0.01] transition-colors">
                                    <div
                                        onClick={() => setExpandedId(expandedId === call.id ? null : call.id)}
                                        className="flex items-center justify-between p-5 cursor-pointer"
                                    >
                                        <div className="flex items-center gap-5 min-w-0">
                                            <div className="shrink-0 w-12 h-12 rounded-full bg-emerald-500/10 flex items-center justify-center ring-1 ring-emerald-500/20">
                                                <Phone className="w-5 h-5 text-emerald-400" />
                                            </div>
                                            <div className="min-w-0">
                                                <div className="flex items-center gap-3">
                                                    <p className="font-semibold text-white text-base">{call.customer_name || 'Kh√°ch h√†ng'}</p>
                                                    <span className="text-xs text-slate-400 font-mono bg-white/5 px-2 py-0.5 rounded">{call.phone_number}</span>
                                                </div>
                                                <div className="flex items-center gap-2 mt-1 text-sm text-slate-500">
                                                    <span>{date} ‚Ä¢ {time}</span>
                                                    <span>‚Ä¢</span>
                                                    <span>Th·ªùi l∆∞·ª£ng: {call.duration}</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-3 shrink-0 ml-4">
                                            <span className={`px-2.5 py-1 rounded-lg text-xs font-medium ${call.status === 'completed'
                                                    ? 'bg-emerald-500/10 text-emerald-400'
                                                    : 'bg-rose-500/10 text-rose-400'
                                                }`}>
                                                {call.status === 'completed' ? 'Ho√†n th√†nh' : 'Nh·ª°'}
                                            </span>
                                            <button
                                                onClick={(e) => { e.stopPropagation() }}
                                                className="p-2.5 rounded-xl bg-white/5 hover:bg-violet-500 text-slate-400 hover:text-white transition-all"
                                            >
                                                <Play className="w-4 h-4" />
                                            </button>
                                            <ChevronDown className={`w-5 h-5 text-slate-500 transition-transform ${expandedId === call.id ? 'rotate-180' : ''}`} />
                                        </div>
                                    </div>

                                    {/* Expanded Transcript */}
                                    {expandedId === call.id && (
                                        <div className="px-5 pb-6 pt-2 bg-black/20 border-t border-white/5">
                                            <h4 className="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-4 px-2">N·ªôi dung h·ªôi tho·∫°i</h4>
                                            {messages.length > 0 ? (
                                                <div className="space-y-4 pl-4 border-l-2 border-white/5 ml-2">
                                                    {messages.map((msg, idx) => (
                                                        <div key={idx} className={`flex items-start gap-3 ${msg.role === 'ai' ? '' : 'flex-row-reverse'}`}>
                                                            <div className={`shrink-0 w-8 h-8 rounded-lg flex items-center justify-center ${msg.role === 'ai' ? 'bg-violet-500/20' : 'bg-slate-700/50'
                                                                }`}>
                                                                {msg.role === 'ai' ? <Bot className="w-4 h-4 text-violet-400" /> : <User className="w-4 h-4 text-slate-400" />}
                                                            </div>
                                                            <div className={`max-w-[80%] rounded-2xl px-4 py-3 text-sm ${msg.role === 'ai'
                                                                    ? 'bg-violet-500/10 text-slate-200 rounded-tl-none'
                                                                    : 'bg-white/5 text-slate-300 rounded-tr-none'
                                                                }`}>
                                                                {msg.content}
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            ) : (
                                                <p className="text-sm text-slate-500 italic px-2">Kh√¥ng c√≥ n·ªôi dung h·ªôi tho·∫°i</p>
                                            )}
                                        </div>
                                    )}
                                </div>
                            )
                        })}
                    </div>
                )}
            </div>
        </div>
    )
}
</file>

<file path="src/pages/ModelManager.jsx">
import { useState, useEffect } from 'react'
import { Brain, Cpu, HardDrive, Zap, Download, Trash2, RefreshCw, AlertCircle, Plus, Check } from 'lucide-react'

const defaultModels = [
    {
        id: 'qwen-4b',
        name: 'Qwen 4B',
        type: 'LLM',
        size: '2.3 GB',
        status: 'downloading',
        params: '4B',
        context: '128K',
        description: 'Model AI nh·∫π cho x·ª≠ l√Ω vƒÉn b·∫£n, s·ª≠a l·ªói ti·∫øng Vi·ªát - Balance t·ªët gi·ªØa t·ªëc ƒë·ªô v√† accuracy'
    },
    {
        id: 'whisper-medium',
        name: 'Whisper Medium',
        type: 'STT',
        size: '1.5 GB',
        status: 'installed',
        params: '769M',
        context: '-',
        description: 'Model nh·∫≠n d·∫°ng gi·ªçng n√≥i ti·∫øng Vi·ªát accuracy cao (~93%), balance t·ªët gi·ªØa t·ªëc ƒë·ªô v√† ch·∫•t l∆∞·ª£ng'
    },
    {
        id: 'f5-tts-vi',
        name: 'F5-TTS Vietnamese',
        type: 'TTS',
        size: '1.2 GB',
        status: 'installed',
        params: '1B',
        context: '-',
        description: 'Model text-to-speech ti·∫øng Vi·ªát, t·∫°o gi·ªçng n√≥i t·ª± nhi√™n t·ª´ vƒÉn b·∫£n'
    },
]

export default function ModelManager() {
    const [models, setModels] = useState(defaultModels)
    const [isLoading, setIsLoading] = useState(false)
    const [activeTab, setActiveTab] = useState('all')

    const tabs = [
        { id: 'all', label: 'T·∫•t c·∫£' },
        { id: 'LLM', label: 'LLM' },
        { id: 'TTS', label: 'TTS' },
        { id: 'STT', label: 'STT' },
    ]

    const filteredModels = activeTab === 'all' ? models : models.filter(m => m.type === activeTab)
    const installedCount = models.filter(m => m.status === 'installed').length

    const handleInstall = (modelId) => {
        setModels(prev => prev.map(m =>
            m.id === modelId ? { ...m, status: 'downloading' } : m
        ))
        // Simulate download
        setTimeout(() => {
            setModels(prev => prev.map(m =>
                m.id === modelId ? { ...m, status: 'installed' } : m
            ))
        }, 2000)
    }

    const handleUninstall = (modelId) => {
        setModels(prev => prev.map(m =>
            m.id === modelId ? { ...m, status: 'not_installed' } : m
        ))
    }

    const getStatusBadge = (status) => {
        switch (status) {
            case 'installed':
                return <span className="flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-emerald-500/10 text-emerald-400 text-xs font-medium"><Check className="w-3 h-3" />ƒê√£ c√†i</span>
            case 'downloading':
                return <span className="flex items-center gap-1.5 px-2.5 py-1 rounded-lg bg-violet-500/10 text-violet-400 text-xs font-medium"><RefreshCw className="w-3 h-3 animate-spin" />ƒêang t·∫£i...</span>
            default:
                return <span className="px-2.5 py-1 rounded-lg bg-slate-500/10 text-slate-400 text-xs font-medium">Ch∆∞a c√†i</span>
        }
    }

    const getTypeIcon = (type) => {
        switch (type) {
            case 'LLM': return <Brain className="w-5 h-5" />
            case 'TTS': return <Zap className="w-5 h-5" />
            case 'STT': return <Cpu className="w-5 h-5" />
            default: return <HardDrive className="w-5 h-5" />
        }
    }

    const getTypeColor = (type) => {
        switch (type) {
            case 'LLM': return 'from-violet-500 to-purple-600'
            case 'TTS': return 'from-cyan-500 to-blue-600'
            case 'STT': return 'from-emerald-500 to-green-600'
            default: return 'from-slate-500 to-slate-600'
        }
    }

    return (
        <div className="space-y-8">
            {/* Header */}
            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h1 className="text-3xl font-bold text-white tracking-tight">Qu·∫£n l√Ω Model</h1>
                    <p className="text-slate-400 mt-1">T·∫£i v√† qu·∫£n l√Ω c√°c model AI cho h·ªá th·ªëng</p>
                </div>
                <div className="flex items-center gap-3">
                    <div className="px-4 py-2 rounded-xl bg-white/5 border border-white/10">
                        <span className="text-slate-400 text-sm">ƒê√£ c√†i: </span>
                        <span className="text-white font-semibold">{installedCount}/{models.length}</span>
                    </div>
                </div>
            </div>

            {/* Tabs */}
            <div className="flex gap-2 p-1 rounded-xl bg-white/5 w-fit">
                {tabs.map(tab => (
                    <button
                        key={tab.id}
                        onClick={() => setActiveTab(tab.id)}
                        className={`px - 4 py - 2 rounded - lg text - sm font - medium transition - all ${activeTab === tab.id
                            ? 'bg-violet-500 text-white'
                            : 'text-slate-400 hover:text-white hover:bg-white/5'
                            } `}
                    >
                        {tab.label}
                    </button>
                ))}
            </div>

            {/* Models Grid */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                {filteredModels.map(model => (
                    <div
                        key={model.id}
                        className="rounded-2xl bg-white/[0.03] border border-white/10 p-6 hover:border-violet-500/30 transition-all group"
                    >
                        <div className="flex items-start justify-between mb-4">
                            <div className="flex items-center gap-4">
                                <div className={`w - 12 h - 12 rounded - xl bg - gradient - to - br ${getTypeColor(model.type)} flex items - center justify - center shadow - lg`}>
                                    {getTypeIcon(model.type)}
                                </div>
                                <div>
                                    <h3 className="font-bold text-white text-lg">{model.name}</h3>
                                    <p className="text-sm text-slate-400">{model.type} ‚Ä¢ {model.size}</p>
                                    {model.description && (
                                        <p className="text-xs text-slate-500 mt-1 max-w-xs">{model.description}</p>
                                    )}
                                </div>
                            </div>
                            {getStatusBadge(model.status)}
                        </div>

                        <div className="grid grid-cols-2 gap-4 mb-5 py-4 border-y border-white/5">
                            <div>
                                <p className="text-xs text-slate-500 mb-1">Parameters</p>
                                <p className="text-sm font-medium text-white">{model.params}</p>
                            </div>
                            <div>
                                <p className="text-xs text-slate-500 mb-1">Context</p>
                                <p className="text-sm font-medium text-white">{model.context} tokens</p>
                            </div>
                        </div>

                        <div className="flex gap-3">
                            {model.status === 'not_installed' && (
                                <button
                                    onClick={() => handleInstall(model.id)}
                                    className="flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl bg-violet-500/10 text-violet-400 font-medium hover:bg-violet-500 hover:text-white transition-all"
                                >
                                    <Download className="w-4 h-4" />
                                    T·∫£i v·ªÅ
                                </button>
                            )}
                            {model.status === 'installed' && (
                                <>
                                    <button className="flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl bg-emerald-500/10 text-emerald-400 font-medium">
                                        <Check className="w-4 h-4" />
                                        ƒêang s·ª≠ d·ª•ng
                                    </button>
                                    <button
                                        onClick={() => handleUninstall(model.id)}
                                        className="p-2.5 rounded-xl bg-white/5 text-slate-400 hover:bg-rose-500/20 hover:text-rose-400 transition-all"
                                    >
                                        <Trash2 className="w-4 h-4" />
                                    </button>
                                </>
                            )}
                            {model.status === 'downloading' && (
                                <button disabled className="flex-1 flex items-center justify-center gap-2 py-2.5 rounded-xl bg-violet-500/10 text-violet-400 font-medium cursor-not-allowed">
                                    <RefreshCw className="w-4 h-4 animate-spin" />
                                    ƒêang t·∫£i...
                                </button>
                            )}
                        </div>
                    </div>
                ))}
            </div>

            {/* Empty State */}
            {filteredModels.length === 0 && (
                <div className="rounded-2xl bg-white/[0.03] border border-white/10 p-12 text-center">
                    <div className="w-16 h-16 rounded-2xl bg-slate-800/50 flex items-center justify-center mx-auto mb-4">
                        <AlertCircle className="w-8 h-8 text-slate-500" />
                    </div>
                    <h3 className="text-lg font-semibold text-white mb-2">Kh√¥ng c√≥ model</h3>
                    <p className="text-sm text-slate-500">Kh√¥ng t√¨m th·∫•y model n√†o trong danh m·ª•c n√†y.</p>
                </div>
            )}
        </div>
    )
}
</file>

<file path="src/pages/Settings.jsx">
import { useState, useEffect } from 'react'
import { Settings as SettingsIcon, Save, Globe, Bell, Shield, Mic, Brain, Server, Check, AlertCircle } from 'lucide-react'

export default function Settings() {
    const [settings, setSettings] = useState({
        language: 'vi-VN',
        autoAnswer: true,
        voiceEngine: 'vits',
        llmModel: 'llama-3.2-8b',
        notifications: true,
        apiEndpoint: 'http://localhost:8000',
    })
    const [isSaving, setIsSaving] = useState(false)
    const [saveSuccess, setSaveSuccess] = useState(false)

    useEffect(() => {
        const loadSettings = async () => {
            try {
                if (window.electronAPI?.db) {
                    const data = await window.electronAPI.db.getSettings()
                    if (Object.keys(data).length > 0) {
                        setSettings(prev => ({ ...prev, ...data }))
                    }
                }
            } catch (error) {
                console.error('Failed to load settings:', error)
            }
        }
        loadSettings()
    }, [])

    const handleSave = async () => {
        setIsSaving(true)
        try {
            if (window.electronAPI?.db) {
                for (const [key, value] of Object.entries(settings)) {
                    await window.electronAPI.db.saveSetting(key, value)
                }
            }
            setSaveSuccess(true)
            setTimeout(() => setSaveSuccess(false), 2000)
        } catch (error) {
            console.error('Failed to save settings:', error)
        } finally {
            setIsSaving(false)
        }
    }

    const updateSetting = (key, value) => {
        setSettings(prev => ({ ...prev, [key]: value }))
    }

    return (
        <div className="space-y-8">
            {/* Header */}
            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h1 className="text-3xl font-bold text-white tracking-tight">C√†i ƒë·∫∑t</h1>
                    <p className="text-slate-400 mt-1">C·∫•u h√¨nh h·ªá th·ªëng AI Voice Bot</p>
                </div>
                <button
                    onClick={handleSave}
                    disabled={isSaving}
                    className="flex items-center justify-center gap-2 px-5 py-2.5 rounded-xl bg-gradient-to-r from-violet-500 to-purple-600 text-white font-medium hover:opacity-90 transition-opacity disabled:opacity-50"
                >
                    {saveSuccess ? (
                        <>
                            <Check className="w-5 h-5" />
                            ƒê√£ l∆∞u!
                        </>
                    ) : isSaving ? (
                        <>
                            <div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                            ƒêang l∆∞u...
                        </>
                    ) : (
                        <>
                            <Save className="w-5 h-5" />
                            L∆∞u thay ƒë·ªïi
                        </>
                    )}
                </button>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {/* General Settings */}
                <div className="rounded-2xl bg-white/[0.03] border border-white/10 p-6">
                    <div className="flex items-center gap-3 mb-6">
                        <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-purple-600 flex items-center justify-center">
                            <SettingsIcon className="w-5 h-5 text-white" />
                        </div>
                        <h2 className="text-lg font-bold text-white">C√†i ƒë·∫∑t chung</h2>
                    </div>

                    <div className="space-y-5">
                        <div>
                            <label className="block text-sm font-medium text-slate-400 mb-2">Ng√¥n ng·ªØ</label>
                            <select
                                value={settings.language}
                                onChange={(e) => updateSetting('language', e.target.value)}
                                className="w-full px-4 py-3 rounded-xl bg-[#0a0a12] border border-white/10 text-white focus:outline-none focus:border-violet-500/50 transition-colors appearance-none cursor-pointer"
                            >
                                <option value="vi-VN">Ti·∫øng Vi·ªát</option>
                                <option value="en-US">English</option>
                            </select>
                        </div>

                        <div className="flex items-center justify-between py-3 border-b border-white/5">
                            <div>
                                <p className="font-medium text-white">T·ª± ƒë·ªông tr·∫£ l·ªùi</p>
                                <p className="text-sm text-slate-500">T·ª± ƒë·ªông nh·∫≠n cu·ªôc g·ªçi ƒë·∫øn</p>
                            </div>
                            <button
                                onClick={() => updateSetting('autoAnswer', !settings.autoAnswer)}
                                className={`relative w-12 h-6 rounded-full transition-colors ${settings.autoAnswer ? 'bg-violet-500' : 'bg-white/10'
                                    }`}
                            >
                                <span className={`absolute top-0.5 w-5 h-5 rounded-full bg-white shadow transition-transform ${settings.autoAnswer ? 'translate-x-6' : 'translate-x-0.5'
                                    }`} />
                            </button>
                        </div>

                        <div className="flex items-center justify-between py-3">
                            <div>
                                <p className="font-medium text-white">Th√¥ng b√°o</p>
                                <p className="text-sm text-slate-500">Nh·∫≠n th√¥ng b√°o v·ªÅ cu·ªôc g·ªçi</p>
                            </div>
                            <button
                                onClick={() => updateSetting('notifications', !settings.notifications)}
                                className={`relative w-12 h-6 rounded-full transition-colors ${settings.notifications ? 'bg-violet-500' : 'bg-white/10'
                                    }`}
                            >
                                <span className={`absolute top-0.5 w-5 h-5 rounded-full bg-white shadow transition-transform ${settings.notifications ? 'translate-x-6' : 'translate-x-0.5'
                                    }`} />
                            </button>
                        </div>
                    </div>
                </div>

                {/* Voice Settings */}
                <div className="rounded-2xl bg-white/[0.03] border border-white/10 p-6">
                    <div className="flex items-center gap-3 mb-6">
                        <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center">
                            <Mic className="w-5 h-5 text-white" />
                        </div>
                        <h2 className="text-lg font-bold text-white">Voice Engine</h2>
                    </div>

                    <div className="space-y-5">
                        <div>
                            <label className="block text-sm font-medium text-slate-400 mb-2">Model TTS</label>
                            <select
                                value={settings.voiceEngine}
                                onChange={(e) => updateSetting('voiceEngine', e.target.value)}
                                className="w-full px-4 py-3 rounded-xl bg-[#0a0a12] border border-white/10 text-white focus:outline-none focus:border-violet-500/50 transition-colors appearance-none cursor-pointer"
                            >
                                <option value="vits">VITS Vietnamese</option>
                                <option value="coqui">Coqui TTS</option>
                                <option value="edge">Edge TTS</option>
                            </select>
                        </div>

                        <div className="p-4 rounded-xl bg-emerald-500/5 border border-emerald-500/10">
                            <div className="flex items-center gap-2 text-emerald-400 mb-2">
                                <Check className="w-4 h-4" />
                                <span className="font-medium text-sm">Tr·∫°ng th√°i: S·∫µn s√†ng</span>
                            </div>
                            <p className="text-sm text-slate-400">Model hi·ªán t·∫°i ƒëang ho·∫°t ƒë·ªông b√¨nh th∆∞·ªùng</p>
                        </div>
                    </div>
                </div>

                {/* LLM Settings */}
                <div className="rounded-2xl bg-white/[0.03] border border-white/10 p-6">
                    <div className="flex items-center gap-3 mb-6">
                        <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center">
                            <Brain className="w-5 h-5 text-white" />
                        </div>
                        <h2 className="text-lg font-bold text-white">LLM Engine</h2>
                    </div>

                    <div className="space-y-5">
                        <div>
                            <label className="block text-sm font-medium text-slate-400 mb-2">Model LLM</label>
                            <select
                                value={settings.llmModel}
                                onChange={(e) => updateSetting('llmModel', e.target.value)}
                                className="w-full px-4 py-3 rounded-xl bg-[#0a0a12] border border-white/10 text-white focus:outline-none focus:border-violet-500/50 transition-colors appearance-none cursor-pointer"
                            >
                                <option value="llama-3.2-8b">Llama 3.2 8B</option>
                                <option value="gemma-2-9b">Gemma 2 9B</option>
                                <option value="phi-3-mini">Phi-3 Mini</option>
                            </select>
                        </div>

                        <div className="p-4 rounded-xl bg-slate-500/5 border border-white/5">
                            <div className="flex items-center gap-2 text-slate-400 mb-2">
                                <AlertCircle className="w-4 h-4" />
                                <span className="font-medium text-sm">Ollama Local</span>
                            </div>
                            <p className="text-sm text-slate-500">Y√™u c·∫ßu Ollama ƒëang ch·∫°y tr√™n m√°y</p>
                        </div>
                    </div>
                </div>

                {/* API Settings */}
                <div className="rounded-2xl bg-white/[0.03] border border-white/10 p-6">
                    <div className="flex items-center gap-3 mb-6">
                        <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 flex items-center justify-center">
                            <Server className="w-5 h-5 text-white" />
                        </div>
                        <h2 className="text-lg font-bold text-white">API & K·∫øt n·ªëi</h2>
                    </div>

                    <div className="space-y-5">
                        <div>
                            <label className="block text-sm font-medium text-slate-400 mb-2">API Endpoint</label>
                            <input
                                type="text"
                                value={settings.apiEndpoint}
                                onChange={(e) => updateSetting('apiEndpoint', e.target.value)}
                                className="w-full px-4 py-3 rounded-xl bg-[#0a0a12] border border-white/10 text-white font-mono text-sm focus:outline-none focus:border-violet-500/50 transition-colors"
                                placeholder="http://localhost:8000"
                            />
                        </div>

                        <button className="w-full py-3 rounded-xl bg-white/5 border border-white/10 text-slate-400 font-medium hover:text-white hover:border-violet-500/30 transition-all">
                            Ki·ªÉm tra k·∫øt n·ªëi
                        </button>
                    </div>
                </div>
            </div>
        </div>
    )
}
</file>

<file path="src/pages/TrainingData.jsx">
import { useState } from 'react'
import { Upload, File, Trash2, Eye, Check, AlertCircle, Database, FileText } from 'lucide-react'

export default function TrainingData() {
    const [datasets, setDatasets] = useState([])
    const [uploading, setUploading] = useState(false)
    const [selectedFile, setSelectedFile] = useState(null)

    const handleFileUpload = async (event) => {
        const files = event.target.files
        if (!files || files.length === 0) return

        setUploading(true)

        // Simulate upload - replace with actual IPC call
        for (let file of files) {
            const newDataset = {
                id: Date.now() + Math.random(),
                name: file.name,
                size: (file.size / 1024).toFixed(2) + ' KB',
                type: file.name.split('.').pop().toUpperCase(),
                uploadedAt: new Date().toLocaleString('vi-VN'),
                samples: Math.floor(Math.random() * 1000) + 100
            }
            setDatasets(prev => [newDataset, ...prev])
        }

        setTimeout(() => setUploading(false), 1000)
    }

    const handleDelete = (id) => {
        setDatasets(prev => prev.filter(d => d.id !== id))
    }

    return (
        <div className="space-y-8">
            {/* Header */}
            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h1 className="text-3xl font-bold text-white tracking-tight">Training Data</h1>
                    <p className="text-slate-400 mt-1">Upload v√† qu·∫£n l√Ω datasets ƒë·ªÉ fine-tune model</p>
                </div>
                <div className="px-4 py-2 rounded-xl bg-white/5 border border-white/10">
                    <span className="text-slate-400 text-sm">Datasets: </span>
                    <span className="text-white font-semibold">{datasets.length}</span>
                </div>
            </div>

            {/* Upload Area */}
            <div className="rounded-2xl bg-white/[0.03] border-2 border-dashed border-white/10 hover:border-violet-500/30 transition-all p-12">
                <div className="text-center">
                    <div className="w-16 h-16 rounded-2xl bg-violet-500/10 flex items-center justify-center mx-auto mb-4">
                        <Upload className="w-8 h-8 text-violet-400" />
                    </div>
                    <h3 className="text-lg font-semibold text-white mb-2">Upload Training Data</h3>
                    <p className="text-sm text-slate-400 mb-6">
                        H·ªó tr·ª£: TXT, JSON, JSONL, CSV (Max 10MB per file)
                    </p>
                    <label className="inline-block">
                        <input
                            type="file"
                            multiple
                            accept=".txt,.json,.jsonl,.csv"
                            onChange={handleFileUpload}
                            className="hidden"
                        />
                        <div className="px-6 py-3 rounded-xl bg-violet-500 hover:bg-violet-600 text-white font-medium cursor-pointer transition-all flex items-center gap-2">
                            <Upload className="w-4 h-4" />
                            Ch·ªçn files
                        </div>
                    </label>
                </div>
            </div>

            {/* Datasets List */}
            {datasets.length > 0 && (
                <div className="space-y-4">
                    <h2 className="text-xl font-bold text-white">Datasets ƒë√£ upload</h2>
                    <div className="grid grid-cols-1 gap-4">
                        {datasets.map(dataset => (
                            <div
                                key={dataset.id}
                                className="rounded-2xl bg-white/[0.03] border border-white/10 p-6 hover:border-violet-500/30 transition-all group"
                            >
                                <div className="flex items-start justify-between">
                                    <div className="flex items-center gap-4 flex-1">
                                        <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500 to-green-600 flex items-center justify-center shadow-lg">
                                            <Database className="w-6 h-6 text-white" />
                                        </div>
                                        <div className="flex-1">
                                            <h3 className="font-bold text-white text-lg">{dataset.name}</h3>
                                            <p className="text-sm text-slate-400">
                                                {dataset.type} ‚Ä¢ {dataset.size} ‚Ä¢ {dataset.samples} samples
                                            </p>
                                            <p className="text-xs text-slate-500 mt-1">
                                                Uploaded: {dataset.uploadedAt}
                                            </p>
                                        </div>
                                    </div>
                                    <div className="flex gap-2">
                                        <button
                                            onClick={() => setSelectedFile(dataset)}
                                            className="p-2.5 rounded-xl bg-white/5 text-slate-400 hover:bg-violet-500/20 hover:text-violet-400 transition-all"
                                            title="Preview"
                                        >
                                            <Eye className="w-4 h-4" />
                                        </button>
                                        <button
                                            onClick={() => handleDelete(dataset.id)}
                                            className="p-2.5 rounded-xl bg-white/5 text-slate-400 hover:bg-rose-500/20 hover:text-rose-400 transition-all"
                                            title="Delete"
                                        >
                                            <Trash2 className="w-4 h-4" />
                                        </button>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            )}

            {/* Empty State */}
            {datasets.length === 0 && (
                <div className="rounded-2xl bg-white/[0.03] border border-white/10 p-12 text-center">
                    <div className="w-16 h-16 rounded-2xl bg-slate-800/50 flex items-center justify-center mx-auto mb-4">
                        <FileText className="w-8 h-8 text-slate-500" />
                    </div>
                    <h3 className="text-lg font-semibold text-white mb-2">Ch∆∞a c√≥ dataset n√†o</h3>
                    <p className="text-sm text-slate-500">Upload files ƒë·ªÉ b·∫Øt ƒë·∫ßu training model</p>
                </div>
            )}

            {/* Preview Modal */}
            {selectedFile && (
                <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4">
                    <div className="bg-slate-900 rounded-2xl border border-white/10 w-full max-w-2xl max-h-[80vh] overflow-hidden">
                        <div className="p-6 border-b border-white/10 flex items-center justify-between">
                            <h3 className="text-xl font-bold text-white">{selectedFile.name}</h3>
                            <button
                                onClick={() => setSelectedFile(null)}
                                className="p-2 rounded-lg hover:bg-white/10 text-slate-400"
                            >
                                ‚úï
                            </button>
                        </div>
                        <div className="p-6 overflow-y-auto max-h-96">
                            <pre className="text-sm text-slate-300 font-mono bg-black/30 p-4 rounded-lg">
                                {`// Sample preview\n{\n  "instruction": "S·ª≠a l·ªói ch√≠nh t·∫£",\n  "input": "xin chao moi nguoi",\n  "output": "Xin ch√†o m·ªçi ng∆∞·ªùi"\n}`}
                            </pre>
                        </div>
                    </div>
                </div>
            )}
        </div>
    )
}
</file>

<file path="src/pages/VoiceTraining.jsx">
import { useState, useRef, useEffect } from 'react'
import { Mic, Upload, Play, Pause, Trash2, AudioLines, AlertCircle, Check, RefreshCw, Download, ExternalLink, Volume2, Zap, Server, FileAudio } from 'lucide-react'

export default function VoiceTraining() {
    const [voices, setVoices] = useState([])
    const [isRecording, setIsRecording] = useState(false)
    const [recordingTime, setRecordingTime] = useState(0)
    const [isPlaying, setIsPlaying] = useState(null)
    const [generatedVoices, setGeneratedVoices] = useState([])
    const [selectedVoice, setSelectedVoice] = useState(null)
    const [ttsText, setTtsText] = useState('xin ch√†o m·ªçi ng∆∞·ªùi h√¥m nay l√† th·ª© b·∫£y')
    const [isGenerating, setIsGenerating] = useState(false)
    const [generatedAudio, setGeneratedAudio] = useState(null)
    const [ttsStatus, setTtsStatus] = useState(null) // null, 'checking', 'ready', 'not_installed', 'installing'
    const [installLog, setInstallLog] = useState([])
    const [setupStatus, setSetupStatus] = useState({ checking: true, installed: false, error: null })
    const [isInstalling, setIsInstalling] = useState(false)
    const [useQwenCorrection, setUseQwenCorrection] = useState(true) // Enable Qwen by default
    const mediaRecorderRef = useRef(null)
    const audioChunksRef = useRef([])
    const timerRef = useRef(null)
    const audioPlayerRef = useRef(null) // Store current audio instance

    useEffect(() => {
        checkStatus()
        loadRefAudios()
        loadGeneratedAudios()

        // Cleanup on unmount
        return () => {
            // Stop recording if active
            if (mediaRecorderRef.current && isRecording) {
                mediaRecorderRef.current.stop()
                mediaRecorderRef.current.stream.getTracks().forEach(track => track.stop())
            }

            // Clear timer
            if (timerRef.current) {
                clearInterval(timerRef.current)
            }

            // Stop audio playback
            if (audioPlayerRef.current) {
                audioPlayerRef.current.pause()
                audioPlayerRef.current = null
            }

            // Revoke blob URLs
            voices.forEach(v => {
                if (v?.audioUrl?.startsWith('blob:')) {
                    URL.revokeObjectURL(v.audioUrl)
                }
            })
        }
    }, [])

    const checkStatus = async () => {
        setTtsStatus('checking')
        try {
            if (window.electronAPI?.tts) {
                const status = await window.electronAPI.tts.getStatus()
                setTtsStatus(status)
            } else {
                setTtsStatus('demo')
            }
        } catch (e) {
            setTtsStatus('not_installed')
        }
    }

    const loadRefAudios = async () => {
        try {
            if (window.electronAPI?.tts) {
                const refs = await window.electronAPI.tts.listRefs()
                if (refs.length > 0) {
                    setVoices(refs.map((r, i) => ({
                        id: i + 1,
                        name: r.filename,
                        path: r.path,
                        // Don't set audioUrl - will be created as blob URL on-demand when playing
                        transcript: '',
                        status: 'ready'
                    })))
                }
            }
        } catch (e) {
            console.error('Error loading refs:', e)
        }
    }

    const loadGeneratedAudios = async () => {
        try {
            if (window.electronAPI?.tts) {
                const outputs = await window.electronAPI.tts.listOutputs()
                if (outputs.length > 0) {
                    setGeneratedVoices(outputs.map((o, i) => ({
                        id: `gen_${i}`,
                        name: o.filename,
                        path: o.path,
                        timestamp: new Date(o.stats.mtimeMs), // Convert to Date object
                        status: 'ready'
                    })))
                }
            }
        } catch (e) {
            console.error('Error loading generated audios:', e)
        }
    }

    const installF5TTS = async () => {
        setTtsStatus('installing')
        setInstallLog(['üéôÔ∏è ƒêang c√†i ƒë·∫∑t F5-TTS Vietnamese...'])

        try {
            if (window.electronAPI?.tts) {
                const result = await window.electronAPI.tts.install()
                if (result.success || result.ready) {
                    setInstallLog(prev => [...prev, '‚úÖ C√†i ƒë·∫∑t ho√†n t·∫•t!'])
                    setTtsStatus('ready')
                } else {
                    setInstallLog(prev => [...prev, `‚ùå L·ªói: ${result.error}`])
                    setTtsStatus('not_installed')
                }
            }
        } catch (e) {
            setInstallLog(prev => [...prev, `‚ùå L·ªói: ${e.message}`])
            setTtsStatus('not_installed')
        }
    }

    const formatTime = (seconds) => {
        const mins = Math.floor(seconds / 60)
        const secs = seconds % 60
        return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`
    }

    const startRecording = async () => {
        console.log('=== START RECORDING CALLED ===')
        try {
            // Better audio constraints for TTS quality
            const stream = await navigator.mediaDevices.getUserMedia({
                audio: {
                    echoCancellation: true,      // Remove echo
                    noiseSuppression: true,       // Remove background noise
                    autoGainControl: true,        // Normalize volume
                    channelCount: 1,              // Mono
                    sampleRate: 48000             // High quality sample rate
                }
            })
            console.log('Microphone stream obtained with enhanced constraints')

            mediaRecorderRef.current = new MediaRecorder(stream)
            audioChunksRef.current = []

            mediaRecorderRef.current.ondataavailable = (event) => {
                console.log('Data available, size:', event.data.size)
                audioChunksRef.current.push(event.data)
            }

            mediaRecorderRef.current.onstop = async () => {
                console.log('=== RECORDING STOPPED, processing... ===')
                console.log('Audio chunks collected:', audioChunksRef.current.length)

                // MediaRecorder produces WebM/Opus, not WAV
                const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/webm' })
                console.log('Audio blob created, size:', audioBlob.size)
                const filename = `ref_${Date.now()}.webm`

                // Upload to backend
                let serverPath = null
                try {
                    if (window.electronAPI?.tts) {
                        console.log('Uploading to backend...')
                        const arrayBuffer = await audioBlob.arrayBuffer()
                        const result = await window.electronAPI.tts.uploadRef(arrayBuffer, filename)
                        if (result.success) {
                            serverPath = result.path
                            console.log('Upload successful, path:', serverPath)

                            // Convert WebM to WAV for better TTS quality
                            try {
                                console.log('Converting to WAV...')
                                const convResult = await window.electronAPI.tts.convertToWav(serverPath)
                                if (convResult.success) {
                                    serverPath = convResult.wavPath
                                    console.log('Conversion successful, WAV path:', serverPath)
                                } else {
                                    console.error('Conversion failed:', convResult.error)
                                    alert('C·∫£nh b√°o: Kh√¥ng th·ªÉ convert sang WAV. L∆∞u format WebM.')
                                    // Continue with WebM path
                                }
                            } catch (convError) {
                                console.error('Conversion error:', convError)
                                alert('L·ªói conversion: ' + convError.message)
                                // Continue with WebM path if conversion fails
                            }
                        }
                    }
                } catch (e) {
                    console.warn('Could not upload:', e)
                }

                const audioUrl = URL.createObjectURL(audioBlob)
                const newVoice = {
                    id: Date.now(),
                    name: serverPath ? serverPath.split('/').pop() : filename, // Use actual filename from server
                    duration: formatTime(recordingTime),
                    createdAt: new Date().toLocaleDateString('vi-VN'),
                    status: 'ready',
                    audioUrl,
                    audioBlob,
                    path: serverPath,
                    transcript: ''
                }
                console.log('Adding new voice to list:', newVoice.name)
                setVoices(prev => [newVoice, ...prev])

                // Reload from backend after a delay to ensure WAV conversion completes
                if (serverPath) {
                    setTimeout(() => {
                        console.log('Reloading voices from backend...')
                        loadRefAudios()
                    }, 2000) // Increased from 1000ms to 2000ms for WAV conversion
                }
            }

            mediaRecorderRef.current.start()
            console.log('MediaRecorder started, setting isRecording to true')
            setIsRecording(true)
            setRecordingTime(0)

            timerRef.current = setInterval(() => {
                setRecordingTime(prev => prev + 1)
            }, 1000)
            console.log('Timer started')
        } catch (error) {
            console.error('Recording error:', error)
            alert('Kh√¥ng th·ªÉ truy c·∫≠p microphone')
        }
    }

    const stopRecording = () => {
        console.log('stopRecording called, isRecording:', isRecording)
        if (mediaRecorderRef.current && isRecording) {
            console.log('Stopping MediaRecorder...')
            mediaRecorderRef.current.stop()
            mediaRecorderRef.current.stream.getTracks().forEach(track => track.stop())
        }
        setIsRecording(false)
        if (timerRef.current) {
            clearInterval(timerRef.current)
            timerRef.current = null
        }
        console.log('stopRecording completed')
    }

    const deleteVoice = async (id) => {
        const voice = voices.find(v => v.id === id)

        // Delete from backend if it has a path
        if (voice?.path && window.electronAPI?.tts) {
            try {
                console.log('Deleting voice file:', voice.path)
                const result = await window.electronAPI.tts.deleteRef(voice.path)
                if (!result.success) {
                    console.error('Failed to delete file:', result.error)
                    alert('Kh√¥ng th·ªÉ x√≥a file: ' + result.error)
                    return // Don't proceed if delete failed
                }
                console.log('File deleted successfully')
            } catch (e) {
                console.error('Error deleting voice file:', e)
                alert('L·ªói khi x√≥a file')
                return
            }
        }

        // Revoke blob URL if exists
        if (voice?.audioUrl?.startsWith('blob:')) {
            URL.revokeObjectURL(voice.audioUrl)
        }

        // Remove from state
        setVoices(prev => prev.filter(v => v.id !== id))
        if (selectedVoice === id) setSelectedVoice(null)

        // Reload from backend to stay in sync
        setTimeout(() => loadRefAudios(), 300)
    }

    const playVoice = async (voice) => {
        console.log('=== PLAY VOICE CALLED ===')
        console.log('Voice object:', voice)
        console.log('Voice audioUrl:', voice.audioUrl)
        console.log('Voice path:', voice.path)

        // Toggle off if clicking same voice - PAUSE FIRST
        if (isPlaying === voice.id) {
            console.log('Pausing current playback')
            if (audioPlayerRef.current) {
                audioPlayerRef.current.pause()
                audioPlayerRef.current = null
            }
            setIsPlaying(null)
            return
        }

        // Stop current playback if switching to different voice
        if (audioPlayerRef.current) {
            console.log('Stopping different voice playback')
            audioPlayerRef.current.pause()
            audioPlayerRef.current = null
        }

        // Create and play new audio
        try {
            let audioUrl = voice.audioUrl

            // If we have a file path but no blob URL, read file via Electron and create blob
            if (!audioUrl && voice.path && window.electronAPI?.tts) {
                console.log('Reading audio file from:', voice.path)
                try {
                    const result = await window.electronAPI.tts.readAudio(voice.path)
                    if (result.success) {
                        const uint8Array = new Uint8Array(result.data)
                        const blob = new Blob([uint8Array], { type: result.mimeType })
                        audioUrl = URL.createObjectURL(blob)
                        console.log('Created blob URL:', audioUrl)
                    } else {
                        console.error('Failed to read audio file:', result.error)
                        alert('Kh√¥ng th·ªÉ ƒë·ªçc file audio: ' + result.error)
                        return
                    }
                } catch (e) {
                    console.error('Error reading audio file:', e)
                    alert('L·ªói khi ƒë·ªçc file audio')
                    return
                }
            }

            if (!audioUrl) {
                alert('Kh√¥ng t√¨m th·∫•y audio URL')
                return
            }

            console.log('Attempting to play audio from:', audioUrl)
            const audio = new Audio(audioUrl)

            audio.onended = () => {
                console.log('Audio playback ended')
                setIsPlaying(null)
                audioPlayerRef.current = null
            }

            audio.onerror = (e) => {
                console.error('Audio playback error:', e)
                console.error('Error target:', e.target)
                console.error('Error details:', e.target.error)
                alert('Kh√¥ng th·ªÉ ph√°t audio. File c√≥ th·ªÉ b·ªã l·ªói.')
                setIsPlaying(null)
                audioPlayerRef.current = null
            }

            audio.onloadeddata = () => {
                console.log('Audio data loaded successfully')
            }

            audio.play().catch(err => {
                console.error('Play error:', err)
                alert('Kh√¥ng th·ªÉ ph√°t audio')
                setIsPlaying(null)
                audioPlayerRef.current = null
            })

            audioPlayerRef.current = audio
            setIsPlaying(voice.id)
            console.log('Audio playback initiated')
        } catch (error) {
            console.error('Playback error:', error)
            alert('L·ªói khi ph√°t audio')
        }
    }

    const updateTranscript = (id, transcript) => {
        setVoices(prev => prev.map(v => v.id === id ? { ...v, transcript } : v))
    }

    const generateTTS = async () => {
        if (!ttsText.trim() || !selectedVoice) return

        const refVoice = voices.find(v => v.id === selectedVoice)
        if (!refVoice || !refVoice.path) {
            alert('Vui l√≤ng ch·ªçn gi·ªçng m·∫´u ƒë√£ upload')
            return
        }

        setIsGenerating(true)
        setGeneratedAudio(null)

        try {
            let result
            if (window.electronAPI?.tts) {
                result = await window.electronAPI.tts.generate({
                    refAudio: refVoice.path,
                    refText: refVoice.transcript || '',
                    genText: ttsText,
                    speed: 1.0
                })
            } else {
                // Demo mode
                await new Promise(r => setTimeout(r, 2000))
                result = { success: true, audioPath: refVoice.audioUrl }
            }

            if (result.success) {
                setGeneratedAudio({
                    path: result.audioPath,
                    url: result.audioPath.startsWith('file://') ? result.audioPath : `file://${result.audioPath}`
                })
            } else {
                alert('L·ªói: ' + result.error)
            }
        } catch (e) {
            alert('L·ªói t·∫°o gi·ªçng n√≥i: ' + e.message)
        } finally {
            setIsGenerating(false)
        }
    }

    const playGenerated = async () => {
        if (!generatedAudio) return

        try {
            let audioUrl = generatedAudio.url

            // If URL is file://, read via IPC and create blob
            if (audioUrl && audioUrl.startsWith('file://')) {
                const filepath = audioUrl.replace('file://', '')
                console.log('Reading generated audio from:', filepath)

                if (window.electronAPI?.tts) {
                    const result = await window.electronAPI.tts.readAudio(filepath)
                    if (result.success) {
                        const uint8Array = new Uint8Array(result.data)
                        const blob = new Blob([uint8Array], { type: result.mimeType })
                        audioUrl = URL.createObjectURL(blob)
                        console.log('Created blob URL for playback:', audioUrl)
                    } else {
                        alert('Kh√¥ng th·ªÉ ƒë·ªçc file audio: ' + result.error)
                        return
                    }
                }
            } else if (generatedAudio.path && window.electronAPI?.tts) {
                // Fallback: use path directly
                const result = await window.electronAPI.tts.readAudio(generatedAudio.path)
                if (result.success) {
                    const uint8Array = new Uint8Array(result.data)
                    const blob = new Blob([uint8Array], { type: result.mimeType })
                    audioUrl = URL.createObjectURL(blob)
                } else {
                    alert('Kh√¥ng th·ªÉ ƒë·ªçc file: ' + result.error)
                    return
                }
            }

            if (!audioUrl) {
                alert('Kh√¥ng t√¨m th·∫•y audio URL')
                return
            }

            const audio = new Audio(audioUrl)
            audio.play().catch(err => {
                console.error('Playback error:', err)
                alert('Kh√¥ng th·ªÉ ph√°t audio')
            })
        } catch (error) {
            console.error('Error playing generated audio:', error)
            alert('L·ªói khi ph√°t audio')
        }
    }
    return (
        <div className="space-y-8">
            {/* Header */}
            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h1 className="text-3xl font-bold text-white tracking-tight">Voice Training</h1>
                    <p className="text-slate-400 mt-1">Voice Cloning v·ªõi F5-TTS Vietnamese</p>
                </div>
                <div className="flex items-center gap-3">
                    <div className={`flex items-center gap-2 px-4 py-2 rounded-xl text-sm ${ttsStatus === 'ready'
                        ? 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20'
                        : ttsStatus === 'checking' || ttsStatus === 'installing'
                            ? 'bg-amber-500/10 text-amber-400 border border-amber-500/20'
                            : 'bg-rose-500/10 text-rose-400 border border-rose-500/20'
                        }`}>
                        {ttsStatus === 'ready' && <><Check className="w-4 h-4" /> F5-TTS Ready</>}
                        {ttsStatus === 'checking' && <><RefreshCw className="w-4 h-4 animate-spin" /> ƒêang ki·ªÉm tra...</>}
                        {ttsStatus === 'installing' && <><RefreshCw className="w-4 h-4 animate-spin" /> ƒêang c√†i ƒë·∫∑t...</>}
                        {ttsStatus === 'not_installed' && <><AlertCircle className="w-4 h-4" /> Ch∆∞a c√†i ƒë·∫∑t</>}
                        {ttsStatus === 'demo' && <><Check className="w-4 h-4" /> Demo Mode</>}
                    </div>
                    <a
                        href="https://huggingface.co/hynt/F5-TTS-Vietnamese-ViVoice"
                        target="_blank"
                        rel="noopener noreferrer"
                        className="flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 border border-white/10 text-slate-400 hover:text-white transition-all text-sm"
                    >
                        <ExternalLink className="w-4 h-4" />
                        Model
                    </a>
                </div>
            </div>

            {/* Install Card */}
            {ttsStatus === 'not_installed' && (
                <div className="rounded-2xl bg-gradient-to-r from-amber-500/10 to-orange-500/5 border border-amber-500/20 p-6">
                    <div className="flex items-start gap-4">
                        <div className="w-12 h-12 rounded-xl bg-amber-500/20 flex items-center justify-center shrink-0">
                            <Server className="w-6 h-6 text-amber-400" />
                        </div>
                        <div className="flex-1">
                            <h3 className="font-bold text-white mb-2">C√†i ƒë·∫∑t F5-TTS Vietnamese</h3>
                            <p className="text-sm text-slate-400 mb-4">
                                Ch·∫°y l·ªánh sau ho·∫∑c nh·∫•n "C√†i ƒë·∫∑t t·ª± ƒë·ªông":
                            </p>
                            <div className="bg-[#0a0a12] rounded-xl p-4 font-mono text-xs text-slate-300 mb-4 overflow-x-auto">
                                <code>cd python && pip install -e F5-TTS-Vietnamese</code>
                            </div>

                            {installLog.length > 0 && (
                                <div className="bg-[#0a0a12] rounded-xl p-4 mb-4 max-h-32 overflow-y-auto">
                                    {installLog.map((log, i) => (
                                        <p key={i} className="text-xs font-mono text-slate-400">{log}</p>
                                    ))}
                                </div>
                            )}

                            <div className="flex gap-3">
                                <button
                                    onClick={installF5TTS}
                                    disabled={ttsStatus === 'installing'}
                                    className="flex items-center gap-2 px-4 py-2 rounded-xl bg-amber-500 text-black font-medium hover:bg-amber-400 transition-colors disabled:opacity-50"
                                >
                                    {ttsStatus === 'installing' ? (
                                        <><RefreshCw className="w-4 h-4 animate-spin" /> ƒêang c√†i...</>
                                    ) : (
                                        <><Download className="w-4 h-4" /> C√†i ƒë·∫∑t t·ª± ƒë·ªông</>
                                    )}
                                </button>
                                <button
                                    onClick={checkStatus}
                                    className="flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 text-slate-400 hover:text-white transition-colors"
                                >
                                    <RefreshCw className="w-4 h-4" /> Ki·ªÉm tra l·∫°i
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            )}

            {/* Info Card */}
            <div className="rounded-2xl bg-gradient-to-r from-violet-500/10 to-purple-500/5 border border-violet-500/20 p-6">
                <div className="flex items-start gap-4">
                    <div className="w-12 h-12 rounded-xl bg-violet-500/20 flex items-center justify-center shrink-0">
                        <Volume2 className="w-6 h-6 text-violet-400" />
                    </div>
                    <div className="flex-1">
                        <h3 className="font-bold text-white mb-1">F5-TTS Vietnamese ViVoice</h3>
                        <p className="text-sm text-slate-400 mb-3">
                            Voice Cloning AI - Nh√¢n b·∫£n gi·ªçng n√≥i t·ª´ 3-10 gi√¢y audio m·∫´u. Train tr√™n 1000h data ti·∫øng Vi·ªát.
                        </p>
                        <div className="flex flex-wrap gap-2">
                            <span className="px-2.5 py-1 rounded-lg bg-emerald-500/10 text-emerald-400 text-xs font-medium">1000h Dataset</span>
                            <span className="px-2.5 py-1 rounded-lg bg-cyan-500/10 text-cyan-400 text-xs font-medium">Voice Cloning</span>
                            <span className="px-2.5 py-1 rounded-lg bg-amber-500/10 text-amber-400 text-xs font-medium">Zero-shot TTS</span>
                        </div>
                    </div>
                </div>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                {/* Main Panel */}
                <div className="lg:col-span-2 space-y-6">
                    {/* Recording */}
                    <div className="rounded-2xl bg-white/[0.03] border border-white/10 p-8">
                        <h3 className="text-lg font-bold text-white mb-6 flex items-center gap-2">
                            <Mic className="w-5 h-5 text-violet-400" />
                            Thu √¢m gi·ªçng m·∫´u (Reference Audio)
                        </h3>
                        <div className="text-center">
                            <div className="relative inline-block mb-6">
                                <button
                                    onClick={() => {
                                        console.log('Button clicked! isRecording:', isRecording)
                                        if (isRecording) {
                                            stopRecording()
                                        } else {
                                            startRecording()
                                        }
                                    }}
                                    className={`relative w-28 h-28 rounded-full flex items-center justify-center transition-all ${isRecording
                                        ? 'bg-rose-500 shadow-[0_0_40px_rgba(239,68,68,0.4)] hover:bg-rose-600'
                                        : 'bg-gradient-to-br from-violet-500 to-purple-600 hover:shadow-[0_0_30px_rgba(139,92,246,0.4)]'
                                        }`}
                                >
                                    {isRecording ? (
                                        <div className="w-8 h-8 bg-white rounded-md"></div>
                                    ) : (
                                        <Mic className="w-10 h-10 text-white" />
                                    )}
                                </button>
                                {isRecording && (
                                    <div className="absolute -bottom-4 left-1/2 -translate-x-1/2 whitespace-nowrap pointer-events-none">
                                        <div className="px-3 py-1 rounded-full bg-rose-500/20 border border-rose-500/30">
                                            <span className="text-xs text-rose-300 font-medium">Click ƒë·ªÉ d·ª´ng</span>
                                        </div>
                                    </div>
                                )}
                                {isRecording && (
                                    <div className="absolute -inset-4 border-4 border-rose-500/30 rounded-full animate-ping pointer-events-none" />
                                )}
                            </div>

                            <p className="text-4xl font-bold text-white font-mono mb-4">
                                {formatTime(recordingTime)}
                            </p>

                            <p className="text-slate-300 text-sm mb-2">
                                {isRecording
                                    ? 'ƒêang thu √¢m... Nh·∫•n ƒë·ªÉ d·ª´ng'
                                    : 'Nh·∫•n ƒë·ªÉ thu √¢m gi·ªçng m·∫´u (3-30 gi√¢y)'}
                            </p>

                            {isRecording && (
                                <div className="mt-6 flex items-center justify-center gap-1 h-12">
                                    {[...Array(24)].map((_, i) => {
                                        const baseHeight = 20 + Math.sin(i * 0.5) * 15
                                        const animDuration = 0.8 + (i % 5) * 0.1
                                        return (
                                            <div
                                                key={i}
                                                className="w-1 bg-violet-500 rounded-full animate-pulse"
                                                style={{
                                                    height: `${baseHeight}px`,
                                                    animationDuration: `${animDuration}s`,
                                                    animationDelay: `${i * 30}ms`
                                                }}
                                            />
                                        )
                                    })}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Generate */}
                    <div className="rounded-2xl bg-white/[0.03] border border-white/10 p-6">
                        <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <Zap className="w-5 h-5 text-cyan-400" />
                            T·∫°o gi·ªçng n√≥i (Voice Cloning)
                        </h3>

                        {voices.length === 0 ? (
                            <div className="text-center py-8">
                                <AlertCircle className="w-10 h-10 text-slate-500 mx-auto mb-3" />
                                <p className="text-slate-400">Thu √¢m gi·ªçng m·∫´u tr∆∞·ªõc</p>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                {/* Select Reference */}
                                <div>
                                    <label className="block text-sm font-medium text-slate-400 mb-2">1. Ch·ªçn gi·ªçng m·∫´u</label>
                                    <div className="flex flex-wrap gap-2">
                                        {voices.map(voice => (
                                            <button
                                                key={voice.id}
                                                onClick={() => setSelectedVoice(voice.id)}
                                                className={`px-4 py-2 rounded-xl text-sm font-medium transition-all ${selectedVoice === voice.id
                                                    ? 'bg-violet-500 text-white'
                                                    : 'bg-white/5 text-slate-400 hover:text-white hover:bg-white/10'
                                                    }`}
                                            >
                                                {voice.name}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Transcript */}
                                {selectedVoice && (
                                    <div>
                                        <label className="block text-sm font-medium text-slate-400 mb-2">
                                            2. Transcript (n·ªôi dung audio m·∫´u ƒë·ªçc)
                                        </label>
                                        <div className="flex gap-2">
                                            <input
                                                type="text"
                                                value={voices.find(v => v.id === selectedVoice)?.transcript || ''}
                                                onChange={(e) => updateTranscript(selectedVoice, e.target.value)}
                                                placeholder="Nh·∫≠p n·ªôi dung m√† audio m·∫´u ƒëang ƒë·ªçc..."
                                                className="flex-1 px-4 py-3 rounded-xl bg-[#0a0a12] border border-white/10 text-white placeholder-slate-500 text-sm focus:outline-none focus:border-violet-500/50 transition-colors"
                                            />
                                            <button
                                                onClick={async () => {
                                                    const voice = voices.find(v => v.id === selectedVoice);
                                                    if (!voice?.path) return;

                                                    setIsGenerating(true);
                                                    try {
                                                        // Step 1: Whisper transcription
                                                        const result = await window.electronAPI.tts.transcribeAudio(voice.path);
                                                        if (result.success) {
                                                            let finalText = result.text;

                                                            // Step 2: Qwen post-processing (if enabled)
                                                            if (useQwenCorrection) {
                                                                const qwenResult = await window.electronAPI.qwen.processText(result.text, 'correct');
                                                                if (qwenResult.success) {
                                                                    finalText = qwenResult.text;
                                                                }
                                                            }

                                                            updateTranscript(selectedVoice, finalText);
                                                        } else {
                                                            alert('L·ªói: ' + result.error);
                                                        }
                                                    } catch (error) {
                                                        alert('L·ªói transcribe: ' + error.message);
                                                    }
                                                    setIsGenerating(false);
                                                }}
                                                disabled={isGenerating}
                                                className="px-4 py-3 rounded-xl bg-violet-500/20 hover:bg-violet-500/30 text-violet-400 text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                                                title="Auto-transcribe audio"
                                            >
                                                {isGenerating ? (
                                                    <RefreshCw className="w-4 h-4 animate-spin" />
                                                ) : (
                                                    <AudioLines className="w-4 h-4" />
                                                )}
                                                <span className="hidden sm:inline">Auto</span>
                                            </button>
                                        </div>
                                    </div>
                                )}

                                {/* Text to Generate */}
                                <div>
                                    <label className="block text-sm font-medium text-slate-400 mb-2">
                                        3. VƒÉn b·∫£n c·∫ßn t·∫°o
                                    </label>
                                    <textarea
                                        value={ttsText}
                                        onChange={(e) => setTtsText(e.target.value)}
                                        placeholder="Nh·∫≠p vƒÉn b·∫£n ti·∫øng Vi·ªát..."
                                        className="w-full px-4 py-3 rounded-xl bg-[#0a0a12] border border-white/10 text-white placeholder-slate-500 text-sm focus:outline-none focus:border-violet-500/50 resize-none h-24"
                                    />
                                </div>

                                {/* Generate Button */}
                                <button
                                    onClick={generateTTS}
                                    disabled={!ttsText.trim() || !selectedVoice || isGenerating}
                                    className="w-full flex items-center justify-center gap-2 py-3 rounded-xl bg-gradient-to-r from-violet-500 to-purple-600 text-white font-medium hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    {isGenerating ? (
                                        <><RefreshCw className="w-5 h-5 animate-spin" /> ƒêang t·∫°o...</>
                                    ) : (
                                        <><Zap className="w-5 h-5" /> T·∫°o gi·ªçng n√≥i</>
                                    )}
                                </button>

                                {/* Result */}
                                {generatedAudio && (
                                    <div className="p-4 rounded-xl bg-emerald-500/10 border border-emerald-500/20">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <div className="w-10 h-10 rounded-lg bg-emerald-500/20 flex items-center justify-center">
                                                    <Check className="w-5 h-5 text-emerald-400" />
                                                </div>
                                                <div>
                                                    <p className="font-medium text-white text-sm">Th√†nh c√¥ng!</p>
                                                    <p className="text-xs text-slate-400 truncate max-w-[200px]">{generatedAudio.path}</p>
                                                </div>
                                            </div>
                                            <div className="flex gap-2">
                                                <button onClick={playGenerated} className="p-2 rounded-lg bg-white/10 hover:bg-emerald-500/20">
                                                    <Play className="w-4 h-4 text-white" />
                                                </button>
                                                <a href={generatedAudio.url} download className="p-2 rounded-lg bg-white/10 hover:bg-violet-500/20">
                                                    <Download className="w-4 h-4 text-white" />
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>

                    {/* Generated Voices List */}
                    <div className="rounded-2xl bg-white/[0.03] border border-white/10 overflow-hidden">
                        <div className="px-6 py-5 border-b border-white/5 flex items-center justify-between">
                            <h2 className="text-lg font-bold text-white flex items-center gap-3">
                                <Zap className="w-5 h-5 text-emerald-400" />
                                Gi·ªçng ƒë√£ t·∫°o
                            </h2>
                            <span className="text-sm text-slate-400">{generatedVoices.length}</span>
                        </div>

                        {generatedVoices.length === 0 ? (
                            <div className="p-8 text-center">
                                <AlertCircle className="w-10 h-10 text-slate-500 mx-auto mb-3" />
                                <p className="text-slate-500 text-sm">Ch∆∞a c√≥ gi·ªçng n√†o ƒë∆∞·ª£c t·∫°o</p>
                            </div>
                        ) : (
                            <div className="divide-y divide-white/5 max-h-[400px] overflow-y-auto">
                                {generatedVoices.map(voice => (
                                    <div
                                        key={voice.id}
                                        className="px-4 py-3 hover:bg-white/[0.02] group"
                                    >
                                        <div className="flex items-center gap-3">
                                            <button
                                                onClick={() => playVoice(voice)}
                                                className="shrink-0 w-9 h-9 rounded-lg bg-white/5 flex items-center justify-center hover:bg-emerald-500/20"
                                            >
                                                {isPlaying === voice.id ? (
                                                    <Pause className="w-4 h-4 text-emerald-400" />
                                                ) : (
                                                    <Play className="w-4 h-4 text-emerald-400" />
                                                )}
                                            </button>

                                            <div className="flex-1 min-w-0">
                                                <p className="font-medium text-white text-sm truncate">{voice.name}</p>
                                                <p className="text-xs text-slate-500 mt-0.5">
                                                    {new Date(voice.timestamp).toLocaleString('vi-VN', {
                                                        day: '2-digit',
                                                        month: '2-digit',
                                                        hour: '2-digit',
                                                        minute: '2-digit'
                                                    })}
                                                </p>
                                            </div>

                                            <a
                                                href={`file://${voice.path}`}
                                                download
                                                className="shrink-0 p-1.5 rounded-lg hover:bg-white/10 text-slate-400 hover:text-emerald-400 opacity-0 group-hover:opacity-100 transition-opacity"
                                                title="Download"
                                            >
                                                <Download className="w-3.5 h-3.5" />
                                            </a>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* Reference Voices List */}
                    <div className="rounded-2xl bg-white/[0.03] border border-white/10 overflow-hidden">
                        <div className="px-6 py-5 border-b border-white/5 flex items-center justify-between">
                            <h2 className="text-lg font-bold text-white flex items-center gap-3">
                                <FileAudio className="w-5 h-5 text-cyan-400" />
                                Gi·ªçng m·∫´u
                            </h2>
                            <span className="text-sm text-slate-400">{voices.length}</span>
                        </div>

                        {voices.length === 0 ? (
                            <div className="p-8 text-center">
                                <Mic className="w-10 h-10 text-slate-500 mx-auto mb-3" />
                                <p className="text-slate-500 text-sm">Ch∆∞a c√≥ gi·ªçng m·∫´u</p>
                                <p className="text-slate-600 text-xs">Thu √¢m 3-10 gi√¢y</p>
                            </div>
                        ) : (
                            <div className="divide-y divide-white/5 max-h-[500px] overflow-y-auto">
                                {voices.map(voice => (
                                    <div
                                        key={voice.id}
                                        className={`px-4 py-3 hover:bg-white/[0.02] cursor-pointer ${selectedVoice === voice.id ? 'bg-violet-500/10 border-l-2 border-violet-500' : ''}`}
                                        onClick={() => setSelectedVoice(voice.id)}
                                    >
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <button
                                                    onClick={(e) => { e.stopPropagation(); playVoice(voice) }}
                                                    className="w-9 h-9 rounded-lg bg-white/5 flex items-center justify-center hover:bg-violet-500/20"
                                                >
                                                    {isPlaying === voice.id ? (
                                                        <Pause className="w-4 h-4 text-violet-400" />
                                                    ) : (
                                                        <Play className="w-4 h-4 text-slate-400" />
                                                    )}
                                                </button>
                                                <div>
                                                    <p className="font-medium text-white text-sm truncate max-w-[120px]">{voice.name}</p>
                                                    <p className="text-xs text-slate-500">{voice.duration || '---'}</p>
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-1">
                                                {voice.path && <span className="px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-400 text-xs">‚úì</span>}
                                                <button
                                                    onClick={(e) => { e.stopPropagation(); deleteVoice(voice.id) }}
                                                    className="p-1.5 rounded-lg hover:bg-rose-500/10 text-slate-400 hover:text-rose-400"
                                                >
                                                    <Trash2 className="w-3.5 h-3.5" />
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            </div>
        </div>
    )
}
</file>

<file path="src/pages/VoiceTraining.jsx.backup">
import { useState, useRef, useEffect } from 'react'
import { Mic, Upload, Play, Pause, Trash2, AudioLines, AlertCircle, Check, RefreshCw, Download, ExternalLink, Volume2, Zap, Server, FileAudio } from 'lucide-react'

export default function VoiceTraining() {
    const [voices, setVoices] = useState([])
    const [isRecording, setIsRecording] = useState(false)
    const [recordingTime, setRecordingTime] = useState(0)
    const [isPlaying, setIsPlaying] = useState(null)
    const [generatedVoices, setGeneratedVoices] = useState([])
    const [selectedVoice, setSelectedVoice] = useState(null)
    const [ttsText, setTtsText] = useState('xin ch√†o m·ªçi ng∆∞·ªùi h√¥m nay l√† th·ª© b·∫£y')
    const [isGenerating, setIsGenerating] = useState(false)
    const [generatedAudio, setGeneratedAudio] = useState(null)
    const [ttsStatus, setTtsStatus] = useState(null) // null, 'checking', 'ready', 'not_installed', 'installing'
    const [installLog, setInstallLog] = useState([])
    const mediaRecorderRef = useRef(null)
    const audioChunksRef = useRef([])
    const timerRef = useRef(null)
    const audioPlayerRef = useRef(null) // Store current audio instance

    useEffect(() => {
        checkStatus()
        loadRefAudios()
        loadGeneratedAudios()

        // Cleanup on unmount
        return () => {
            // Stop recording if active
            if (mediaRecorderRef.current && isRecording) {
                mediaRecorderRef.current.stop()
                mediaRecorderRef.current.stream.getTracks().forEach(track => track.stop())
            }

            // Clear timer
            if (timerRef.current) {
                clearInterval(timerRef.current)
            }

            // Stop audio playback
            if (audioPlayerRef.current) {
                audioPlayerRef.current.pause()
                audioPlayerRef.current = null
            }

            // Revoke blob URLs
            voices.forEach(v => {
                if (v?.audioUrl?.startsWith('blob:')) {
                    URL.revokeObjectURL(v.audioUrl)
                }
            })
        }
    }, [])

    const checkStatus = async () => {
        setTtsStatus('checking')
        try {
            if (window.electronAPI?.tts) {
                const status = await window.electronAPI.tts.getStatus()
                setTtsStatus(status)
            } else {
                setTtsStatus('demo')
            }
        } catch (e) {
            setTtsStatus('not_installed')
        }
    }

    const loadRefAudios = async () => {
        try {
            if (window.electronAPI?.tts) {
                const refs = await window.electronAPI.tts.listRefs()
                if (refs.length > 0) {
                    setVoices(refs.map((r, i) => ({
                        id: i + 1,
                        name: r.filename,
                        path: r.path,
                        // Don't set audioUrl - will be created as blob URL on-demand when playing
                        transcript: '',
                        status: 'ready'
                    })))
                }
            }
        } catch (e) {
            console.error('Error loading refs:', e)
        }
    }

    const loadGeneratedAudios = async () => {
        try {
            if (window.electronAPI?.tts) {
                const outputs = await window.electronAPI.tts.listOutputs()
                if (outputs.length > 0) {
                    setGeneratedVoices(outputs.map((o, i) => ({
                        id: `gen_${i}`,
                        name: o.filename,
                        path: o.path,
                        timestamp: new Date(o.stats.mtimeMs), // Convert to Date object
                        status: 'ready'
                    })))
                }
            }
        } catch (e) {
            console.error('Error loading generated audios:', e)
        }
    }

    const installF5TTS = async () => {
        setTtsStatus('installing')
        setInstallLog(['üéôÔ∏è ƒêang c√†i ƒë·∫∑t F5-TTS Vietnamese...'])

        try {
            if (window.electronAPI?.tts) {
                const result = await window.electronAPI.tts.install()
                if (result.success || result.ready) {
                    setInstallLog(prev => [...prev, '‚úÖ C√†i ƒë·∫∑t ho√†n t·∫•t!'])
                    setTtsStatus('ready')
                } else {
                    setInstallLog(prev => [...prev, `‚ùå L·ªói: ${result.error}`])
                    setTtsStatus('not_installed')
                }
            }
        } catch (e) {
            setInstallLog(prev => [...prev, `‚ùå L·ªói: ${e.message}`])
            setTtsStatus('not_installed')
        }
    }

    const formatTime = (seconds) => {
        const mins = Math.floor(seconds / 60)
        const secs = seconds % 60
        return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`
    }

    const startRecording = async () => {
        console.log('=== START RECORDING CALLED ===')
        try {
            // Better audio constraints for TTS quality
            const stream = await navigator.mediaDevices.getUserMedia({
                audio: {
                    echoCancellation: true,      // Remove echo
                    noiseSuppression: true,       // Remove background noise
                    autoGainControl: true,        // Normalize volume
                    channelCount: 1,              // Mono
                    sampleRate: 48000             // High quality sample rate
                }
            })
            console.log('Microphone stream obtained with enhanced constraints')

            mediaRecorderRef.current = new MediaRecorder(stream)
            audioChunksRef.current = []

            mediaRecorderRef.current.ondataavailable = (event) => {
                console.log('Data available, size:', event.data.size)
                audioChunksRef.current.push(event.data)
            }

            mediaRecorderRef.current.onstop = async () => {
                console.log('=== RECORDING STOPPED, processing... ===')
                console.log('Audio chunks collected:', audioChunksRef.current.length)

                // MediaRecorder produces WebM/Opus, not WAV
                const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/webm' })
                console.log('Audio blob created, size:', audioBlob.size)
                const filename = `ref_${Date.now()}.webm`

                // Upload to backend
                let serverPath = null
                try {
                    if (window.electronAPI?.tts) {
                        console.log('Uploading to backend...')
                        const arrayBuffer = await audioBlob.arrayBuffer()
                        const result = await window.electronAPI.tts.uploadRef(arrayBuffer, filename)
                        if (result.success) {
                            serverPath = result.path
                            console.log('Upload successful, path:', serverPath)

                            // Convert WebM to WAV for better TTS quality
                            try {
                                console.log('Converting to WAV...')
                                const convResult = await window.electronAPI.tts.convertToWav(serverPath)
                                if (convResult.success) {
                                    serverPath = convResult.wavPath
                                    console.log('Conversion successful, WAV path:', serverPath)
                                } else {
                                    console.error('Conversion failed:', convResult.error)
                                    alert('C·∫£nh b√°o: Kh√¥ng th·ªÉ convert sang WAV. L∆∞u format WebM.')
                                    // Continue with WebM path
                                }
                            } catch (convError) {
                                console.error('Conversion error:', convError)
                                alert('L·ªói conversion: ' + convError.message)
                                // Continue with WebM path if conversion fails
                            }
                        }
                    }
                } catch (e) {
                    console.warn('Could not upload:', e)
                }

                const audioUrl = URL.createObjectURL(audioBlob)
                const newVoice = {
                    id: Date.now(),
                    name: serverPath ? serverPath.split('/').pop() : filename, // Use actual filename from server
                    duration: formatTime(recordingTime),
                    createdAt: new Date().toLocaleDateString('vi-VN'),
                    status: 'ready',
                    audioUrl,
                    audioBlob,
                    path: serverPath,
                    transcript: ''
                }
                console.log('Adding new voice to list:', newVoice.name)
                setVoices(prev => [newVoice, ...prev])

                // Reload from backend after a delay to ensure WAV conversion completes
                if (serverPath) {
                    setTimeout(() => {
                        console.log('Reloading voices from backend...')
                        loadRefAudios()
                    }, 2000) // Increased from 1000ms to 2000ms for WAV conversion
                }
            }

            mediaRecorderRef.current.start()
            console.log('MediaRecorder started, setting isRecording to true')
            setIsRecording(true)
            setRecordingTime(0)

            timerRef.current = setInterval(() => {
                setRecordingTime(prev => prev + 1)
            }, 1000)
            console.log('Timer started')
        } catch (error) {
            console.error('Recording error:', error)
            alert('Kh√¥ng th·ªÉ truy c·∫≠p microphone')
        }
    }

    const stopRecording = () => {
        console.log('stopRecording called, isRecording:', isRecording)
        if (mediaRecorderRef.current && isRecording) {
            console.log('Stopping MediaRecorder...')
            mediaRecorderRef.current.stop()
            mediaRecorderRef.current.stream.getTracks().forEach(track => track.stop())
        }
        setIsRecording(false)
        if (timerRef.current) {
            clearInterval(timerRef.current)
            timerRef.current = null
        }
        console.log('stopRecording completed')
    }

    const deleteVoice = async (id) => {
        const voice = voices.find(v => v.id === id)

        // Delete from backend if it has a path
        if (voice?.path && window.electronAPI?.tts) {
            try {
                console.log('Deleting voice file:', voice.path)
                const result = await window.electronAPI.tts.deleteRef(voice.path)
                if (!result.success) {
                    console.error('Failed to delete file:', result.error)
                    alert('Kh√¥ng th·ªÉ x√≥a file: ' + result.error)
                    return // Don't proceed if delete failed
                }
                console.log('File deleted successfully')
            } catch (e) {
                console.error('Error deleting voice file:', e)
                alert('L·ªói khi x√≥a file')
                return
            }
        }

        // Revoke blob URL if exists
        if (voice?.audioUrl?.startsWith('blob:')) {
            URL.revokeObjectURL(voice.audioUrl)
        }

        // Remove from state
        setVoices(prev => prev.filter(v => v.id !== id))
        if (selectedVoice === id) setSelectedVoice(null)

        // Reload from backend to stay in sync
        setTimeout(() => loadRefAudios(), 300)
    }

    const playVoice = async (voice) => {
        console.log('=== PLAY VOICE CALLED ===')
        console.log('Voice object:', voice)
        console.log('Voice audioUrl:', voice.audioUrl)
        console.log('Voice path:', voice.path)

        // Toggle off if clicking same voice - PAUSE FIRST
        if (isPlaying === voice.id) {
            console.log('Pausing current playback')
            if (audioPlayerRef.current) {
                audioPlayerRef.current.pause()
                audioPlayerRef.current = null
            }
            setIsPlaying(null)
            return
        }

        // Stop current playback if switching to different voice
        if (audioPlayerRef.current) {
            console.log('Stopping different voice playback')
            audioPlayerRef.current.pause()
            audioPlayerRef.current = null
        }

        // Create and play new audio
        try {
            let audioUrl = voice.audioUrl

            // If we have a file path but no blob URL, read file via Electron and create blob
            if (!audioUrl && voice.path && window.electronAPI?.tts) {
                console.log('Reading audio file from:', voice.path)
                try {
                    const result = await window.electronAPI.tts.readAudio(voice.path)
                    if (result.success) {
                        const blob = new Blob([result.data], { type: result.mimeType })
                        audioUrl = URL.createObjectURL(blob)
                        console.log('Created blob URL:', audioUrl)
                    } else {
                        console.error('Failed to read audio file:', result.error)
                        alert('Kh√¥ng th·ªÉ ƒë·ªçc file audio: ' + result.error)
                        return
                    }
                } catch (e) {
                    console.error('Error reading audio file:', e)
                    alert('L·ªói khi ƒë·ªçc file audio')
                    return
                }
            }

            if (!audioUrl) {
                alert('Kh√¥ng t√¨m th·∫•y audio URL')
                return
            }

            console.log('Attempting to play audio from:', audioUrl)
            const audio = new Audio(audioUrl)

            audio.onended = () => {
                console.log('Audio playback ended')
                setIsPlaying(null)
                audioPlayerRef.current = null
            }

            audio.onerror = (e) => {
                console.error('Audio playback error:', e)
                console.error('Error target:', e.target)
                console.error('Error details:', e.target.error)
                alert('Kh√¥ng th·ªÉ ph√°t audio. File c√≥ th·ªÉ b·ªã l·ªói.')
                setIsPlaying(null)
                audioPlayerRef.current = null
            }

            audio.onloadeddata = () => {
                console.log('Audio data loaded successfully')
            }

            audio.play().catch(err => {
                console.error('Play error:', err)
                alert('Kh√¥ng th·ªÉ ph√°t audio')
                setIsPlaying(null)
                audioPlayerRef.current = null
            })

            audioPlayerRef.current = audio
            setIsPlaying(voice.id)
            console.log('Audio playback initiated')
        } catch (error) {
            console.error('Playback error:', error)
            alert('L·ªói khi ph√°t audio')
        }
    }

    const updateTranscript = (id, transcript) => {
        setVoices(prev => prev.map(v => v.id === id ? { ...v, transcript } : v))
    }

    const generateTTS = async () => {
        if (!ttsText.trim() || !selectedVoice) return

        const refVoice = voices.find(v => v.id === selectedVoice)
        if (!refVoice || !refVoice.path) {
            alert('Vui l√≤ng ch·ªçn gi·ªçng m·∫´u ƒë√£ upload')
            return
        }

        setIsGenerating(true)
        setGeneratedAudio(null)

        try {
            let result
            if (window.electronAPI?.tts) {
                result = await window.electronAPI.tts.generate({
                    refAudio: refVoice.path,
                    refText: refVoice.transcript || '',
                    genText: ttsText,
                    speed: 1.0
                })
            } else {
                // Demo mode
                await new Promise(r => setTimeout(r, 2000))
                result = { success: true, audioPath: refVoice.audioUrl }
            }

            if (result.success) {
                setGeneratedAudio({
                    path: result.audioPath,
                    url: result.audioPath.startsWith('file://') ? result.audioPath : `file://${result.audioPath}`
                })
            } else {
                alert('L·ªói: ' + result.error)
            }
        } catch (e) {
            alert('L·ªói t·∫°o gi·ªçng n√≥i: ' + e.message)
        } finally {
            setIsGenerating(false)
        }
    }

    const playGenerated = async () => {
        if (!generatedAudio) return

        try {
            let audioUrl = generatedAudio.url

            // If URL is file://, read via IPC and create blob
            if (audioUrl && audioUrl.startsWith('file://')) {
                const filepath = audioUrl.replace('file://', '')
                console.log('Reading generated audio from:', filepath)

                if (window.electronAPI?.tts) {
                    const result = await window.electronAPI.tts.readAudio(filepath)
                    if (result.success) {
                        const blob = new Blob([result.data], { type: result.mimeType })
                        audioUrl = URL.createObjectURL(blob)
                        console.log('Created blob URL for playback:', audioUrl)
                    } else {
                        alert('Kh√¥ng th·ªÉ ƒë·ªçc file audio: ' + result.error)
                        return
                    }
                }
            }

            if (!audioUrl) {
                alert('Kh√¥ng t√¨m th·∫•y audio URL')
                return
            }

            const audio = new Audio(audioUrl)
            audio.play().catch(err => {
                console.error('Playback error:', err)
                alert('Kh√¥ng th·ªÉ ph√°t audio')
            })
        } catch (error) {
            console.error('Error playing generated audio:', error)
            alert('L·ªói khi ph√°t audio')
        }
    }
    return (
        <div className="space-y-8">
            {/* Header */}
            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h1 className="text-3xl font-bold text-white tracking-tight">Voice Training</h1>
                    <p className="text-slate-400 mt-1">Voice Cloning v·ªõi F5-TTS Vietnamese</p>
                </div>
                <div className="flex items-center gap-3">
                    <div className={`flex items-center gap-2 px-4 py-2 rounded-xl text-sm ${ttsStatus === 'ready'
                        ? 'bg-emerald-500/10 text-emerald-400 border border-emerald-500/20'
                        : ttsStatus === 'checking' || ttsStatus === 'installing'
                            ? 'bg-amber-500/10 text-amber-400 border border-amber-500/20'
                            : 'bg-rose-500/10 text-rose-400 border border-rose-500/20'
                        }`}>
                        {ttsStatus === 'ready' && <><Check className="w-4 h-4" /> F5-TTS Ready</>}
                        {ttsStatus === 'checking' && <><RefreshCw className="w-4 h-4 animate-spin" /> ƒêang ki·ªÉm tra...</>}
                        {ttsStatus === 'installing' && <><RefreshCw className="w-4 h-4 animate-spin" /> ƒêang c√†i ƒë·∫∑t...</>}
                        {ttsStatus === 'not_installed' && <><AlertCircle className="w-4 h-4" /> Ch∆∞a c√†i ƒë·∫∑t</>}
                        {ttsStatus === 'demo' && <><Check className="w-4 h-4" /> Demo Mode</>}
                    </div>
                    <a
                        href="https://huggingface.co/hynt/F5-TTS-Vietnamese-ViVoice"
                        target="_blank"
                        rel="noopener noreferrer"
                        className="flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 border border-white/10 text-slate-400 hover:text-white transition-all text-sm"
                    >
                        <ExternalLink className="w-4 h-4" />
                        Model
                    </a>
                </div>
            </div>

            {/* Install Card */}
            {ttsStatus === 'not_installed' && (
                <div className="rounded-2xl bg-gradient-to-r from-amber-500/10 to-orange-500/5 border border-amber-500/20 p-6">
                    <div className="flex items-start gap-4">
                        <div className="w-12 h-12 rounded-xl bg-amber-500/20 flex items-center justify-center shrink-0">
                            <Server className="w-6 h-6 text-amber-400" />
                        </div>
                        <div className="flex-1">
                            <h3 className="font-bold text-white mb-2">C√†i ƒë·∫∑t F5-TTS Vietnamese</h3>
                            <p className="text-sm text-slate-400 mb-4">
                                Ch·∫°y l·ªánh sau ho·∫∑c nh·∫•n "C√†i ƒë·∫∑t t·ª± ƒë·ªông":
                            </p>
                            <div className="bg-[#0a0a12] rounded-xl p-4 font-mono text-xs text-slate-300 mb-4 overflow-x-auto">
                                <code>cd python && pip install -e F5-TTS-Vietnamese</code>
                            </div>

                            {installLog.length > 0 && (
                                <div className="bg-[#0a0a12] rounded-xl p-4 mb-4 max-h-32 overflow-y-auto">
                                    {installLog.map((log, i) => (
                                        <p key={i} className="text-xs font-mono text-slate-400">{log}</p>
                                    ))}
                                </div>
                            )}

                            <div className="flex gap-3">
                                <button
                                    onClick={installF5TTS}
                                    disabled={ttsStatus === 'installing'}
                                    className="flex items-center gap-2 px-4 py-2 rounded-xl bg-amber-500 text-black font-medium hover:bg-amber-400 transition-colors disabled:opacity-50"
                                >
                                    {ttsStatus === 'installing' ? (
                                        <><RefreshCw className="w-4 h-4 animate-spin" /> ƒêang c√†i...</>
                                    ) : (
                                        <><Download className="w-4 h-4" /> C√†i ƒë·∫∑t t·ª± ƒë·ªông</>
                                    )}
                                </button>
                                <button
                                    onClick={checkStatus}
                                    className="flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 text-slate-400 hover:text-white transition-colors"
                                >
                                    <RefreshCw className="w-4 h-4" /> Ki·ªÉm tra l·∫°i
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            )}

            {/* Info Card */}
            <div className="rounded-2xl bg-gradient-to-r from-violet-500/10 to-purple-500/5 border border-violet-500/20 p-6">
                <div className="flex items-start gap-4">
                    <div className="w-12 h-12 rounded-xl bg-violet-500/20 flex items-center justify-center shrink-0">
                        <Volume2 className="w-6 h-6 text-violet-400" />
                    </div>
                    <div className="flex-1">
                        <h3 className="font-bold text-white mb-1">F5-TTS Vietnamese ViVoice</h3>
                        <p className="text-sm text-slate-400 mb-3">
                            Voice Cloning AI - Nh√¢n b·∫£n gi·ªçng n√≥i t·ª´ 3-10 gi√¢y audio m·∫´u. Train tr√™n 1000h data ti·∫øng Vi·ªát.
                        </p>
                        <div className="flex flex-wrap gap-2">
                            <span className="px-2.5 py-1 rounded-lg bg-emerald-500/10 text-emerald-400 text-xs font-medium">1000h Dataset</span>
                            <span className="px-2.5 py-1 rounded-lg bg-cyan-500/10 text-cyan-400 text-xs font-medium">Voice Cloning</span>
                            <span className="px-2.5 py-1 rounded-lg bg-amber-500/10 text-amber-400 text-xs font-medium">Zero-shot TTS</span>
                        </div>
                    </div>
                </div>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                {/* Main Panel */}
                <div className="lg:col-span-2 space-y-6">
                    {/* Recording */}
                    <div className="rounded-2xl bg-white/[0.03] border border-white/10 p-8">
                        <h3 className="text-lg font-bold text-white mb-6 flex items-center gap-2">
                            <Mic className="w-5 h-5 text-violet-400" />
                            Thu √¢m gi·ªçng m·∫´u (Reference Audio)
                        </h3>
                        <div className="text-center">
                            <div className="relative inline-block mb-6">
                                <button
                                    onClick={() => {
                                        console.log('Button clicked! isRecording:', isRecording)
                                        if (isRecording) {
                                            stopRecording()
                                        } else {
                                            startRecording()
                                        }
                                    }}
                                    className={`relative w-28 h-28 rounded-full flex items-center justify-center transition-all ${isRecording
                                        ? 'bg-rose-500 shadow-[0_0_40px_rgba(239,68,68,0.4)] hover:bg-rose-600'
                                        : 'bg-gradient-to-br from-violet-500 to-purple-600 hover:shadow-[0_0_30px_rgba(139,92,246,0.4)]'
                                        }`}
                                >
                                    {isRecording ? (
                                        <div className="w-8 h-8 bg-white rounded-md"></div>
                                    ) : (
                                        <Mic className="w-10 h-10 text-white" />
                                    )}
                                </button>
                                {isRecording && (
                                    <div className="absolute -bottom-4 left-1/2 -translate-x-1/2 whitespace-nowrap pointer-events-none">
                                        <div className="px-3 py-1 rounded-full bg-rose-500/20 border border-rose-500/30">
                                            <span className="text-xs text-rose-300 font-medium">Click ƒë·ªÉ d·ª´ng</span>
                                        </div>
                                    </div>
                                )}
                                {isRecording && (
                                    <div className="absolute -inset-4 border-4 border-rose-500/30 rounded-full animate-ping pointer-events-none" />
                                )}
                            </div>

                            <p className="text-4xl font-bold text-white font-mono mb-4">
                                {formatTime(recordingTime)}
                            </p>

                            <p className="text-slate-300 text-sm mb-2">
                                {isRecording
                                    ? 'ƒêang thu √¢m... Nh·∫•n ƒë·ªÉ d·ª´ng'
                                    : 'Nh·∫•n ƒë·ªÉ thu √¢m gi·ªçng m·∫´u (3-30 gi√¢y)'}
                            </p>

                            {isRecording && (
                                <div className="mt-6 flex items-center justify-center gap-1 h-12">
                                    {[...Array(24)].map((_, i) => {
                                        const baseHeight = 20 + Math.sin(i * 0.5) * 15
                                        const animDuration = 0.8 + (i % 5) * 0.1
                                        return (
                                            <div
                                                key={i}
                                                className="w-1 bg-violet-500 rounded-full animate-pulse"
                                                style={{
                                                    height: `${baseHeight}px`,
                                                    animationDuration: `${animDuration}s`,
                                                    animationDelay: `${i * 30}ms`
                                                }}
                                            />
                                        )
                                    })}
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Generate */}
                    <div className="rounded-2xl bg-white/[0.03] border border-white/10 p-6">
                        <h3 className="text-lg font-bold text-white mb-4 flex items-center gap-2">
                            <Zap className="w-5 h-5 text-cyan-400" />
                            T·∫°o gi·ªçng n√≥i (Voice Cloning)
                        </h3>

                        {voices.length === 0 ? (
                            <div className="text-center py-8">
                                <AlertCircle className="w-10 h-10 text-slate-500 mx-auto mb-3" />
                                <p className="text-slate-400">Thu √¢m gi·ªçng m·∫´u tr∆∞·ªõc</p>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                {/* Select Reference */}
                                <div>
                                    <label className="block text-sm font-medium text-slate-400 mb-2">1. Ch·ªçn gi·ªçng m·∫´u</label>
                                    <div className="flex flex-wrap gap-2">
                                        {voices.map(voice => (
                                            <button
                                                key={voice.id}
                                                onClick={() => setSelectedVoice(voice.id)}
                                                className={`px-4 py-2 rounded-xl text-sm font-medium transition-all ${selectedVoice === voice.id
                                                    ? 'bg-violet-500 text-white'
                                                    : 'bg-white/5 text-slate-400 hover:text-white hover:bg-white/10'
                                                    }`}
                                            >
                                                {voice.name}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Transcript */}
                                {selectedVoice && (
                                    <div>
                                        <label className="block text-sm font-medium text-slate-400 mb-2">
                                            2. Transcript (n·ªôi dung audio m·∫´u ƒë·ªçc)
                                        </label>
                                        <input
                                            type="text"
                                            value={voices.find(v => v.id === selectedVoice)?.transcript || ''}
                                            onChange={(e) => updateTranscript(selectedVoice, e.target.value)}
                                            placeholder="Nh·∫≠p n·ªôi dung m√† audio m·∫´u ƒëang ƒë·ªçc..."
                                            className="w-full px-4 py-3 rounded-xl bg-[#0a0a12] border border-white/10 text-white placeholder-slate-500 text-sm focus:outline-none focus:border-violet-500/50 transition-colors"
                                        />
                                    </div>
                                )}

                                {/* Text to Generate */}
                                <div>
                                    <label className="block text-sm font-medium text-slate-400 mb-2">
                                        3. VƒÉn b·∫£n c·∫ßn t·∫°o
                                    </label>
                                    <textarea
                                        value={ttsText}
                                        onChange={(e) => setTtsText(e.target.value)}
                                        placeholder="Nh·∫≠p vƒÉn b·∫£n ti·∫øng Vi·ªát..."
                                        className="w-full px-4 py-3 rounded-xl bg-[#0a0a12] border border-white/10 text-white placeholder-slate-500 text-sm focus:outline-none focus:border-violet-500/50 resize-none h-24"
                                    />
                                </div>

                                {/* Generate Button */}
                                <button
                                    onClick={generateTTS}
                                    disabled={!ttsText.trim() || !selectedVoice || isGenerating || (ttsStatus !== 'ready' && ttsStatus !== 'demo')}
                                    className="w-full flex items-center justify-center gap-2 py-3 rounded-xl bg-gradient-to-r from-violet-500 to-purple-600 text-white font-medium hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    {isGenerating ? (
                                        <><RefreshCw className="w-5 h-5 animate-spin" /> ƒêang t·∫°o...</>
                                    ) : (
                                        <><Zap className="w-5 h-5" /> T·∫°o gi·ªçng n√≥i</>
                                    )}
                                </button>

                                {/* Result */}
                                {generatedAudio && (
                                    <div className="p-4 rounded-xl bg-emerald-500/10 border border-emerald-500/20">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <div className="w-10 h-10 rounded-lg bg-emerald-500/20 flex items-center justify-center">
                                                    <Check className="w-5 h-5 text-emerald-400" />
                                                </div>
                                                <div>
                                                    <p className="font-medium text-white text-sm">Th√†nh c√¥ng!</p>
                                                    <p className="text-xs text-slate-400 truncate max-w-[200px]">{generatedAudio.path}</p>
                                                </div>
                                            </div>
                                            <div className="flex gap-2">
                                                <button onClick={playGenerated} className="p-2 rounded-lg bg-white/10 hover:bg-emerald-500/20">
                                                    <Play className="w-4 h-4 text-white" />
                                                </button>
                                                <a href={generatedAudio.url} download className="p-2 rounded-lg bg-white/10 hover:bg-violet-500/20">
                                                    <Download className="w-4 h-4 text-white" />
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>

                    {/* Generated Voices List */}
                    <div className="rounded-2xl bg-white/[0.03] border border-white/10 overflow-hidden">
                        <div className="px-6 py-5 border-b border-white/5 flex items-center justify-between">
                            <h2 className="text-lg font-bold text-white flex items-center gap-3">
                                <Zap className="w-5 h-5 text-emerald-400" />
                                Gi·ªçng ƒë√£ t·∫°o
                            </h2>
                            <span className="text-sm text-slate-400">{generatedVoices.length}</span>
                        </div>

                        {generatedVoices.length === 0 ? (
                            <div className="p-8 text-center">
                                <AlertCircle className="w-10 h-10 text-slate-500 mx-auto mb-3" />
                                <p className="text-slate-500 text-sm">Ch∆∞a c√≥ gi·ªçng n√†o ƒë∆∞·ª£c t·∫°o</p>
                            </div>
                        ) : (
                            <div className="divide-y divide-white/5 max-h-[400px] overflow-y-auto">
                                {generatedVoices.map(voice => (
                                    <div
                                        key={voice.id}
                                        className="px-4 py-3 hover:bg-white/[0.02] group"
                                    >
                                        <div className="flex items-center gap-3">
                                            <button
                                                onClick={() => playVoice(voice)}
                                                className="shrink-0 w-9 h-9 rounded-lg bg-white/5 flex items-center justify-center hover:bg-emerald-500/20"
                                            >
                                                {isPlaying === voice.id ? (
                                                    <Pause className="w-4 h-4 text-emerald-400" />
                                                ) : (
                                                    <Play className="w-4 h-4 text-emerald-400" />
                                                )}
                                            </button>

                                            <div className="flex-1 min-w-0">
                                                <p className="font-medium text-white text-sm truncate">{voice.name}</p>
                                                <p className="text-xs text-slate-500 mt-0.5">
                                                    {new Date(voice.timestamp).toLocaleString('vi-VN', {
                                                        day: '2-digit',
                                                        month: '2-digit',
                                                        hour: '2-digit',
                                                        minute: '2-digit'
                                                    })}
                                                </p>
                                            </div>

                                            <a
                                                href={`file://${voice.path}`}
                                                download
                                                className="shrink-0 p-1.5 rounded-lg hover:bg-white/10 text-slate-400 hover:text-emerald-400 opacity-0 group-hover:opacity-100 transition-opacity"
                                                title="Download"
                                            >
                                                <Download className="w-3.5 h-3.5" />
                                            </a>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* Reference Voices List */}
                    <div className="rounded-2xl bg-white/[0.03] border border-white/10 overflow-hidden">
                        <div className="px-6 py-5 border-b border-white/5 flex items-center justify-between">
                            <h2 className="text-lg font-bold text-white flex items-center gap-3">
                                <FileAudio className="w-5 h-5 text-cyan-400" />
                                Gi·ªçng m·∫´u
                            </h2>
                            <span className="text-sm text-slate-400">{voices.length}</span>
                        </div>

                        {voices.length === 0 ? (
                            <div className="p-8 text-center">
                                <Mic className="w-10 h-10 text-slate-500 mx-auto mb-3" />
                                <p className="text-slate-500 text-sm">Ch∆∞a c√≥ gi·ªçng m·∫´u</p>
                                <p className="text-slate-600 text-xs">Thu √¢m 3-10 gi√¢y</p>
                            </div>
                        ) : (
                            <div className="divide-y divide-white/5 max-h-[500px] overflow-y-auto">
                                {voices.map(voice => (
                                    <div
                                        key={voice.id}
                                        className={`px-4 py-3 hover:bg-white/[0.02] cursor-pointer ${selectedVoice === voice.id ? 'bg-violet-500/10 border-l-2 border-violet-500' : ''}`}
                                        onClick={() => setSelectedVoice(voice.id)}
                                    >
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <button
                                                    onClick={(e) => { e.stopPropagation(); playVoice(voice) }}
                                                    className="w-9 h-9 rounded-lg bg-white/5 flex items-center justify-center hover:bg-violet-500/20"
                                                >
                                                    {isPlaying === voice.id ? (
                                                        <Pause className="w-4 h-4 text-violet-400" />
                                                    ) : (
                                                        <Play className="w-4 h-4 text-slate-400" />
                                                    )}
                                                </button>
                                                <div>
                                                    <p className="font-medium text-white text-sm truncate max-w-[120px]">{voice.name}</p>
                                                    <p className="text-xs text-slate-500">{voice.duration || '---'}</p>
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-1">
                                                {voice.path && <span className="px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-400 text-xs">‚úì</span>}
                                                <button
                                                    onClick={(e) => { e.stopPropagation(); deleteVoice(voice.id) }}
                                                    className="p-1.5 rounded-lg hover:bg-rose-500/10 text-slate-400 hover:text-rose-400"
                                                >
                                                    <Trash2 className="w-3.5 h-3.5" />
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            </div>
        </div>
    )
}
</file>

<file path="src/store/useStore.js">
import { create } from 'zustand'

const useStore = create((set, get) => ({
    stats: {
        totalCalls: 0,
        todayCalls: 0,
        successRate: 0,
        avgDuration: '0:00'
    },
    recentCalls: [],
    settings: {},
    isLoading: false,
    isElectron: false,

    fetchDashboardData: async () => {
        set({ isLoading: true })
        try {
            if (window.electronAPI?.db) {
                set({ isElectron: true })
                const [stats, recentCalls] = await Promise.all([
                    window.electronAPI.db.getStats(),
                    window.electronAPI.db.getRecentCalls()
                ])
                set({ stats, recentCalls })
            } else {
                // Browser mode - show empty state (no mock data)
                console.warn('Electron API not found, showing empty state')
                set({
                    isElectron: false,
                    stats: {
                        totalCalls: 0,
                        todayCalls: 0,
                        successRate: 0,
                        avgDuration: '0:00'
                    },
                    recentCalls: []
                })
            }
        } catch (error) {
            console.error('Failed to fetch dashboard data:', error)
        } finally {
            set({ isLoading: false })
        }
    },

    fetchSettings: async () => {
        try {
            if (window.electronAPI?.db) {
                const settings = await window.electronAPI.db.getSettings()
                set({ settings })
            }
        } catch (error) {
            console.error('Failed to fetch settings:', error)
        }
    }
}))

export default useStore
</file>

<file path="src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="src/App.jsx">
import { Routes, Route } from 'react-router-dom'
import Layout from './components/Layout'
import Dashboard from './pages/Dashboard'
import CallCenter from './pages/CallCenter'
import VoiceTraining from './pages/VoiceTraining'
import ModelManager from './pages/ModelManager'
import TrainingData from './pages/TrainingData'
import Chat from './pages/Chat'
import History from './pages/History'
import Settings from './pages/Settings'

function App() {
  return (
    <Layout>
      <Routes>
        <Route path="/" element={<Dashboard />} />
        <Route path="/calls" element={<CallCenter />} />
        <Route path="/voice-training" element={<VoiceTraining />} />
        <Route path="/models" element={<ModelManager />} />
        <Route path="/training-data" element={<TrainingData />} />
        <Route path="/chat" element={<Chat />} />
        <Route path="/history" element={<History />} />
        <Route path="/settings" element={<Settings />} />
      </Routes>
    </Layout>
  )
}

export default App
</file>

<file path="src/index.css">
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  * {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  }

  body {
    @apply antialiased;
  }

  /* Custom Scrollbar */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  ::-webkit-scrollbar-track {
    @apply bg-transparent;
  }

  ::-webkit-scrollbar-thumb {
    @apply bg-gradient-to-b from-violet-500/40 to-purple-500/40 rounded-full;
    border: 2px solid transparent;
    background-clip: padding-box;
  }

  ::-webkit-scrollbar-thumb:hover {
    @apply from-violet-500/60 to-purple-500/60;
  }

  /* Text Selection */
  ::selection {
    @apply bg-violet-500/30 text-white;
  }

  /* Focus Styles */
  *:focus-visible {
    @apply outline-none ring-2 ring-violet-500/50 ring-offset-2 ring-offset-[#0a0a12];
  }
}
</file>

<file path="src/main.jsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import { BrowserRouter } from 'react-router-dom'
import App from './App.jsx'
import './index.css'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <BrowserRouter>
      <App />
    </BrowserRouter>
  </StrictMode>,
)
</file>

<file path="training-data/banking_knowledge_vietnamese.txt">
# Banking Customer Service Training Data (Vietnamese)

## Instruction-Response Pairs

### Q: L√†m sao ƒë·ªÉ ƒë·ªïi m√£ PIN th·∫ª ATM?
A: ƒê·ªÉ ƒë·ªïi m√£ PIN th·∫ª ATM: 1) T·∫°i ATM: Ch·ªçn "ƒê·ªïi m√£ PIN" ‚Üí Nh·∫≠p PIN c≈© ‚Üí Nh·∫≠p PIN m·ªõi 2 l·∫ßn, 2) Qua Internet Banking: V√†o m·ª•c "Qu·∫£n l√Ω th·∫ª" ‚Üí ƒê·ªïi PIN, 3) T·∫°i chi nh√°nh: Mang CMND + th·∫ª ATM. L∆∞u √Ω: M√£ PIN 6 s·ªë, tr√°nh d√πng s·ªë ƒë∆°n gi·∫£n (111111, 123456).

### Q: Th·ªùi gian x·ª≠ l√Ω khi·∫øu n·∫°i giao d·ªãch m·∫•t bao l√¢u?
A: Th·ªùi gian x·ª≠ l√Ω khi·∫øu n·∫°i: 1) Giao d·ªãch ATM: 15-30 ng√†y, 2) Giao d·ªãch online: 7-15 ng√†y, 3) Giao d·ªãch th·∫ª: 30-45 ng√†y (c√≥ th·ªÉ l√™n 90 ng√†y cho tranh ch·∫•p qu·ªëc t·∫ø). Ng√¢n h√†ng s·∫Ω SMS/email th√¥ng b√°o k·∫øt qu·∫£.

### Q: T√†i kho·∫£n b·ªã kh√≥a ph·∫£i l√†m sao?
A: T√†i kho·∫£n b·ªã kh√≥a do: 1) Nh·∫≠p sai m·∫≠t kh·∫©u/PIN li√™n t·ª•c 5 l·∫ßn, 2) Giao d·ªãch b·∫•t th∆∞·ªùng, 3) L·ªánh phong t·ªèa c·ªßa c∆° quan ch·ª©c nƒÉng. X·ª≠ l√Ω: G·ªçi hotline ho·∫∑c ƒë·∫øn chi nh√°nh mang CMND ƒë·ªÉ m·ªü kh√≥a. Th·ªùi gian: 10-30 ph√∫t.

### Q: Vay t√≠n ch·∫•p online c√≥ l·ª´a ƒë·∫£o kh√¥ng?
A: Vay t√≠n ch·∫•p online qua ng√¢n h√†ng/c√¥ng ty t√†i ch√≠nh ƒë∆∞·ª£c c·∫•p ph√©p l√† an to√†n. D·∫•u hi·ªáu l·ª´a ƒë·∫£o: 1) Y√™u c·∫ßu chuy·ªÉn ti·ªÅn tr∆∞·ªõc, 2) H·ª©a duy·ªát 100% kh√¥ng c·∫ßn ƒëi·ªÅu ki·ªán, 3) Kh√¥ng c√≥ gi·∫•y ph√©p kinh doanh. Ch·ªâ vay t·∫°i: Ng√¢n h√†ng TMCP, FE Credit, Home Credit, VPBank, VIB.

### Q: S·ªï ti·∫øt ki·ªám gi·∫•y c√≥ c√≤n gi√° tr·ªã kh√¥ng?
A: S·ªï ti·∫øt ki·ªám gi·∫•y v·∫´n c√≥ gi√° tr·ªã ph√°p l√Ω v√† ƒë∆∞·ª£c b·∫£o v·ªá. ∆Øu ƒëi·ªÉm: B·∫£o m·∫≠t cao, kh√¥ng lo hacker. Nh∆∞·ª£c ƒëi·ªÉm: M·∫•t s·ªï ph·∫£i b√°o, kh√¥ng theo d√µi online, r√∫t ti·ªÅn ph·∫£i ƒë·∫øn ng√¢n h√†ng. C√≥ th·ªÉ chuy·ªÉn ƒë·ªïi sang s·ªï ƒëi·ªán t·ª≠ (ePassbook) mi·ªÖn ph√≠.

---

## Text Correction Pairs

Input: "cho toi biet so du tai khoan hien tai"
Output: "Cho t√¥i bi·∫øt s·ªë d∆∞ t√†i kho·∫£n hi·ªán t·∫°i."

Input: "toi can ho tro ve dich vu ngan hang dien tu"
Output: "T√¥i c·∫ßn h·ªó tr·ª£ v·ªÅ d·ªãch v·ª• ng√¢n h√†ng ƒëi·ªán t·ª≠."

Input: "lam the gi de tang han muc tin dung"
Output: "L√†m th·∫ø g√¨ ƒë·ªÉ tƒÉng h·∫°n m·ª©c t√≠n d·ª•ng?"

Input: "phi rut tien o atm khac ngan hang la bao nhieu"
Output: "Ph√≠ r√∫t ti·ªÅn ·ªü ATM kh√°c ng√¢n h√†ng l√† bao nhi√™u?"

Input: "toi bi mat the tai khoan phai lam sao"
Output: "T√¥i b·ªã m·∫•t th·∫ª t√†i kho·∫£n ph·∫£i l√†m sao?"

---

## Banking Terminology (Vietnamese)

- T√†i kho·∫£n thanh to√°n: Current account
- T√†i kho·∫£n ti·∫øt ki·ªám: Savings account
- Th·∫ª ghi n·ª£: Debit card
- Th·∫ª t√≠n d·ª•ng: Credit card
- Chuy·ªÉn kho·∫£n li√™n ng√¢n h√†ng: Interbank transfer
- L√£i su·∫•t: Interest rate
- H·∫°n m·ª©c: Credit limit
- K·ª≥ h·∫°n: Maturity period
- N·ª£ x·∫•u: Bad debt / Non-performing loan
- Th·∫•u chi: Overdraft
- B·∫£o l√£nh: Guarantee
- C·∫ßm c·ªë / Th·∫ø ch·∫•p: Mortgage / Collateral
- T√≠n ch·∫•p: Unsecured loan
- OTP (One-Time Password): M√£ x√°c th·ª±c m·ªôt l·∫ßn
- eKYC: X√°c minh danh t√≠nh ƒëi·ªán t·ª≠

---

## Common Customer Intents

1. Account inquiry (H·ªèi th√¥ng tin t√†i kho·∫£n)
2. Transaction support (H·ªó tr·ª£ giao d·ªãch)
3. Card services (D·ªãch v·ª• th·∫ª)
4. Loan information (Th√¥ng tin vay v·ªën)
5. Complaint handling (X·ª≠ l√Ω khi·∫øu n·∫°i)
6. Technical support (H·ªó tr·ª£ k·ªπ thu·∫≠t)
7. Account security (B·∫£o m·∫≠t t√†i kho·∫£n)
8. Fee information (Th√¥ng tin ph√≠)
9. Interest rate inquiry (H·ªèi l√£i su·∫•t)
10. Banking hours (Gi·ªù l√†m vi·ªác)
</file>

<file path="training-data/banking_qa_vietnamese.csv">
instruction,input,output
"Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng","L√†m sao ƒë·ªÉ ƒëƒÉng k√Ω Mobile Banking?","ƒê·ªÉ ƒëƒÉng k√Ω Mobile Banking: 1) T·∫£i app ng√¢n h√†ng tr√™n CH Play/App Store, 2) Ch·ªçn 'ƒêƒÉng k√Ω m·ªõi', 3) Nh·∫≠p s·ªë t√†i kho·∫£n/s·ªë th·∫ª, 4) X√°c th·ª±c OTP qua SMS, 5) T·∫°o username v√† m·∫≠t kh·∫©u. Ho·∫∑c ƒë·∫øn chi nh√°nh mang CMND ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£."
"Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng","H·ªßy th·∫ª t√≠n d·ª•ng c√≥ m·∫•t ph√≠ kh√¥ng?","H·ªßy th·∫ª t√≠n d·ª•ng mi·ªÖn ph√≠ n·∫øu: 1) ƒê√£ thanh to√°n h·∫øt n·ª£, 2) Kh√¥ng vi ph·∫°m h·ª£p ƒë·ªìng. Quy tr√¨nh: G·ªçi hotline y√™u c·∫ßu h·ªßy ‚Üí Thanh to√°n d∆∞ n·ª£ (n·∫øu c√≥) ‚Üí C·∫Øt th·∫ª v√† g·ª≠i l·∫°i ng√¢n h√†ng ho·∫∑c ƒë·∫øn chi nh√°nh. Th·ªùi gian x·ª≠ l√Ω: 7-15 ng√†y."
"Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng","L√£i su·∫•t vay t√≠n ch·∫•p ng√¢n h√†ng n√†o r·∫ª nh·∫•t?","L√£i su·∫•t vay t√≠n ch·∫•p dao ƒë·ªông 10-24%/nƒÉm. C√°c ng√¢n h√†ng c√≥ l√£i su·∫•t t·ªët: VPBank (t·ª´ 11%/nƒÉm), VIB (t·ª´ 12%/nƒÉm), TPBank (t·ª´ 13%/nƒÉm). L√£i su·∫•t ph·ª• thu·ªôc: Thu nh·∫≠p, l·ªãch s·ª≠ t√≠n d·ª•ng, th·ªùi h·∫°n vay. N√™n so s√°nh nhi·ªÅu ng√¢n h√†ng tr∆∞·ªõc khi quy·∫øt ƒë·ªãnh."
"Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng","Th·∫ª t·ª´ v√† th·∫ª chip kh√°c nhau nh∆∞ th·∫ø n√†o?","Th·∫ª t·ª´: C√¥ng ngh·ªá c≈©, d·ªÖ b·ªã ƒë√°nh c·∫Øp th√¥ng tin, ƒëang b·ªã thay th·∫ø. Th·∫ª chip: B·∫£o m·∫≠t cao h∆°n, c√≥ chip ƒëi·ªán t·ª≠, kh√≥ sao ch√©p. T·ª´ 2021 Vi·ªát Nam chuy·ªÉn ƒë·ªïi ho√†n to√†n sang th·∫ª chip. Mi·ªÖn ph√≠ ƒë·ªïi th·∫ª t·ª´ sang chip t·∫°i h·∫ßu h·∫øt ng√¢n h√†ng."
"Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng","Giao d·ªãch online b·ªã l·ªói, ti·ªÅn b·ªã tr·ª´ nh∆∞ng ch∆∞a nh·∫≠n ƒë∆∞·ª£c h√†ng?","Khi giao d·ªãch online b·ªã l·ªói: 1) Screenshot m√£ giao d·ªãch, 2) Ki·ªÉm tra sao k√™ t√†i kho·∫£n, 3) Li√™n h·ªá hotline ng√¢n h√†ng ƒë·ªÉ khi·∫øu n·∫°i (trong 24h), 4) Cung c·∫•p: M√£ GD, th·ªùi gian, s·ªë ti·ªÅn. Ng√¢n h√†ng s·∫Ω ho√†n ti·ªÅn trong 15-30 ng√†y n·∫øu x√°c nh·∫≠n l·ªói."
"S·ª≠a l·ªói c√¢u vƒÉn","toi muon gui tiet kiem ky han 12 thang lai cao","T√¥i mu·ªën g·ª≠i ti·∫øt ki·ªám k·ª≥ h·∫°n 12 th√°ng l√£i cao."
"S·ª≠a l·ªói c√¢u vƒÉn","ban co the huong dan cach mo tai khoan ngan hang khong","B·∫°n c√≥ th·ªÉ h∆∞·ªõng d·∫´n c√°ch m·ªü t√†i kho·∫£n ng√¢n h√†ng kh√¥ng?"
"S·ª≠a l·ªói c√¢u vƒÉn","phi chuyen khoan lien ngan hang qua internet banking","Ph√≠ chuy·ªÉn kho·∫£n li√™n ng√¢n h√†ng qua Internet Banking."
"S·ª≠a l·ªói c√¢u vƒÉn","lam sao de kiem tra lich su giao dich the tin dung","L√†m sao ƒë·ªÉ ki·ªÉm tra l·ªãch s·ª≠ giao d·ªãch th·∫ª t√≠n d·ª•ng?"
"S·ª≠a l·ªói c√¢u vƒÉn","toi bi quen ma pin the atm phai lam gi day","T√¥i b·ªã qu√™n m√£ PIN th·∫ª ATM ph·∫£i l√†m g√¨ ƒë√¢y?"
</file>

<file path="training-data/banking_qa_vietnamese.json">
[
    {
        "instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng",
        "input": "L√†m sao ƒë·ªÉ m·ªü t√†i kho·∫£n ti·∫øt ki·ªám online?",
        "output": "ƒê·ªÉ m·ªü t√†i kho·∫£n ti·∫øt ki·ªám online, b·∫°n c·∫ßn: 1) ƒêƒÉng nh·∫≠p ·ª©ng d·ª•ng ng√¢n h√†ng, 2) Ch·ªçn 'M·ªü s·ªï ti·∫øt ki·ªám', 3) Nh·∫≠p s·ªë ti·ªÅn g·ª≠i v√† k·ª≥ h·∫°n, 4) X√°c nh·∫≠n OTP. L√£i su·∫•t dao ƒë·ªông 4-6%/nƒÉm t√πy k·ª≥ h·∫°n."
    },
    {
        "instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng",
        "input": "L√†m th·∫ª t√≠n d·ª•ng m·∫•t bao l√¢u?",
        "output": "Th·ªùi gian l√†m th·∫ª t√≠n d·ª•ng th∆∞·ªùng 7-10 ng√†y l√†m vi·ªác. B·∫°n c·∫ßn chu·∫©n b·ªã: CMND/CCCD, Gi·∫•y x√°c nh·∫≠n thu nh·∫≠p, H·ªô kh·∫©u ho·∫∑c s·ªï t·∫°m tr√∫. H·∫°n m·ª©c ph·ª• thu·ªôc v√†o thu nh·∫≠p v√† l·ªãch s·ª≠ t√≠n d·ª•ng."
    },
    {
        "instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng",
        "input": "Chuy·ªÉn ti·ªÅn nhanh 24/7 l√† g√¨?",
        "output": "Chuy·ªÉn ti·ªÅn nhanh 24/7 (Napas 247) l√† d·ªãch v·ª• chuy·ªÉn kho·∫£n li√™n ng√¢n h√†ng trong v√≤ng 10 gi√¢y, ho·∫°t ƒë·ªông c·∫£ ng√†y l·ªÖ v√† cu·ªëi tu·∫ßn. Ph√≠ giao d·ªãch: 1,650ƒë - 3,300ƒë t√πy ng√¢n h√†ng, h·∫°n m·ª©c 500 tri·ªáu/giao d·ªãch."
    },
    {
        "instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng",
        "input": "Vay t√≠n ch·∫•p c·∫ßn ƒëi·ªÅu ki·ªán g√¨?",
        "output": "ƒêi·ªÅu ki·ªán vay t√≠n ch·∫•p: 1) Tu·ªïi 20-55, c√≥ thu nh·∫≠p ·ªïn ƒë·ªãnh t·ª´ 5 tri·ªáu/th√°ng, 2) Th·ªùi gian c√¥ng t√°c t·ªëi thi·ªÉu 6 th√°ng, 3) Kh√¥ng n·ª£ x·∫•u t·∫°i ng√¢n h√†ng. L√£i su·∫•t 1-2%/th√°ng, h·∫°n m·ª©c l√™n ƒë·∫øn 20 l·∫ßn thu nh·∫≠p."
    },
    {
        "instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng",
        "input": "SMS Banking c√≥ t·ªën ph√≠ kh√¥ng?",
        "output": "SMS Banking mi·ªÖn ph√≠ khi ƒëƒÉng k√Ω, ch·ªâ t√≠nh ph√≠ tin nh·∫Øn SMS th√¥ng th∆∞·ªùng t·ª´ nh√† m·∫°ng (kho·∫£ng 200ƒë/tin). B·∫°n nh·∫≠n th√¥ng b√°o giao d·ªãch, s·ªë d∆∞ t√†i kho·∫£n realtime. ƒê·ªÉ ƒëƒÉng k√Ω, g·ª≠i DK<S·ªê TK> ƒë·∫øn 9xxx."
    },
    {
        "instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng",
        "input": "M·∫•t th·∫ª ATM ph·∫£i l√†m g√¨?",
        "output": "Khi m·∫•t th·∫ª ATM: 1) G·ªçi hotline ng√¢n h√†ng ngay ƒë·ªÉ kh√≥a th·∫ª (24/7), 2) ƒê·∫øn chi nh√°nh mang CMND ƒë·ªÉ b√°o m·∫•t v√† l√†m l·∫°i th·∫ª m·ªõi, 3) Ph√≠ l√†m l·∫°i th·∫ª: 50,000ƒë - 100,000ƒë. Th·ªùi gian nh·∫≠n th·∫ª m·ªõi: 3-5 ng√†y."
    },
    {
        "instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng",
        "input": "L√£i su·∫•t vay mua nh√† hi·ªán nay l√† bao nhi√™u?",
        "output": "L√£i su·∫•t vay mua nh√† dao ƒë·ªông 8-12%/nƒÉm t√πy ng√¢n h√†ng v√† th·ªùi gian vay. L√£i su·∫•t ∆∞u ƒë√£i 6-8%/nƒÉm trong 6-12 th√°ng ƒë·∫ßu. H·ªó tr·ª£ vay t·ªëi ƒëa 70-80% gi√° tr·ªã nh√†, th·ªùi h·∫°n l√™n ƒë·∫øn 25 nƒÉm."
    },
    {
        "instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng",
        "input": "Internet Banking c√≥ an to√†n kh√¥ng?",
        "output": "Internet Banking r·∫•t an to√†n v·ªõi: 1) M√£ h√≥a SSL 256-bit, 2) X√°c th·ª±c 2 l·ªõp (m·∫≠t kh·∫©u + OTP), 3) Th√¥ng b√°o giao d·ªãch realtime. L∆∞u √Ω: Kh√¥ng chia s·∫ª m·∫≠t kh·∫©u, OTP v·ªõi ai, t·∫Øt m√°y t√≠nh sau khi giao d·ªãch, c·∫≠p nh·∫≠t ph·∫ßn m·ªÅm di·ªát virus."
    },
    {
        "instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng",
        "input": "R√∫t ti·ªÅn ATM m·∫•t ph√≠ bao nhi√™u?",
        "output": "Ph√≠ r√∫t ti·ªÅn ATM: Mi·ªÖn ph√≠ t·∫°i ATM c√πng ng√¢n h√†ng, 1,100ƒë - 3,300ƒë t·∫°i ATM li√™n ng√¢n h√†ng (t√πy ng√¢n h√†ng). H·∫°n m·ª©c: 5-50 tri·ªáu/ng√†y t√πy lo·∫°i th·∫ª. Giao d·ªãch t·ª´ 21h-6h c√≥ th·ªÉ t√≠nh ph√≠ ngo√†i gi·ªù."
    },
    {
        "instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng",
        "input": "ƒêƒÉng k√Ω eKYC l√† g√¨?",
        "output": "eKYC (Electronic Know Your Customer) l√† x√°c minh danh t√≠nh qua video call: 1) Ch·ª•p CMND/CCCD 2 m·∫∑t, 2) Video ghi h√¨nh khu√¥n m·∫∑t v√† ƒë·ªçc th√¥ng tin, 3) AI x√°c th·ª±c trong 30 gi√¢y. M·ªü t√†i kho·∫£n 100% online kh√¥ng c·∫ßn ƒë·∫øn ng√¢n h√†ng."
    },
    {
        "instruction": "S·ª≠a l·ªói c√¢u vƒÉn banking",
        "input": "toi muon chuyen tien cho ban nhung quen mat khau",
        "output": "T√¥i mu·ªën chuy·ªÉn ti·ªÅn cho b·∫°n nh∆∞ng qu√™n m·∫•t kh·∫©u."
    },
    {
        "instruction": "S·ª≠a l·ªói c√¢u vƒÉn banking",
        "input": "lam sao de mo tai khoan tiet kiem lai suat cao",
        "output": "L√†m sao ƒë·ªÉ m·ªü t√†i kho·∫£n ti·∫øt ki·ªám l√£i su·∫•t cao?"
    },
    {
        "instruction": "S·ª≠a l·ªói c√¢u vƒÉn banking",
        "input": "ngan hang nao cho vay tien mua nha tot nhat",
        "output": "Ng√¢n h√†ng n√†o cho vay ti·ªÅn mua nh√† t·ªët nh·∫•t?"
    },
    {
        "instruction": "S·ª≠a l·ªói c√¢u vƒÉn banking",
        "input": "the tin dung co gioi han chi tieu khong",
        "output": "Th·∫ª t√≠n d·ª•ng c√≥ gi·ªõi h·∫°n chi ti√™u kh√¥ng?"
    },
    {
        "instruction": "S·ª≠a l·ªói c√¢u vƒÉn banking",
        "input": "bi mat the atm phai lam gi khong",
        "output": "B·ªã m·∫•t th·∫ª ATM ph·∫£i l√†m g√¨ kh√¥ng?"
    }
]
</file>

<file path="training-data/banking_qa_vietnamese.jsonl">
{"instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng", "input": "Ph√≠ chuy·ªÉn kho·∫£n li√™n ng√¢n h√†ng l√† bao nhi√™u?", "output": "Ph√≠ chuy·ªÉn kho·∫£n li√™n ng√¢n h√†ng: 1,650ƒë - 11,000ƒë t√πy h√¨nh th·ª©c v√† ng√¢n h√†ng. Chuy·ªÉn nhanh 24/7: 1,650ƒë - 3,300ƒë. Chuy·ªÉn th∆∞·ªùng: mi·ªÖn ph√≠ - 5,500ƒë. Internet Banking r·∫ª h∆°n giao d·ªãch t·∫°i qu·∫ßy."}
{"instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng", "input": "T√†i kho·∫£n thanh to√°n v√† t√†i kho·∫£n ti·∫øt ki·ªám kh√°c nhau nh∆∞ th·∫ø n√†o?", "output": "T√†i kho·∫£n thanh to√°n: L√£i su·∫•t th·∫•p (0.1-0.5%/nƒÉm), r√∫t ti·ªÅn t·ª± do, ph√π h·ª£p chi ti√™u h√†ng ng√†y. T√†i kho·∫£n ti·∫øt ki·ªám: L√£i su·∫•t cao (4-8%/nƒÉm), c√≥ k·ª≥ h·∫°n, r√∫t tr∆∞·ªõc h·∫°n m·∫•t l√£i, ph√π h·ª£p t√≠ch l≈©y d√†i h·∫°n."}
{"instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng", "input": "L√†m sao ƒë·ªÉ tƒÉng h·∫°n m·ª©c th·∫ª t√≠n d·ª•ng?", "output": "ƒê·ªÉ tƒÉng h·∫°n m·ª©c th·∫ª t√≠n d·ª•ng: 1) S·ª≠ d·ª•ng th·∫ª th∆∞·ªùng xuy√™n v√† thanh to√°n ƒë√∫ng h·∫°n √≠t nh·∫•t 6 th√°ng, 2) Cung c·∫•p ch·ª©ng minh thu nh·∫≠p tƒÉng, 3) G·ªçi hotline ho·∫∑c ƒë·∫øn chi nh√°nh y√™u c·∫ßu review. Ng√¢n h√†ng x√©t duy·ªát 3-7 ng√†y."}
{"instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng", "input": "QR Code thanh to√°n c√≥ an to√†n kh√¥ng?", "output": "QR Code thanh to√°n r·∫•t an to√†n: 1) M√£ h√≥a th√¥ng tin giao d·ªãch, 2) X√°c nh·∫≠n tr∆∞·ªõc khi thanh to√°n, 3) Nh·∫≠n th√¥ng b√°o SMS ngay l·∫≠p t·ª©c. L∆∞u √Ω: Ch·ªâ qu√©t m√£ t·ª´ ngu·ªìn tin c·∫≠y, ki·ªÉm tra th√¥ng tin ng∆∞·ªùi nh·∫≠n tr∆∞·ªõc khi x√°c nh·∫≠n."}
{"instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng", "input": "G·ª≠i ti·∫øt ki·ªám online c√≥ ƒë∆∞·ª£c b·∫£o hi·ªÉm kh√¥ng?", "output": "Ti·ªÅn g·ª≠i ti·∫øt ki·ªám t·∫°i ng√¢n h√†ng ƒë∆∞·ª£c b·∫£o hi·ªÉm b·ªüi T·ªïng c√¥ng ty B·∫£o hi·ªÉm ti·ªÅn g·ª≠i Vi·ªát Nam (DIV) v·ªõi m·ª©c t·ªëi ƒëa 75 tri·ªáu ƒë·ªìng/ng∆∞·ªùi/ng√¢n h√†ng. √Åp d·ª•ng cho c·∫£ ti·∫øt ki·ªám online v√† offline."}
{"instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng", "input": "Tr·∫£ g√≥p 0% c√≥ th·ª±c s·ª± mi·ªÖn ph√≠ kh√¥ng?", "output": "Tr·∫£ g√≥p 0% th∆∞·ªùng do merchant (c·ª≠a h√†ng) h·ªó tr·ª£ ph√≠ thay ng√¢n h√†ng. B·∫°n kh√¥ng m·∫•t ph√≠ tr·∫£ g√≥p nh∆∞ng c√≥ th·ªÉ: 1) Gi√° s·∫£n ph·∫©m cao h∆°n tr·∫£ th·∫≥ng, 2) Kh√¥ng ƒë∆∞·ª£c gi·∫£m gi√°, 3) Ph·∫£i thanh to√°n ƒë√∫ng h·∫°n ƒë·ªÉ tr√°nh ph√≠ ph·∫°t."}
{"instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng", "input": "M·ªü th·∫ª ghi n·ª£ v√† th·∫ª t√≠n d·ª•ng kh√°c nhau g√¨?", "output": "Th·∫ª ghi n·ª£ (Debit): D√πng s·ªë d∆∞ trong t√†i kho·∫£n, kh√¥ng vay n·ª£, kh√¥ng ph√≠ l√£i su·∫•t, d·ªÖ l√†m. Th·∫ª t√≠n d·ª•ng (Credit): Vay ti·ªÅn ng√¢n h√†ng tr∆∞·ªõc, tr·∫£ sau, c√≥ l√£i su·∫•t 2-3.5%/th√°ng n·∫øu kh√¥ng tr·∫£ ƒë·ªß, c·∫ßn x√©t duy·ªát thu nh·∫≠p."}
{"instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng", "input": "Ki·ªÉm tra s·ªë d∆∞ t√†i kho·∫£n qua ƒëi·ªán tho·∫°i nh∆∞ th·∫ø n√†o?", "output": "Ki·ªÉm tra s·ªë d∆∞ qua ƒëi·ªán tho·∫°i: 1) SMS Banking: G·ª≠i tin nh·∫Øn 'SD' ƒë·∫øn 9xxx (200ƒë/tin), 2) Internet Banking app: ƒêƒÉng nh·∫≠p ‚Üí Xem s·ªë d∆∞ (mi·ªÖn ph√≠), 3) G·ªçi hotline ng√¢n h√†ng (mi·ªÖn ph√≠), 4) USSD: B·∫•m *xxx# (mi·ªÖn ph√≠)."}
{"instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng", "input": "Chuy·ªÉn ti·ªÅn qu·ªëc t·∫ø m·∫•t bao l√¢u?", "output": "Chuy·ªÉn ti·ªÅn qu·ªëc t·∫ø qua SWIFT: 2-5 ng√†y l√†m vi·ªác. Ph√≠: 10-50 USD t√πy ng√¢n h√†ng + ph√≠ trung gian + ph√≠ chuy·ªÉn ƒë·ªïi ngo·∫°i t·ªá (0.5-2%). C√°c d·ªãch v·ª• nhanh h∆°n: Western Union (v√†i gi·ªù), TransferWise/Wise (1-2 ng√†y)."}
{"instruction": "Tr·∫£ l·ªùi c√¢u h·ªèi v·ªÅ d·ªãch v·ª• ng√¢n h√†ng", "input": "N·ª£ x·∫•u ·∫£nh h∆∞·ªüng g√¨ ƒë·∫øn t√≠n d·ª•ng?", "output": "N·ª£ x·∫•u (n·ª£ qu√° h·∫°n >90 ng√†y) ghi nh·∫≠n t·∫°i CIC (Trung t√¢m Th√¥ng tin t√≠n d·ª•ng) trong 5-10 nƒÉm, d·∫´n ƒë·∫øn: 1) Kh√¥ng vay ƒë∆∞·ª£c t·∫°i m·ªçi ng√¢n h√†ng, 2) Kh√¥ng l√†m ƒë∆∞·ª£c th·∫ª t√≠n d·ª•ng, 3) Kh√≥ xin visa du l·ªãch, 4) ·∫¢nh h∆∞·ªüng h·ªì s∆° xin vi·ªác."}
{"instruction": "S·ª≠a l·ªói vƒÉn ph√≤ng banking", "input": "ban can cung cap chung minh thu nhap va ho khau de vay", "output": "B·∫°n c·∫ßn cung c·∫•p ch·ª©ng minh thu nh·∫≠p v√† h·ªô kh·∫©u ƒë·ªÉ vay."}
{"instruction": "S·ª≠a l·ªói vƒÉn ph√≤ng banking", "input": "han muc the tin dung cua toi la 10 trieu dong", "output": "H·∫°n m·ª©c th·∫ª t√≠n d·ª•ng c·ªßa t√¥i l√† 10 tri·ªáu ƒë·ªìng."}
{"instruction": "S·ª≠a l·ªói vƒÉn ph√≤ng banking", "input": "ung dung ngan hang bi loi khong dang nhap duoc", "output": "·ª®ng d·ª•ng ng√¢n h√†ng b·ªã l·ªói, kh√¥ng ƒëƒÉng nh·∫≠p ƒë∆∞·ª£c."}
{"instruction": "S·ª≠a l·ªói vƒÉn ph√≤ng banking", "input": "lai suat tiet kiem ky han 12 thang hien tai", "output": "L√£i su·∫•t ti·∫øt ki·ªám k·ª≥ h·∫°n 12 th√°ng hi·ªán t·∫°i."}
{"instruction": "S·ª≠a l·ªói vƒÉn ph√≤ng banking", "input": "toi muon rut tien tu tai khoan tiet kiem som", "output": "T√¥i mu·ªën r√∫t ti·ªÅn t·ª´ t√†i kho·∫£n ti·∫øt ki·ªám s·ªõm."}
</file>

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Python
python/venv
python/__pycache__
python/**/__pycache__
*.pyc
python/outputs
python/models
python/F5-TTS-Vietnamese
python/F5-TTS-Vietnamese-ViVoice
python/ref_audio/*.wav

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ai-voice-bot</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="package.json">
{
  "name": "ai-voice-bot",
  "private": true,
  "version": "1.0.0",
  "description": "AI Voice Bot - H·ªá th·ªëng Bot AI Tr·∫£ l·ªùi Cu·ªôc g·ªçi T·ª± ƒë·ªông",
  "type": "module",
  "main": "electron/main.js",
  "scripts": {
    "dev": "vite",
    "dev:electron": "concurrently \"npm run dev\" \"wait-on http://localhost:5174 && NODE_ENV=development electron .\"",
    "build": "vite build",
    "build:electron": "npm run build && electron-builder",
    "lint": "eslint .",
    "preview": "vite preview",
    "start": "electron ."
  },
  "dependencies": {
    "better-sqlite3": "^12.6.2",
    "clsx": "^2.1.1",
    "edge-tts": "^1.0.1",
    "lucide-react": "^0.511.0",
    "node-llama-cpp": "^3.15.1",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.13.0",
    "zustand": "^5.0.11"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.24",
    "concurrently": "^9.2.1",
    "electron": "^40.1.0",
    "electron-builder": "^26.7.0",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.19",
    "vite": "^7.2.4",
    "wait-on": "^9.0.3"
  },
  "build": {
    "appId": "com.aibank.voice-bot",
    "productName": "AI Voice Bot",
    "directories": {
      "buildResources": "build",
      "output": "release"
    },
    "files": [
      "dist/**/*",
      "electron/**/*"
    ],
    "mac": {
      "category": "public.app-category.utilities",
      "target": [
        "dmg",
        "zip"
      ]
    },
    "win": {
      "target": [
        "nsis",
        "portable"
      ]
    }
  }
}
</file>

<file path="postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="README.md">
# AI Voice Bot (bankAI)

Electron desktop application for automated banking call handling in Vietnamese. Combines a React frontend with local AI backends for voice cloning, STT, and text processing.

## Tech Stack

- **Frontend**: React 19, Vite, Zustand, Tailwind CSS 3, Lucide React
- **Backend**: Electron (Node.js), SQLite (better-sqlite3)
- **AI/ML**:
  - **TTS**: F5-TTS (Vietnamese voice cloning), Edge TTS (cloud fallback)
  - **STT**: OpenAI Whisper (transcribe.py)
  - **LLM**: Ollama (Qwen:4b) for text correction and extraction
- **Audio**: ffmpeg (conversion), Canvas API (visualization)

## Architecture Summary

The app uses a classic Electron architecture:
- **Main Process**: Handles window management, SQLite DB, and spawns Python subprocesses for AI tasks.
- **Preload Script**: Exposes namespaced IPC methods (`window.electronAPI.db`, `tts`, `qwen`, etc.) to the renderer.
- **Renderer**: React-based UI that communicates with the backend exclusively via IPC.

## Getting Started

### Prerequisites

- **Node.js**: v18+
- **Python**: 3.10+ (with `venv` support)
- **Ollama**: Installed and running locally
- **ffmpeg**: Installed and available in PATH

### Setup

1. **Install Node dependencies**:
   ```bash
   npm install
   ```

2. **Setup Python environment**:
   ```bash
   cd python
   python -m venv venv
   # Activate venv and install dependencies (F5-TTS, Whisper)
   # source venv/bin/activate (Linux/macOS) or venv\Scripts\activate (Windows)
   pip install -r requirements.txt
   ```

3. **Pull LLM model**:
   ```bash
   ollama pull qwen:4b
   ```

### Development

```bash
# Run Electron + Vite dev server
npm run dev:electron

# Run Vite-only dev server (limited functionality)
npm run dev
```

### Build

```bash
npm run build:electron
```

## Commands

- `npm run dev:electron`: Main development command.
- `npm run build:electron`: Package the app for production.
- `npm run lint`: Run ESLint.

## Project Structure

- `electron/`: Main process logic, DB, and IPC handlers.
- `src/`: React frontend source code.
- `python/`: AI scripts and virtual environment.
- `training-data/`: Vietnamese banking datasets.
- `docs/`: Technical documentation.
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: [
    "./index.html",
    "./src/**/*.{js,jsx,ts,tsx}",
  ],
  theme: {
    extend: {
      fontFamily: {
        sans: ['Inter', '-apple-system', 'BlinkMacSystemFont', 'system-ui', 'sans-serif'],
      },
      colors: {
        // Extended Brand Colors
        primary: {
          50: '#faf5ff',
          100: '#f3e8ff',
          200: '#e9d5ff',
          300: '#d8b4fe',
          400: '#c084fc',
          500: '#a855f7',
          600: '#9333ea',
          700: '#7e22ce',
          800: '#6b21a8',
          900: '#581c87',
        },
        violet: {
          400: '#a78bfa',
          500: '#8b5cf6',
          600: '#7c3aed',
        },
        purple: {
          500: '#a855f7',
          600: '#9333ea',
        },
        cyan: {
          400: '#22d3ee',
          500: '#06b6d4',
          600: '#0891b2',
        },
        emerald: {
          400: '#34d399',
          500: '#10b981',
          600: '#059669',
        },
        rose: {
          400: '#fb7185',
          500: '#f43f5e',
          600: '#e11d48',
        },
        amber: {
          400: '#fbbf24',
          500: '#f59e0b',
          600: '#d97706',
        },
      },
      animation: {
        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
        'shimmer': 'shimmer 2s linear infinite',
        'float': 'float 3s ease-in-out infinite',
        'gradient-shift': 'gradient-shift 3s ease infinite',
        'fade-in': 'fadeIn 0.5s ease-out',
        'fade-in-up': 'fadeInUp 0.6s ease-out',
        'scale-in': 'scaleIn 0.3s ease-out',
        'slide-in-right': 'slideInRight 0.3s ease-out',
        'bounce-subtle': 'bounceSubtle 1s ease-in-out infinite',
      },
      keyframes: {
        shimmer: {
          '0%': { backgroundPosition: '-1000px 0' },
          '100%': { backgroundPosition: '1000px 0' },
        },
        float: {
          '0%, 100%': { transform: 'translateY(0px)' },
          '50%': { transform: 'translateY(-10px)' },
        },
        'gradient-shift': {
          '0%, 100%': { backgroundPosition: '0% 50%' },
          '50%': { backgroundPosition: '100% 50%' },
        },
        fadeIn: {
          '0%': { opacity: '0' },
          '100%': { opacity: '1' },
        },
        fadeInUp: {
          '0%': { opacity: '0', transform: 'translateY(20px)' },
          '100%': { opacity: '1', transform: 'translateY(0)' },
        },
        scaleIn: {
          '0%': { opacity: '0', transform: 'scale(0.9)' },
          '100%': { opacity: '1', transform: 'scale(1)' },
        },
        slideInRight: {
          '0%': { transform: 'translateX(-100%)' },
          '100%': { transform: 'translateX(0)' },
        },
        bounceSubtle: {
          '0%, 100%': { transform: 'translateY(0)' },
          '50%': { transform: 'translateY(-5px)' },
        },
      },
      backgroundSize: {
        'size-200': '200% 200%',
      },
      boxShadow: {
        'glow-sm': '0 0 15px -3px rgba(139, 92, 246, 0.4)',
        'glow': '0 0 30px -6px rgba(139, 92, 246, 0.5)',
        'glow-lg': '0 0 50px -12px rgba(139, 92, 246, 0.6)',
        'inner-glow': 'inset 0 0 20px rgba(139, 92, 246, 0.2)',
      },
      backdropBlur: {
        xs: '2px',
      },
      borderRadius: {
        '4xl': '2rem',
      },
      spacing: {
        '18': '4.5rem',
        '88': '22rem',
        '128': '32rem',
      },
      fontSize: {
        '2xs': ['0.625rem', { lineHeight: '0.75rem' }],
      },
      transitionDuration: {
        '400': '400ms',
      },
    },
  },
  plugins: [],
}
</file>

<file path="vite.config.js">
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import path from "path";

export default defineConfig({
  plugins: [react()],
  base: "./",
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
  server: {
    port: 5174,
    strictPort: true,
  },
  build: {
    outDir: "dist",
    emptyOutDir: true,
  },
});
</file>

</files>
